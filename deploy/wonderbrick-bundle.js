(()=>{var zr=Object.create;var Ze=Object.defineProperty;var Nr=Object.getOwnPropertyDescriptor;var Vr=Object.getOwnPropertyNames;var Hr=Object.getPrototypeOf,Ur=Object.prototype.hasOwnProperty;var Xr=(e,t,n)=>t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var oe=(e,t)=>()=>(e&&(t=e(e=0)),t);var U=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var qt=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of Vr(t))!Ur.call(e,s)&&s!==n&&Ze(e,s,{get:()=>t[s],enumerable:!(r=Nr(t,s))||r.enumerable});return e};var Z=(e,t,n)=>(n=e!=null?zr(Hr(e)):{},qt(t||!e||!e.__esModule?Ze(n,"default",{value:e,enumerable:!0}):n,e)),le=e=>qt(Ze({},"__esModule",{value:!0}),e);var Je=(e,t,n)=>(Xr(e,typeof t!="symbol"?t+"":t,n),n);var zt=(e,t,n)=>new Promise((r,s)=>{var a=c=>{try{_(n.next(c))}catch(p){s(p)}},o=c=>{try{_(n.throw(c))}catch(p){s(p)}},_=c=>c.done?r(c.value):Promise.resolve(c.value).then(a,o);_((n=n.apply(e,t)).next())});var se=U(ne=>{"use strict";Object.defineProperty(ne,"__esModule",{value:!0});ne.setMatrixArrayType=Gr;ne.toRadian=$r;ne.equals=Zr;ne.RANDOM=ne.ARRAY_TYPE=ne.EPSILON=void 0;var Nt=1e-6;ne.EPSILON=Nt;var Vt=typeof Float32Array<"u"?Float32Array:Array;ne.ARRAY_TYPE=Vt;var Yr=Math.random;ne.RANDOM=Yr;function Gr(e){ne.ARRAY_TYPE=Vt=e}var Qr=Math.PI/180;function $r(e){return e*Qr}function Zr(e,t){return Math.abs(e-t)<=Nt*Math.max(1,Math.abs(e),Math.abs(t))}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)})});var Yt=U(q=>{"use strict";function Ke(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ke=function(n){return typeof n}:Ke=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},Ke(e)}Object.defineProperty(q,"__esModule",{value:!0});q.create=Kr;q.clone=ei;q.copy=ti;q.identity=ni;q.fromValues=ri;q.set=ii;q.transpose=si;q.invert=ai;q.adjoint=oi;q.determinant=li;q.multiply=Ut;q.rotate=ci;q.scale=_i;q.fromRotation=hi;q.fromScaling=pi;q.str=di;q.frob=ui;q.LDU=mi;q.add=fi;q.subtract=Xt;q.exactEquals=gi;q.equals=vi;q.multiplyScalar=yi;q.multiplyScalarAndAdd=wi;q.sub=q.mul=void 0;var ye=Jr(se());function Ht(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Ht=function(s){return s?n:t})(e)}function Jr(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||Ke(e)!=="object"&&typeof e!="function")return{default:e};var n=Ht(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function Kr(){var e=new ye.ARRAY_TYPE(4);return ye.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e}function ei(e){var t=new ye.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ti(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function ni(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e}function ri(e,t,n,r){var s=new ye.ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s}function ii(e,t,n,r,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e}function si(e,t){if(e===t){var n=t[1];e[1]=t[2],e[2]=n}else e[0]=t[0],e[1]=t[2],e[2]=t[1],e[3]=t[3];return e}function ai(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=n*a-s*r;return o?(o=1/o,e[0]=a*o,e[1]=-r*o,e[2]=-s*o,e[3]=n*o,e):null}function oi(e,t){var n=t[0];return e[0]=t[3],e[1]=-t[1],e[2]=-t[2],e[3]=n,e}function li(e){return e[0]*e[3]-e[2]*e[1]}function Ut(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[0],c=n[1],p=n[2],i=n[3];return e[0]=r*_+a*c,e[1]=s*_+o*c,e[2]=r*p+a*i,e[3]=s*p+o*i,e}function ci(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=Math.sin(n),c=Math.cos(n);return e[0]=r*c+a*_,e[1]=s*c+o*_,e[2]=r*-_+a*c,e[3]=s*-_+o*c,e}function _i(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[0],c=n[1];return e[0]=r*_,e[1]=s*_,e[2]=a*c,e[3]=o*c,e}function hi(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e}function pi(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e}function di(e){return"mat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function ui(e){return Math.hypot(e[0],e[1],e[2],e[3])}function mi(e,t,n,r){return e[2]=r[2]/r[0],n[0]=r[0],n[1]=r[1],n[3]=r[3]-e[2]*n[1],[e,t,n]}function fi(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function Xt(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function gi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function vi(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=t[0],_=t[1],c=t[2],p=t[3];return Math.abs(n-o)<=ye.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-_)<=ye.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(s-c)<=ye.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-p)<=ye.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))}function yi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function wi(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}var bi=Ut;q.mul=bi;var xi=Xt;q.sub=xi});var Zt=U(N=>{"use strict";function et(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?et=function(n){return typeof n}:et=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},et(e)}Object.defineProperty(N,"__esModule",{value:!0});N.create=Ti;N.clone=Ai;N.copy=Si;N.identity=Oi;N.fromValues=Pi;N.set=ji;N.invert=Ci;N.determinant=Li;N.multiply=Qt;N.rotate=Ii;N.scale=Ri;N.translate=Ei;N.fromRotation=Fi;N.fromScaling=ki;N.fromTranslation=Wi;N.str=Bi;N.frob=Di;N.add=qi;N.subtract=$t;N.multiplyScalar=zi;N.multiplyScalarAndAdd=Ni;N.exactEquals=Vi;N.equals=Hi;N.sub=N.mul=void 0;var ce=Mi(se());function Gt(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Gt=function(s){return s?n:t})(e)}function Mi(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||et(e)!=="object"&&typeof e!="function")return{default:e};var n=Gt(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function Ti(){var e=new ce.ARRAY_TYPE(6);return ce.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[4]=0,e[5]=0),e[0]=1,e[3]=1,e}function Ai(e){var t=new ce.ARRAY_TYPE(6);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function Si(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e}function Oi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e}function Pi(e,t,n,r,s,a){var o=new ce.ARRAY_TYPE(6);return o[0]=e,o[1]=t,o[2]=n,o[3]=r,o[4]=s,o[5]=a,o}function ji(e,t,n,r,s,a,o){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e[4]=a,e[5]=o,e}function Ci(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=n*a-r*s;return c?(c=1/c,e[0]=a*c,e[1]=-r*c,e[2]=-s*c,e[3]=n*c,e[4]=(s*_-a*o)*c,e[5]=(r*o-n*_)*c,e):null}function Li(e){return e[0]*e[3]-e[1]*e[2]}function Qt(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=n[0],i=n[1],l=n[2],h=n[3],d=n[4],m=n[5];return e[0]=r*p+a*i,e[1]=s*p+o*i,e[2]=r*l+a*h,e[3]=s*l+o*h,e[4]=r*d+a*m+_,e[5]=s*d+o*m+c,e}function Ii(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=Math.sin(n),i=Math.cos(n);return e[0]=r*i+a*p,e[1]=s*i+o*p,e[2]=r*-p+a*i,e[3]=s*-p+o*i,e[4]=_,e[5]=c,e}function Ri(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=n[0],i=n[1];return e[0]=r*p,e[1]=s*p,e[2]=a*i,e[3]=o*i,e[4]=_,e[5]=c,e}function Ei(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=n[0],i=n[1];return e[0]=r,e[1]=s,e[2]=a,e[3]=o,e[4]=r*p+a*i+_,e[5]=s*p+o*i+c,e}function Fi(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=-n,e[3]=r,e[4]=0,e[5]=0,e}function ki(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=t[1],e[4]=0,e[5]=0,e}function Wi(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0],e[5]=t[1],e}function Bi(e){return"mat2d("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+")"}function Di(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],1)}function qi(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e}function $t(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e}function zi(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e}function Ni(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e}function Vi(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]}function Hi(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],_=e[5],c=t[0],p=t[1],i=t[2],l=t[3],h=t[4],d=t[5];return Math.abs(n-c)<=ce.EPSILON*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(r-p)<=ce.EPSILON*Math.max(1,Math.abs(r),Math.abs(p))&&Math.abs(s-i)<=ce.EPSILON*Math.max(1,Math.abs(s),Math.abs(i))&&Math.abs(a-l)<=ce.EPSILON*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-h)<=ce.EPSILON*Math.max(1,Math.abs(o),Math.abs(h))&&Math.abs(_-d)<=ce.EPSILON*Math.max(1,Math.abs(_),Math.abs(d))}var Ui=Qt;N.mul=Ui;var Xi=$t;N.sub=Xi});var vt=U(E=>{"use strict";function tt(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?tt=function(n){return typeof n}:tt=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},tt(e)}Object.defineProperty(E,"__esModule",{value:!0});E.create=Gi;E.fromMat4=Qi;E.clone=$i;E.copy=Zi;E.fromValues=Ji;E.set=Ki;E.identity=es;E.transpose=ts;E.invert=ns;E.adjoint=rs;E.determinant=is;E.multiply=Kt;E.translate=ss;E.rotate=as;E.scale=os;E.fromTranslation=ls;E.fromRotation=cs;E.fromScaling=_s;E.fromMat2d=hs;E.fromQuat=ps;E.normalFromMat4=ds;E.projection=us;E.str=ms;E.frob=fs;E.add=gs;E.subtract=en;E.multiplyScalar=vs;E.multiplyScalarAndAdd=ys;E.exactEquals=ws;E.equals=bs;E.sub=E.mul=void 0;var ee=Yi(se());function Jt(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Jt=function(s){return s?n:t})(e)}function Yi(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||tt(e)!=="object"&&typeof e!="function")return{default:e};var n=Jt(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function Gi(){var e=new ee.ARRAY_TYPE(9);return ee.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Qi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function $i(e){var t=new ee.ARRAY_TYPE(9);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t}function Zi(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function Ji(e,t,n,r,s,a,o,_,c){var p=new ee.ARRAY_TYPE(9);return p[0]=e,p[1]=t,p[2]=n,p[3]=r,p[4]=s,p[5]=a,p[6]=o,p[7]=_,p[8]=c,p}function Ki(e,t,n,r,s,a,o,_,c,p){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e[4]=a,e[5]=o,e[6]=_,e[7]=c,e[8]=p,e}function es(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function ts(e,t){if(e===t){var n=t[1],r=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=n,e[5]=t[7],e[6]=r,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8];return e}function ns(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=t[6],p=t[7],i=t[8],l=i*o-_*p,h=-i*a+_*c,d=p*a-o*c,m=n*l+r*h+s*d;return m?(m=1/m,e[0]=l*m,e[1]=(-i*r+s*p)*m,e[2]=(_*r-s*o)*m,e[3]=h*m,e[4]=(i*n-s*c)*m,e[5]=(-_*n+s*a)*m,e[6]=d*m,e[7]=(-p*n+r*c)*m,e[8]=(o*n-r*a)*m,e):null}function rs(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=t[6],p=t[7],i=t[8];return e[0]=o*i-_*p,e[1]=s*p-r*i,e[2]=r*_-s*o,e[3]=_*c-a*i,e[4]=n*i-s*c,e[5]=s*a-n*_,e[6]=a*p-o*c,e[7]=r*c-n*p,e[8]=n*o-r*a,e}function is(e){var t=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],_=e[6],c=e[7],p=e[8];return t*(p*a-o*c)+n*(-p*s+o*_)+r*(c*s-a*_)}function Kt(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=t[8],h=n[0],d=n[1],m=n[2],f=n[3],u=n[4],g=n[5],y=n[6],w=n[7],b=n[8];return e[0]=h*r+d*o+m*p,e[1]=h*s+d*_+m*i,e[2]=h*a+d*c+m*l,e[3]=f*r+u*o+g*p,e[4]=f*s+u*_+g*i,e[5]=f*a+u*c+g*l,e[6]=y*r+w*o+b*p,e[7]=y*s+w*_+b*i,e[8]=y*a+w*c+b*l,e}function ss(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=t[8],h=n[0],d=n[1];return e[0]=r,e[1]=s,e[2]=a,e[3]=o,e[4]=_,e[5]=c,e[6]=h*r+d*o+p,e[7]=h*s+d*_+i,e[8]=h*a+d*c+l,e}function as(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=t[8],h=Math.sin(n),d=Math.cos(n);return e[0]=d*r+h*o,e[1]=d*s+h*_,e[2]=d*a+h*c,e[3]=d*o-h*r,e[4]=d*_-h*s,e[5]=d*c-h*a,e[6]=p,e[7]=i,e[8]=l,e}function os(e,t,n){var r=n[0],s=n[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ls(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=t[0],e[7]=t[1],e[8]=1,e}function cs(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function _s(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=t[1],e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function hs(e,t){return e[0]=t[0],e[1]=t[1],e[2]=0,e[3]=t[2],e[4]=t[3],e[5]=0,e[6]=t[4],e[7]=t[5],e[8]=1,e}function ps(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=n+n,_=r+r,c=s+s,p=n*o,i=r*o,l=r*_,h=s*o,d=s*_,m=s*c,f=a*o,u=a*_,g=a*c;return e[0]=1-l-m,e[3]=i-g,e[6]=h+u,e[1]=i+g,e[4]=1-p-m,e[7]=d-f,e[2]=h-u,e[5]=d+f,e[8]=1-p-l,e}function ds(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=t[6],p=t[7],i=t[8],l=t[9],h=t[10],d=t[11],m=t[12],f=t[13],u=t[14],g=t[15],y=n*_-r*o,w=n*c-s*o,b=n*p-a*o,M=r*c-s*_,T=r*p-a*_,F=s*p-a*c,j=i*f-l*m,B=i*u-h*m,W=i*g-d*m,V=l*u-h*f,D=l*g-d*f,k=h*g-d*u,I=y*k-w*D+b*V+M*W-T*B+F*j;return I?(I=1/I,e[0]=(_*k-c*D+p*V)*I,e[1]=(c*W-o*k-p*B)*I,e[2]=(o*D-_*W+p*j)*I,e[3]=(s*D-r*k-a*V)*I,e[4]=(n*k-s*W+a*B)*I,e[5]=(r*W-n*D-a*j)*I,e[6]=(f*F-u*T+g*M)*I,e[7]=(u*b-m*F-g*w)*I,e[8]=(m*T-f*b+g*y)*I,e):null}function us(e,t,n){return e[0]=2/t,e[1]=0,e[2]=0,e[3]=0,e[4]=-2/n,e[5]=0,e[6]=-1,e[7]=1,e[8]=1,e}function ms(e){return"mat3("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+")"}function fs(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8])}function gs(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e}function en(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e}function vs(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e}function ys(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e}function ws(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]}function bs(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],_=e[5],c=e[6],p=e[7],i=e[8],l=t[0],h=t[1],d=t[2],m=t[3],f=t[4],u=t[5],g=t[6],y=t[7],w=t[8];return Math.abs(n-l)<=ee.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(r-h)<=ee.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(s-d)<=ee.EPSILON*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-m)<=ee.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-f)<=ee.EPSILON*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(_-u)<=ee.EPSILON*Math.max(1,Math.abs(_),Math.abs(u))&&Math.abs(c-g)<=ee.EPSILON*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(p-y)<=ee.EPSILON*Math.max(1,Math.abs(p),Math.abs(y))&&Math.abs(i-w)<=ee.EPSILON*Math.max(1,Math.abs(i),Math.abs(w))}var xs=Kt;E.mul=xs;var Ms=en;E.sub=Ms});var yt=U(O=>{"use strict";function nt(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?nt=function(n){return typeof n}:nt=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},nt(e)}Object.defineProperty(O,"__esModule",{value:!0});O.create=As;O.clone=Ss;O.copy=Os;O.fromValues=Ps;O.set=js;O.identity=nn;O.transpose=Cs;O.invert=Ls;O.adjoint=Is;O.determinant=Rs;O.multiply=rn;O.translate=Es;O.scale=Fs;O.rotate=ks;O.rotateX=Ws;O.rotateY=Bs;O.rotateZ=Ds;O.fromTranslation=qs;O.fromScaling=zs;O.fromRotation=Ns;O.fromXRotation=Vs;O.fromYRotation=Hs;O.fromZRotation=Us;O.fromRotationTranslation=sn;O.fromQuat2=Xs;O.getTranslation=Ys;O.getScaling=an;O.getRotation=Gs;O.fromRotationTranslationScale=Qs;O.fromRotationTranslationScaleOrigin=$s;O.fromQuat=Zs;O.frustum=Js;O.perspectiveNO=on;O.perspectiveZO=ea;O.perspectiveFromFieldOfView=ta;O.orthoNO=ln;O.orthoZO=ra;O.lookAt=ia;O.targetTo=sa;O.str=aa;O.frob=oa;O.add=la;O.subtract=cn;O.multiplyScalar=ca;O.multiplyScalarAndAdd=_a;O.exactEquals=ha;O.equals=pa;O.sub=O.mul=O.ortho=O.perspective=void 0;var H=Ts(se());function tn(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(tn=function(s){return s?n:t})(e)}function Ts(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||nt(e)!=="object"&&typeof e!="function")return{default:e};var n=tn(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function As(){var e=new H.ARRAY_TYPE(16);return H.ARRAY_TYPE!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Ss(e){var t=new H.ARRAY_TYPE(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Os(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function Ps(e,t,n,r,s,a,o,_,c,p,i,l,h,d,m,f){var u=new H.ARRAY_TYPE(16);return u[0]=e,u[1]=t,u[2]=n,u[3]=r,u[4]=s,u[5]=a,u[6]=o,u[7]=_,u[8]=c,u[9]=p,u[10]=i,u[11]=l,u[12]=h,u[13]=d,u[14]=m,u[15]=f,u}function js(e,t,n,r,s,a,o,_,c,p,i,l,h,d,m,f,u){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e[4]=a,e[5]=o,e[6]=_,e[7]=c,e[8]=p,e[9]=i,e[10]=l,e[11]=h,e[12]=d,e[13]=m,e[14]=f,e[15]=u,e}function nn(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Cs(e,t){if(e===t){var n=t[1],r=t[2],s=t[3],a=t[6],o=t[7],_=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=n,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=s,e[13]=o,e[14]=_}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function Ls(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=t[6],p=t[7],i=t[8],l=t[9],h=t[10],d=t[11],m=t[12],f=t[13],u=t[14],g=t[15],y=n*_-r*o,w=n*c-s*o,b=n*p-a*o,M=r*c-s*_,T=r*p-a*_,F=s*p-a*c,j=i*f-l*m,B=i*u-h*m,W=i*g-d*m,V=l*u-h*f,D=l*g-d*f,k=h*g-d*u,I=y*k-w*D+b*V+M*W-T*B+F*j;return I?(I=1/I,e[0]=(_*k-c*D+p*V)*I,e[1]=(s*D-r*k-a*V)*I,e[2]=(f*F-u*T+g*M)*I,e[3]=(h*T-l*F-d*M)*I,e[4]=(c*W-o*k-p*B)*I,e[5]=(n*k-s*W+a*B)*I,e[6]=(u*b-m*F-g*w)*I,e[7]=(i*F-h*b+d*w)*I,e[8]=(o*D-_*W+p*j)*I,e[9]=(r*W-n*D-a*j)*I,e[10]=(m*T-f*b+g*y)*I,e[11]=(l*b-i*T-d*y)*I,e[12]=(_*B-o*V-c*j)*I,e[13]=(n*V-r*B+s*j)*I,e[14]=(f*w-m*M-u*y)*I,e[15]=(i*M-l*w+h*y)*I,e):null}function Is(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=t[4],_=t[5],c=t[6],p=t[7],i=t[8],l=t[9],h=t[10],d=t[11],m=t[12],f=t[13],u=t[14],g=t[15];return e[0]=_*(h*g-d*u)-l*(c*g-p*u)+f*(c*d-p*h),e[1]=-(r*(h*g-d*u)-l*(s*g-a*u)+f*(s*d-a*h)),e[2]=r*(c*g-p*u)-_*(s*g-a*u)+f*(s*p-a*c),e[3]=-(r*(c*d-p*h)-_*(s*d-a*h)+l*(s*p-a*c)),e[4]=-(o*(h*g-d*u)-i*(c*g-p*u)+m*(c*d-p*h)),e[5]=n*(h*g-d*u)-i*(s*g-a*u)+m*(s*d-a*h),e[6]=-(n*(c*g-p*u)-o*(s*g-a*u)+m*(s*p-a*c)),e[7]=n*(c*d-p*h)-o*(s*d-a*h)+i*(s*p-a*c),e[8]=o*(l*g-d*f)-i*(_*g-p*f)+m*(_*d-p*l),e[9]=-(n*(l*g-d*f)-i*(r*g-a*f)+m*(r*d-a*l)),e[10]=n*(_*g-p*f)-o*(r*g-a*f)+m*(r*p-a*_),e[11]=-(n*(_*d-p*l)-o*(r*d-a*l)+i*(r*p-a*_)),e[12]=-(o*(l*u-h*f)-i*(_*u-c*f)+m*(_*h-c*l)),e[13]=n*(l*u-h*f)-i*(r*u-s*f)+m*(r*h-s*l),e[14]=-(n*(_*u-c*f)-o*(r*u-s*f)+m*(r*c-s*_)),e[15]=n*(_*h-c*l)-o*(r*h-s*l)+i*(r*c-s*_),e}function Rs(e){var t=e[0],n=e[1],r=e[2],s=e[3],a=e[4],o=e[5],_=e[6],c=e[7],p=e[8],i=e[9],l=e[10],h=e[11],d=e[12],m=e[13],f=e[14],u=e[15],g=t*o-n*a,y=t*_-r*a,w=t*c-s*a,b=n*_-r*o,M=n*c-s*o,T=r*c-s*_,F=p*m-i*d,j=p*f-l*d,B=p*u-h*d,W=i*f-l*m,V=i*u-h*m,D=l*u-h*f;return g*D-y*V+w*W+b*B-M*j+T*F}function rn(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=t[8],h=t[9],d=t[10],m=t[11],f=t[12],u=t[13],g=t[14],y=t[15],w=n[0],b=n[1],M=n[2],T=n[3];return e[0]=w*r+b*_+M*l+T*f,e[1]=w*s+b*c+M*h+T*u,e[2]=w*a+b*p+M*d+T*g,e[3]=w*o+b*i+M*m+T*y,w=n[4],b=n[5],M=n[6],T=n[7],e[4]=w*r+b*_+M*l+T*f,e[5]=w*s+b*c+M*h+T*u,e[6]=w*a+b*p+M*d+T*g,e[7]=w*o+b*i+M*m+T*y,w=n[8],b=n[9],M=n[10],T=n[11],e[8]=w*r+b*_+M*l+T*f,e[9]=w*s+b*c+M*h+T*u,e[10]=w*a+b*p+M*d+T*g,e[11]=w*o+b*i+M*m+T*y,w=n[12],b=n[13],M=n[14],T=n[15],e[12]=w*r+b*_+M*l+T*f,e[13]=w*s+b*c+M*h+T*u,e[14]=w*a+b*p+M*d+T*g,e[15]=w*o+b*i+M*m+T*y,e}function Es(e,t,n){var r=n[0],s=n[1],a=n[2],o,_,c,p,i,l,h,d,m,f,u,g;return t===e?(e[12]=t[0]*r+t[4]*s+t[8]*a+t[12],e[13]=t[1]*r+t[5]*s+t[9]*a+t[13],e[14]=t[2]*r+t[6]*s+t[10]*a+t[14],e[15]=t[3]*r+t[7]*s+t[11]*a+t[15]):(o=t[0],_=t[1],c=t[2],p=t[3],i=t[4],l=t[5],h=t[6],d=t[7],m=t[8],f=t[9],u=t[10],g=t[11],e[0]=o,e[1]=_,e[2]=c,e[3]=p,e[4]=i,e[5]=l,e[6]=h,e[7]=d,e[8]=m,e[9]=f,e[10]=u,e[11]=g,e[12]=o*r+i*s+m*a+t[12],e[13]=_*r+l*s+f*a+t[13],e[14]=c*r+h*s+u*a+t[14],e[15]=p*r+d*s+g*a+t[15]),e}function Fs(e,t,n){var r=n[0],s=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function ks(e,t,n,r){var s=r[0],a=r[1],o=r[2],_=Math.hypot(s,a,o),c,p,i,l,h,d,m,f,u,g,y,w,b,M,T,F,j,B,W,V,D,k,I,ie;return _<H.EPSILON?null:(_=1/_,s*=_,a*=_,o*=_,c=Math.sin(n),p=Math.cos(n),i=1-p,l=t[0],h=t[1],d=t[2],m=t[3],f=t[4],u=t[5],g=t[6],y=t[7],w=t[8],b=t[9],M=t[10],T=t[11],F=s*s*i+p,j=a*s*i+o*c,B=o*s*i-a*c,W=s*a*i-o*c,V=a*a*i+p,D=o*a*i+s*c,k=s*o*i+a*c,I=a*o*i-s*c,ie=o*o*i+p,e[0]=l*F+f*j+w*B,e[1]=h*F+u*j+b*B,e[2]=d*F+g*j+M*B,e[3]=m*F+y*j+T*B,e[4]=l*W+f*V+w*D,e[5]=h*W+u*V+b*D,e[6]=d*W+g*V+M*D,e[7]=m*W+y*V+T*D,e[8]=l*k+f*I+w*ie,e[9]=h*k+u*I+b*ie,e[10]=d*k+g*I+M*ie,e[11]=m*k+y*I+T*ie,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function Ws(e,t,n){var r=Math.sin(n),s=Math.cos(n),a=t[4],o=t[5],_=t[6],c=t[7],p=t[8],i=t[9],l=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*s+p*r,e[5]=o*s+i*r,e[6]=_*s+l*r,e[7]=c*s+h*r,e[8]=p*s-a*r,e[9]=i*s-o*r,e[10]=l*s-_*r,e[11]=h*s-c*r,e}function Bs(e,t,n){var r=Math.sin(n),s=Math.cos(n),a=t[0],o=t[1],_=t[2],c=t[3],p=t[8],i=t[9],l=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s-p*r,e[1]=o*s-i*r,e[2]=_*s-l*r,e[3]=c*s-h*r,e[8]=a*r+p*s,e[9]=o*r+i*s,e[10]=_*r+l*s,e[11]=c*r+h*s,e}function Ds(e,t,n){var r=Math.sin(n),s=Math.cos(n),a=t[0],o=t[1],_=t[2],c=t[3],p=t[4],i=t[5],l=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*s+p*r,e[1]=o*s+i*r,e[2]=_*s+l*r,e[3]=c*s+h*r,e[4]=p*s-a*r,e[5]=i*s-o*r,e[6]=l*s-_*r,e[7]=h*s-c*r,e}function qs(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function zs(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ns(e,t,n){var r=n[0],s=n[1],a=n[2],o=Math.hypot(r,s,a),_,c,p;return o<H.EPSILON?null:(o=1/o,r*=o,s*=o,a*=o,_=Math.sin(t),c=Math.cos(t),p=1-c,e[0]=r*r*p+c,e[1]=s*r*p+a*_,e[2]=a*r*p-s*_,e[3]=0,e[4]=r*s*p-a*_,e[5]=s*s*p+c,e[6]=a*s*p+r*_,e[7]=0,e[8]=r*a*p+s*_,e[9]=s*a*p-r*_,e[10]=a*a*p+c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Vs(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Hs(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Us(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sn(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=r+r,c=s+s,p=a+a,i=r*_,l=r*c,h=r*p,d=s*c,m=s*p,f=a*p,u=o*_,g=o*c,y=o*p;return e[0]=1-(d+f),e[1]=l+y,e[2]=h-g,e[3]=0,e[4]=l-y,e[5]=1-(i+f),e[6]=m+u,e[7]=0,e[8]=h+g,e[9]=m-u,e[10]=1-(i+d),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Xs(e,t){var n=new H.ARRAY_TYPE(3),r=-t[0],s=-t[1],a=-t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=r*r+s*s+a*a+o*o;return l>0?(n[0]=(_*o+i*r+c*a-p*s)*2/l,n[1]=(c*o+i*s+p*r-_*a)*2/l,n[2]=(p*o+i*a+_*s-c*r)*2/l):(n[0]=(_*o+i*r+c*a-p*s)*2,n[1]=(c*o+i*s+p*r-_*a)*2,n[2]=(p*o+i*a+_*s-c*r)*2),sn(e,t,n),e}function Ys(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function an(e,t){var n=t[0],r=t[1],s=t[2],a=t[4],o=t[5],_=t[6],c=t[8],p=t[9],i=t[10];return e[0]=Math.hypot(n,r,s),e[1]=Math.hypot(a,o,_),e[2]=Math.hypot(c,p,i),e}function Gs(e,t){var n=new H.ARRAY_TYPE(3);an(n,t);var r=1/n[0],s=1/n[1],a=1/n[2],o=t[0]*r,_=t[1]*s,c=t[2]*a,p=t[4]*r,i=t[5]*s,l=t[6]*a,h=t[8]*r,d=t[9]*s,m=t[10]*a,f=o+i+m,u=0;return f>0?(u=Math.sqrt(f+1)*2,e[3]=.25*u,e[0]=(l-d)/u,e[1]=(h-c)/u,e[2]=(_-p)/u):o>i&&o>m?(u=Math.sqrt(1+o-i-m)*2,e[3]=(l-d)/u,e[0]=.25*u,e[1]=(_+p)/u,e[2]=(h+c)/u):i>m?(u=Math.sqrt(1+i-o-m)*2,e[3]=(h-c)/u,e[0]=(_+p)/u,e[1]=.25*u,e[2]=(l+d)/u):(u=Math.sqrt(1+m-o-i)*2,e[3]=(_-p)/u,e[0]=(h+c)/u,e[1]=(l+d)/u,e[2]=.25*u),e}function Qs(e,t,n,r){var s=t[0],a=t[1],o=t[2],_=t[3],c=s+s,p=a+a,i=o+o,l=s*c,h=s*p,d=s*i,m=a*p,f=a*i,u=o*i,g=_*c,y=_*p,w=_*i,b=r[0],M=r[1],T=r[2];return e[0]=(1-(m+u))*b,e[1]=(h+w)*b,e[2]=(d-y)*b,e[3]=0,e[4]=(h-w)*M,e[5]=(1-(l+u))*M,e[6]=(f+g)*M,e[7]=0,e[8]=(d+y)*T,e[9]=(f-g)*T,e[10]=(1-(l+m))*T,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function $s(e,t,n,r,s){var a=t[0],o=t[1],_=t[2],c=t[3],p=a+a,i=o+o,l=_+_,h=a*p,d=a*i,m=a*l,f=o*i,u=o*l,g=_*l,y=c*p,w=c*i,b=c*l,M=r[0],T=r[1],F=r[2],j=s[0],B=s[1],W=s[2],V=(1-(f+g))*M,D=(d+b)*M,k=(m-w)*M,I=(d-b)*T,ie=(1-(h+g))*T,ze=(u+y)*T,Ne=(m+w)*F,Bt=(u-y)*F,Dt=(1-(h+f))*F;return e[0]=V,e[1]=D,e[2]=k,e[3]=0,e[4]=I,e[5]=ie,e[6]=ze,e[7]=0,e[8]=Ne,e[9]=Bt,e[10]=Dt,e[11]=0,e[12]=n[0]+j-(V*j+I*B+Ne*W),e[13]=n[1]+B-(D*j+ie*B+Bt*W),e[14]=n[2]+W-(k*j+ze*B+Dt*W),e[15]=1,e}function Zs(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=n+n,_=r+r,c=s+s,p=n*o,i=r*o,l=r*_,h=s*o,d=s*_,m=s*c,f=a*o,u=a*_,g=a*c;return e[0]=1-l-m,e[1]=i+g,e[2]=h-u,e[3]=0,e[4]=i-g,e[5]=1-p-m,e[6]=d+f,e[7]=0,e[8]=h+u,e[9]=d-f,e[10]=1-p-l,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Js(e,t,n,r,s,a,o){var _=1/(n-t),c=1/(s-r),p=1/(a-o);return e[0]=a*2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*c,e[6]=0,e[7]=0,e[8]=(n+t)*_,e[9]=(s+r)*c,e[10]=(o+a)*p,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*p,e[15]=0,e}function on(e,t,n,r,s){var a=1/Math.tan(t/2),o;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=(s+r)*o,e[14]=2*s*r*o):(e[10]=-1,e[14]=-2*r),e}var Ks=on;O.perspective=Ks;function ea(e,t,n,r,s){var a=1/Math.tan(t/2),o;return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,s!=null&&s!==1/0?(o=1/(r-s),e[10]=s*o,e[14]=s*r*o):(e[10]=-1,e[14]=-r),e}function ta(e,t,n,r){var s=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),o=Math.tan(t.leftDegrees*Math.PI/180),_=Math.tan(t.rightDegrees*Math.PI/180),c=2/(o+_),p=2/(s+a);return e[0]=c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=p,e[6]=0,e[7]=0,e[8]=-((o-_)*c*.5),e[9]=(s-a)*p*.5,e[10]=r/(n-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*n/(n-r),e[15]=0,e}function ln(e,t,n,r,s,a,o){var _=1/(t-n),c=1/(r-s),p=1/(a-o);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*p,e[11]=0,e[12]=(t+n)*_,e[13]=(s+r)*c,e[14]=(o+a)*p,e[15]=1,e}var na=ln;O.ortho=na;function ra(e,t,n,r,s,a,o){var _=1/(t-n),c=1/(r-s),p=1/(a-o);return e[0]=-2*_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=p,e[11]=0,e[12]=(t+n)*_,e[13]=(s+r)*c,e[14]=a*p,e[15]=1,e}function ia(e,t,n,r){var s,a,o,_,c,p,i,l,h,d,m=t[0],f=t[1],u=t[2],g=r[0],y=r[1],w=r[2],b=n[0],M=n[1],T=n[2];return Math.abs(m-b)<H.EPSILON&&Math.abs(f-M)<H.EPSILON&&Math.abs(u-T)<H.EPSILON?nn(e):(i=m-b,l=f-M,h=u-T,d=1/Math.hypot(i,l,h),i*=d,l*=d,h*=d,s=y*h-w*l,a=w*i-g*h,o=g*l-y*i,d=Math.hypot(s,a,o),d?(d=1/d,s*=d,a*=d,o*=d):(s=0,a=0,o=0),_=l*o-h*a,c=h*s-i*o,p=i*a-l*s,d=Math.hypot(_,c,p),d?(d=1/d,_*=d,c*=d,p*=d):(_=0,c=0,p=0),e[0]=s,e[1]=_,e[2]=i,e[3]=0,e[4]=a,e[5]=c,e[6]=l,e[7]=0,e[8]=o,e[9]=p,e[10]=h,e[11]=0,e[12]=-(s*m+a*f+o*u),e[13]=-(_*m+c*f+p*u),e[14]=-(i*m+l*f+h*u),e[15]=1,e)}function sa(e,t,n,r){var s=t[0],a=t[1],o=t[2],_=r[0],c=r[1],p=r[2],i=s-n[0],l=a-n[1],h=o-n[2],d=i*i+l*l+h*h;d>0&&(d=1/Math.sqrt(d),i*=d,l*=d,h*=d);var m=c*h-p*l,f=p*i-_*h,u=_*l-c*i;return d=m*m+f*f+u*u,d>0&&(d=1/Math.sqrt(d),m*=d,f*=d,u*=d),e[0]=m,e[1]=f,e[2]=u,e[3]=0,e[4]=l*u-h*f,e[5]=h*m-i*u,e[6]=i*f-l*m,e[7]=0,e[8]=i,e[9]=l,e[10]=h,e[11]=0,e[12]=s,e[13]=a,e[14]=o,e[15]=1,e}function aa(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function oa(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function la(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e[8]=t[8]+n[8],e[9]=t[9]+n[9],e[10]=t[10]+n[10],e[11]=t[11]+n[11],e[12]=t[12]+n[12],e[13]=t[13]+n[13],e[14]=t[14]+n[14],e[15]=t[15]+n[15],e}function cn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e[4]=t[4]-n[4],e[5]=t[5]-n[5],e[6]=t[6]-n[6],e[7]=t[7]-n[7],e[8]=t[8]-n[8],e[9]=t[9]-n[9],e[10]=t[10]-n[10],e[11]=t[11]-n[11],e[12]=t[12]-n[12],e[13]=t[13]-n[13],e[14]=t[14]-n[14],e[15]=t[15]-n[15],e}function ca(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12]*n,e[13]=t[13]*n,e[14]=t[14]*n,e[15]=t[15]*n,e}function _a(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e[4]=t[4]+n[4]*r,e[5]=t[5]+n[5]*r,e[6]=t[6]+n[6]*r,e[7]=t[7]+n[7]*r,e[8]=t[8]+n[8]*r,e[9]=t[9]+n[9]*r,e[10]=t[10]+n[10]*r,e[11]=t[11]+n[11]*r,e[12]=t[12]+n[12]*r,e[13]=t[13]+n[13]*r,e[14]=t[14]+n[14]*r,e[15]=t[15]+n[15]*r,e}function ha(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function pa(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],_=e[5],c=e[6],p=e[7],i=e[8],l=e[9],h=e[10],d=e[11],m=e[12],f=e[13],u=e[14],g=e[15],y=t[0],w=t[1],b=t[2],M=t[3],T=t[4],F=t[5],j=t[6],B=t[7],W=t[8],V=t[9],D=t[10],k=t[11],I=t[12],ie=t[13],ze=t[14],Ne=t[15];return Math.abs(n-y)<=H.EPSILON*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-w)<=H.EPSILON*Math.max(1,Math.abs(r),Math.abs(w))&&Math.abs(s-b)<=H.EPSILON*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-M)<=H.EPSILON*Math.max(1,Math.abs(a),Math.abs(M))&&Math.abs(o-T)<=H.EPSILON*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(_-F)<=H.EPSILON*Math.max(1,Math.abs(_),Math.abs(F))&&Math.abs(c-j)<=H.EPSILON*Math.max(1,Math.abs(c),Math.abs(j))&&Math.abs(p-B)<=H.EPSILON*Math.max(1,Math.abs(p),Math.abs(B))&&Math.abs(i-W)<=H.EPSILON*Math.max(1,Math.abs(i),Math.abs(W))&&Math.abs(l-V)<=H.EPSILON*Math.max(1,Math.abs(l),Math.abs(V))&&Math.abs(h-D)<=H.EPSILON*Math.max(1,Math.abs(h),Math.abs(D))&&Math.abs(d-k)<=H.EPSILON*Math.max(1,Math.abs(d),Math.abs(k))&&Math.abs(m-I)<=H.EPSILON*Math.max(1,Math.abs(m),Math.abs(I))&&Math.abs(f-ie)<=H.EPSILON*Math.max(1,Math.abs(f),Math.abs(ie))&&Math.abs(u-ze)<=H.EPSILON*Math.max(1,Math.abs(u),Math.abs(ze))&&Math.abs(g-Ne)<=H.EPSILON*Math.max(1,Math.abs(g),Math.abs(Ne))}var da=rn;O.mul=da;var ua=cn;O.sub=ua});var wt=U(S=>{"use strict";function rt(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?rt=function(n){return typeof n}:rt=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},rt(e)}Object.defineProperty(S,"__esModule",{value:!0});S.create=hn;S.clone=fa;S.length=pn;S.fromValues=ga;S.copy=va;S.set=ya;S.add=wa;S.subtract=dn;S.multiply=un;S.divide=mn;S.ceil=ba;S.floor=xa;S.min=Ma;S.max=Ta;S.round=Aa;S.scale=Sa;S.scaleAndAdd=Oa;S.distance=fn;S.squaredDistance=gn;S.squaredLength=vn;S.negate=Pa;S.inverse=ja;S.normalize=Ca;S.dot=yn;S.cross=La;S.lerp=Ia;S.hermite=Ra;S.bezier=Ea;S.random=Fa;S.transformMat4=ka;S.transformMat3=Wa;S.transformQuat=Ba;S.rotateX=Da;S.rotateY=qa;S.rotateZ=za;S.angle=Na;S.zero=Va;S.str=Ha;S.exactEquals=Ua;S.equals=Xa;S.forEach=S.sqrLen=S.len=S.sqrDist=S.dist=S.div=S.mul=S.sub=void 0;var de=ma(se());function _n(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(_n=function(s){return s?n:t})(e)}function ma(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||rt(e)!=="object"&&typeof e!="function")return{default:e};var n=_n(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function hn(){var e=new de.ARRAY_TYPE(3);return de.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function fa(e){var t=new de.ARRAY_TYPE(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pn(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)}function ga(e,t,n){var r=new de.ARRAY_TYPE(3);return r[0]=e,r[1]=t,r[2]=n,r}function va(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function ya(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function wa(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function dn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function un(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e}function mn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e}function ba(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function xa(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function Ma(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e}function Ta(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e}function Aa(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e}function Sa(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Oa(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function fn(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return Math.hypot(n,r,s)}function gn(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2];return n*n+r*r+s*s}function vn(e){var t=e[0],n=e[1],r=e[2];return t*t+n*n+r*r}function Pa(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function ja(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function Ca(e,t){var n=t[0],r=t[1],s=t[2],a=n*n+r*r+s*s;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function yn(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function La(e,t,n){var r=t[0],s=t[1],a=t[2],o=n[0],_=n[1],c=n[2];return e[0]=s*c-a*_,e[1]=a*o-r*c,e[2]=r*_-s*o,e}function Ia(e,t,n,r){var s=t[0],a=t[1],o=t[2];return e[0]=s+r*(n[0]-s),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e}function Ra(e,t,n,r,s,a){var o=a*a,_=o*(2*a-3)+1,c=o*(a-2)+a,p=o*(a-1),i=o*(3-2*a);return e[0]=t[0]*_+n[0]*c+r[0]*p+s[0]*i,e[1]=t[1]*_+n[1]*c+r[1]*p+s[1]*i,e[2]=t[2]*_+n[2]*c+r[2]*p+s[2]*i,e}function Ea(e,t,n,r,s,a){var o=1-a,_=o*o,c=a*a,p=_*o,i=3*a*_,l=3*c*o,h=c*a;return e[0]=t[0]*p+n[0]*i+r[0]*l+s[0]*h,e[1]=t[1]*p+n[1]*i+r[1]*l+s[1]*h,e[2]=t[2]*p+n[2]*i+r[2]*l+s[2]*h,e}function Fa(e,t){t=t||1;var n=de.RANDOM()*2*Math.PI,r=de.RANDOM()*2-1,s=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(n)*s,e[1]=Math.sin(n)*s,e[2]=r*t,e}function ka(e,t,n){var r=t[0],s=t[1],a=t[2],o=n[3]*r+n[7]*s+n[11]*a+n[15];return o=o||1,e[0]=(n[0]*r+n[4]*s+n[8]*a+n[12])/o,e[1]=(n[1]*r+n[5]*s+n[9]*a+n[13])/o,e[2]=(n[2]*r+n[6]*s+n[10]*a+n[14])/o,e}function Wa(e,t,n){var r=t[0],s=t[1],a=t[2];return e[0]=r*n[0]+s*n[3]+a*n[6],e[1]=r*n[1]+s*n[4]+a*n[7],e[2]=r*n[2]+s*n[5]+a*n[8],e}function Ba(e,t,n){var r=n[0],s=n[1],a=n[2],o=n[3],_=t[0],c=t[1],p=t[2],i=s*p-a*c,l=a*_-r*p,h=r*c-s*_,d=s*h-a*l,m=a*i-r*h,f=r*l-s*i,u=o*2;return i*=u,l*=u,h*=u,d*=2,m*=2,f*=2,e[0]=_+i+d,e[1]=c+l+m,e[2]=p+h+f,e}function Da(e,t,n,r){var s=[],a=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],a[0]=s[0],a[1]=s[1]*Math.cos(r)-s[2]*Math.sin(r),a[2]=s[1]*Math.sin(r)+s[2]*Math.cos(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function qa(e,t,n,r){var s=[],a=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],a[0]=s[2]*Math.sin(r)+s[0]*Math.cos(r),a[1]=s[1],a[2]=s[2]*Math.cos(r)-s[0]*Math.sin(r),e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function za(e,t,n,r){var s=[],a=[];return s[0]=t[0]-n[0],s[1]=t[1]-n[1],s[2]=t[2]-n[2],a[0]=s[0]*Math.cos(r)-s[1]*Math.sin(r),a[1]=s[0]*Math.sin(r)+s[1]*Math.cos(r),a[2]=s[2],e[0]=a[0]+n[0],e[1]=a[1]+n[1],e[2]=a[2]+n[2],e}function Na(e,t){var n=e[0],r=e[1],s=e[2],a=t[0],o=t[1],_=t[2],c=Math.sqrt(n*n+r*r+s*s),p=Math.sqrt(a*a+o*o+_*_),i=c*p,l=i&&yn(e,t)/i;return Math.acos(Math.min(Math.max(l,-1),1))}function Va(e){return e[0]=0,e[1]=0,e[2]=0,e}function Ha(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function Ua(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function Xa(e,t){var n=e[0],r=e[1],s=e[2],a=t[0],o=t[1],_=t[2];return Math.abs(n-a)<=de.EPSILON*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(r-o)<=de.EPSILON*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-_)<=de.EPSILON*Math.max(1,Math.abs(s),Math.abs(_))}var Ya=dn;S.sub=Ya;var Ga=un;S.mul=Ga;var Qa=mn;S.div=Qa;var $a=fn;S.dist=$a;var Za=gn;S.sqrDist=Za;var Ja=pn;S.len=Ja;var Ka=vn;S.sqrLen=Ka;var eo=function(){var e=hn();return function(t,n,r,s,a,o){var _,c;for(n||(n=3),r||(r=0),s?c=Math.min(s*n+r,t.length):c=t.length,_=r;_<c;_+=n)e[0]=t[_],e[1]=t[_+1],e[2]=t[_+2],a(e,e,o),t[_]=e[0],t[_+1]=e[1],t[_+2]=e[2];return t}}();S.forEach=eo});var bt=U(C=>{"use strict";function it(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?it=function(n){return typeof n}:it=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},it(e)}Object.defineProperty(C,"__esModule",{value:!0});C.create=bn;C.clone=no;C.fromValues=ro;C.copy=io;C.set=so;C.add=ao;C.subtract=xn;C.multiply=Mn;C.divide=Tn;C.ceil=oo;C.floor=lo;C.min=co;C.max=_o;C.round=ho;C.scale=po;C.scaleAndAdd=uo;C.distance=An;C.squaredDistance=Sn;C.length=On;C.squaredLength=Pn;C.negate=mo;C.inverse=fo;C.normalize=go;C.dot=vo;C.cross=yo;C.lerp=wo;C.random=bo;C.transformMat4=xo;C.transformQuat=Mo;C.zero=To;C.str=Ao;C.exactEquals=So;C.equals=Oo;C.forEach=C.sqrLen=C.len=C.sqrDist=C.dist=C.div=C.mul=C.sub=void 0;var re=to(se());function wn(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(wn=function(s){return s?n:t})(e)}function to(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||it(e)!=="object"&&typeof e!="function")return{default:e};var n=wn(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function bn(){var e=new re.ARRAY_TYPE(4);return re.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function no(e){var t=new re.ARRAY_TYPE(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function ro(e,t,n,r){var s=new re.ARRAY_TYPE(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=r,s}function io(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function so(e,t,n,r,s){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e}function ao(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e}function xn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e[3]=t[3]-n[3],e}function Mn(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}function Tn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e[3]=t[3]/n[3],e}function oo(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function lo(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function co(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e[2]=Math.min(t[2],n[2]),e[3]=Math.min(t[3],n[3]),e}function _o(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e[2]=Math.max(t[2],n[2]),e[3]=Math.max(t[3],n[3]),e}function ho(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e[2]=Math.round(t[2]),e[3]=Math.round(t[3]),e}function po(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e}function uo(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e[3]=t[3]+n[3]*r,e}function An(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],a=t[3]-e[3];return Math.hypot(n,r,s,a)}function Sn(e,t){var n=t[0]-e[0],r=t[1]-e[1],s=t[2]-e[2],a=t[3]-e[3];return n*n+r*r+s*s+a*a}function On(e){var t=e[0],n=e[1],r=e[2],s=e[3];return Math.hypot(t,n,r,s)}function Pn(e){var t=e[0],n=e[1],r=e[2],s=e[3];return t*t+n*n+r*r+s*s}function mo(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function fo(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function go(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=n*n+r*r+s*s+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=s*o,e[3]=a*o,e}function vo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function yo(e,t,n,r){var s=n[0]*r[1]-n[1]*r[0],a=n[0]*r[2]-n[2]*r[0],o=n[0]*r[3]-n[3]*r[0],_=n[1]*r[2]-n[2]*r[1],c=n[1]*r[3]-n[3]*r[1],p=n[2]*r[3]-n[3]*r[2],i=t[0],l=t[1],h=t[2],d=t[3];return e[0]=l*p-h*c+d*_,e[1]=-(i*p)+h*o-d*a,e[2]=i*c-l*o+d*s,e[3]=-(i*_)+l*a-h*s,e}function wo(e,t,n,r){var s=t[0],a=t[1],o=t[2],_=t[3];return e[0]=s+r*(n[0]-s),e[1]=a+r*(n[1]-a),e[2]=o+r*(n[2]-o),e[3]=_+r*(n[3]-_),e}function bo(e,t){t=t||1;var n,r,s,a,o,_;do n=re.RANDOM()*2-1,r=re.RANDOM()*2-1,o=n*n+r*r;while(o>=1);do s=re.RANDOM()*2-1,a=re.RANDOM()*2-1,_=s*s+a*a;while(_>=1);var c=Math.sqrt((1-o)/_);return e[0]=t*n,e[1]=t*r,e[2]=t*s*c,e[3]=t*a*c,e}function xo(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*s+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*s+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*s+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*s+n[11]*a+n[15]*o,e}function Mo(e,t,n){var r=t[0],s=t[1],a=t[2],o=n[0],_=n[1],c=n[2],p=n[3],i=p*r+_*a-c*s,l=p*s+c*r-o*a,h=p*a+o*s-_*r,d=-o*r-_*s-c*a;return e[0]=i*p+d*-o+l*-c-h*-_,e[1]=l*p+d*-_+h*-o-i*-c,e[2]=h*p+d*-c+i*-_-l*-o,e[3]=t[3],e}function To(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function Ao(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function So(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function Oo(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=t[0],_=t[1],c=t[2],p=t[3];return Math.abs(n-o)<=re.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-_)<=re.EPSILON*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(s-c)<=re.EPSILON*Math.max(1,Math.abs(s),Math.abs(c))&&Math.abs(a-p)<=re.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))}var Po=xn;C.sub=Po;var jo=Mn;C.mul=jo;var Co=Tn;C.div=Co;var Lo=An;C.dist=Lo;var Io=Sn;C.sqrDist=Io;var Ro=On;C.len=Ro;var Eo=Pn;C.sqrLen=Eo;var Fo=function(){var e=bn();return function(t,n,r,s,a,o){var _,c;for(n||(n=4),r||(r=0),s?c=Math.min(s*n+r,t.length):c=t.length,_=r;_<c;_+=n)e[0]=t[_],e[1]=t[_+1],e[2]=t[_+2],e[3]=t[_+3],a(e,e,o),t[_]=e[0],t[_+1]=e[1],t[_+2]=e[2],t[_+3]=e[3];return t}}();C.forEach=Fo});var Tt=U(A=>{"use strict";function st(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?st=function(n){return typeof n}:st=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},st(e)}Object.defineProperty(A,"__esModule",{value:!0});A.create=xt;A.identity=Wo;A.setAxisAngle=Cn;A.getAxisAngle=Bo;A.getAngle=Do;A.multiply=Ln;A.rotateX=qo;A.rotateY=zo;A.rotateZ=No;A.calculateW=Vo;A.exp=In;A.ln=Rn;A.pow=Ho;A.slerp=at;A.random=Uo;A.invert=Xo;A.conjugate=Yo;A.fromMat3=En;A.fromEuler=Go;A.str=Qo;A.setAxes=A.sqlerp=A.rotationTo=A.equals=A.exactEquals=A.normalize=A.sqrLen=A.squaredLength=A.len=A.length=A.lerp=A.dot=A.scale=A.mul=A.add=A.set=A.copy=A.fromValues=A.clone=void 0;var Te=ot(se()),ko=ot(vt()),ue=ot(wt()),te=ot(bt());function jn(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(jn=function(s){return s?n:t})(e)}function ot(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||st(e)!=="object"&&typeof e!="function")return{default:e};var n=jn(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function xt(){var e=new Te.ARRAY_TYPE(4);return Te.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Wo(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Cn(e,t,n){n=n*.5;var r=Math.sin(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Math.cos(n),e}function Bo(e,t){var n=Math.acos(t[3])*2,r=Math.sin(n/2);return r>Te.EPSILON?(e[0]=t[0]/r,e[1]=t[1]/r,e[2]=t[2]/r):(e[0]=1,e[1]=0,e[2]=0),n}function Do(e,t){var n=kn(e,t);return Math.acos(2*n*n-1)}function Ln(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[0],c=n[1],p=n[2],i=n[3];return e[0]=r*i+o*_+s*p-a*c,e[1]=s*i+o*c+a*_-r*p,e[2]=a*i+o*p+r*c-s*_,e[3]=o*i-r*_-s*c-a*p,e}function qo(e,t,n){n*=.5;var r=t[0],s=t[1],a=t[2],o=t[3],_=Math.sin(n),c=Math.cos(n);return e[0]=r*c+o*_,e[1]=s*c+a*_,e[2]=a*c-s*_,e[3]=o*c-r*_,e}function zo(e,t,n){n*=.5;var r=t[0],s=t[1],a=t[2],o=t[3],_=Math.sin(n),c=Math.cos(n);return e[0]=r*c-a*_,e[1]=s*c+o*_,e[2]=a*c+r*_,e[3]=o*c-s*_,e}function No(e,t,n){n*=.5;var r=t[0],s=t[1],a=t[2],o=t[3],_=Math.sin(n),c=Math.cos(n);return e[0]=r*c+s*_,e[1]=s*c-r*_,e[2]=a*c+o*_,e[3]=o*c-a*_,e}function Vo(e,t){var n=t[0],r=t[1],s=t[2];return e[0]=n,e[1]=r,e[2]=s,e[3]=Math.sqrt(Math.abs(1-n*n-r*r-s*s)),e}function In(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=Math.sqrt(n*n+r*r+s*s),_=Math.exp(a),c=o>0?_*Math.sin(o)/o:0;return e[0]=n*c,e[1]=r*c,e[2]=s*c,e[3]=_*Math.cos(o),e}function Rn(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=Math.sqrt(n*n+r*r+s*s),_=o>0?Math.atan2(o,a)/o:0;return e[0]=n*_,e[1]=r*_,e[2]=s*_,e[3]=.5*Math.log(n*n+r*r+s*s+a*a),e}function Ho(e,t,n){return Rn(e,t),Fn(e,e,n),In(e,e),e}function at(e,t,n,r){var s=t[0],a=t[1],o=t[2],_=t[3],c=n[0],p=n[1],i=n[2],l=n[3],h,d,m,f,u;return d=s*c+a*p+o*i+_*l,d<0&&(d=-d,c=-c,p=-p,i=-i,l=-l),1-d>Te.EPSILON?(h=Math.acos(d),m=Math.sin(h),f=Math.sin((1-r)*h)/m,u=Math.sin(r*h)/m):(f=1-r,u=r),e[0]=f*s+u*c,e[1]=f*a+u*p,e[2]=f*o+u*i,e[3]=f*_+u*l,e}function Uo(e){var t=Te.RANDOM(),n=Te.RANDOM(),r=Te.RANDOM(),s=Math.sqrt(1-t),a=Math.sqrt(t);return e[0]=s*Math.sin(2*Math.PI*n),e[1]=s*Math.cos(2*Math.PI*n),e[2]=a*Math.sin(2*Math.PI*r),e[3]=a*Math.cos(2*Math.PI*r),e}function Xo(e,t){var n=t[0],r=t[1],s=t[2],a=t[3],o=n*n+r*r+s*s+a*a,_=o?1/o:0;return e[0]=-n*_,e[1]=-r*_,e[2]=-s*_,e[3]=a*_,e}function Yo(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e}function En(e,t){var n=t[0]+t[4]+t[8],r;if(n>0)r=Math.sqrt(n+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{var s=0;t[4]>t[0]&&(s=1),t[8]>t[s*3+s]&&(s=2);var a=(s+1)%3,o=(s+2)%3;r=Math.sqrt(t[s*3+s]-t[a*3+a]-t[o*3+o]+1),e[s]=.5*r,r=.5/r,e[3]=(t[a*3+o]-t[o*3+a])*r,e[a]=(t[a*3+s]+t[s*3+a])*r,e[o]=(t[o*3+s]+t[s*3+o])*r}return e}function Go(e,t,n,r){var s=.5*Math.PI/180;t*=s,n*=s,r*=s;var a=Math.sin(t),o=Math.cos(t),_=Math.sin(n),c=Math.cos(n),p=Math.sin(r),i=Math.cos(r);return e[0]=a*c*i-o*_*p,e[1]=o*_*i+a*c*p,e[2]=o*c*p-a*_*i,e[3]=o*c*i+a*_*p,e}function Qo(e){return"quat("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}var $o=te.clone;A.clone=$o;var Zo=te.fromValues;A.fromValues=Zo;var Jo=te.copy;A.copy=Jo;var Ko=te.set;A.set=Ko;var el=te.add;A.add=el;var tl=Ln;A.mul=tl;var Fn=te.scale;A.scale=Fn;var kn=te.dot;A.dot=kn;var nl=te.lerp;A.lerp=nl;var Wn=te.length;A.length=Wn;var rl=Wn;A.len=rl;var Bn=te.squaredLength;A.squaredLength=Bn;var il=Bn;A.sqrLen=il;var Mt=te.normalize;A.normalize=Mt;var sl=te.exactEquals;A.exactEquals=sl;var al=te.equals;A.equals=al;var ol=function(){var e=ue.create(),t=ue.fromValues(1,0,0),n=ue.fromValues(0,1,0);return function(r,s,a){var o=ue.dot(s,a);return o<-.999999?(ue.cross(e,t,s),ue.len(e)<1e-6&&ue.cross(e,n,s),ue.normalize(e,e),Cn(r,e,Math.PI),r):o>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ue.cross(e,s,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+o,Mt(r,r))}}();A.rotationTo=ol;var ll=function(){var e=xt(),t=xt();return function(n,r,s,a,o,_){return at(e,r,o,_),at(t,s,a,_),at(n,e,t,2*_*(1-_)),n}}();A.sqlerp=ll;var cl=function(){var e=ko.create();return function(t,n,r,s){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=s[0],e[4]=s[1],e[7]=s[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Mt(t,En(t,e))}}();A.setAxes=cl});var Xn=U(L=>{"use strict";function lt(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?lt=function(n){return typeof n}:lt=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},lt(e)}Object.defineProperty(L,"__esModule",{value:!0});L.create=_l;L.clone=hl;L.fromValues=pl;L.fromRotationTranslationValues=dl;L.fromRotationTranslation=zn;L.fromTranslation=ul;L.fromRotation=ml;L.fromMat4=fl;L.copy=Nn;L.identity=gl;L.set=vl;L.getDual=wl;L.setDual=xl;L.getTranslation=Ml;L.translate=Tl;L.rotateX=Al;L.rotateY=Sl;L.rotateZ=Ol;L.rotateByQuatAppend=Pl;L.rotateByQuatPrepend=jl;L.rotateAroundAxis=Cl;L.add=Ll;L.multiply=Vn;L.scale=Rl;L.lerp=El;L.invert=Fl;L.conjugate=kl;L.normalize=Dl;L.str=ql;L.exactEquals=zl;L.equals=Nl;L.sqrLen=L.squaredLength=L.len=L.length=L.dot=L.mul=L.setReal=L.getReal=void 0;var $=At(se()),me=At(Tt()),Dn=At(yt());function qn(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(qn=function(s){return s?n:t})(e)}function At(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||lt(e)!=="object"&&typeof e!="function")return{default:e};var n=qn(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function _l(){var e=new $.ARRAY_TYPE(8);return $.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0),e[3]=1,e}function hl(e){var t=new $.ARRAY_TYPE(8);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function pl(e,t,n,r,s,a,o,_){var c=new $.ARRAY_TYPE(8);return c[0]=e,c[1]=t,c[2]=n,c[3]=r,c[4]=s,c[5]=a,c[6]=o,c[7]=_,c}function dl(e,t,n,r,s,a,o){var _=new $.ARRAY_TYPE(8);_[0]=e,_[1]=t,_[2]=n,_[3]=r;var c=s*.5,p=a*.5,i=o*.5;return _[4]=c*r+p*n-i*t,_[5]=p*r+i*e-c*n,_[6]=i*r+c*t-p*e,_[7]=-c*e-p*t-i*n,_}function zn(e,t,n){var r=n[0]*.5,s=n[1]*.5,a=n[2]*.5,o=t[0],_=t[1],c=t[2],p=t[3];return e[0]=o,e[1]=_,e[2]=c,e[3]=p,e[4]=r*p+s*c-a*_,e[5]=s*p+a*o-r*c,e[6]=a*p+r*_-s*o,e[7]=-r*o-s*_-a*c,e}function ul(e,t){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=t[0]*.5,e[5]=t[1]*.5,e[6]=t[2]*.5,e[7]=0,e}function ml(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function fl(e,t){var n=me.create();Dn.getRotation(n,t);var r=new $.ARRAY_TYPE(3);return Dn.getTranslation(r,t),zn(e,n,r),e}function Nn(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function gl(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e}function vl(e,t,n,r,s,a,o,_,c){return e[0]=t,e[1]=n,e[2]=r,e[3]=s,e[4]=a,e[5]=o,e[6]=_,e[7]=c,e}var yl=me.copy;L.getReal=yl;function wl(e,t){return e[0]=t[4],e[1]=t[5],e[2]=t[6],e[3]=t[7],e}var bl=me.copy;L.setReal=bl;function xl(e,t){return e[4]=t[0],e[5]=t[1],e[6]=t[2],e[7]=t[3],e}function Ml(e,t){var n=t[4],r=t[5],s=t[6],a=t[7],o=-t[0],_=-t[1],c=-t[2],p=t[3];return e[0]=(n*p+a*o+r*c-s*_)*2,e[1]=(r*p+a*_+s*o-n*c)*2,e[2]=(s*p+a*c+n*_-r*o)*2,e}function Tl(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[0]*.5,c=n[1]*.5,p=n[2]*.5,i=t[4],l=t[5],h=t[6],d=t[7];return e[0]=r,e[1]=s,e[2]=a,e[3]=o,e[4]=o*_+s*p-a*c+i,e[5]=o*c+a*_-r*p+l,e[6]=o*p+r*c-s*_+h,e[7]=-r*_-s*c-a*p+d,e}function Al(e,t,n){var r=-t[0],s=-t[1],a=-t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=_*o+i*r+c*a-p*s,h=c*o+i*s+p*r-_*a,d=p*o+i*a+_*s-c*r,m=i*o-_*r-c*s-p*a;return me.rotateX(e,t,n),r=e[0],s=e[1],a=e[2],o=e[3],e[4]=l*o+m*r+h*a-d*s,e[5]=h*o+m*s+d*r-l*a,e[6]=d*o+m*a+l*s-h*r,e[7]=m*o-l*r-h*s-d*a,e}function Sl(e,t,n){var r=-t[0],s=-t[1],a=-t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=_*o+i*r+c*a-p*s,h=c*o+i*s+p*r-_*a,d=p*o+i*a+_*s-c*r,m=i*o-_*r-c*s-p*a;return me.rotateY(e,t,n),r=e[0],s=e[1],a=e[2],o=e[3],e[4]=l*o+m*r+h*a-d*s,e[5]=h*o+m*s+d*r-l*a,e[6]=d*o+m*a+l*s-h*r,e[7]=m*o-l*r-h*s-d*a,e}function Ol(e,t,n){var r=-t[0],s=-t[1],a=-t[2],o=t[3],_=t[4],c=t[5],p=t[6],i=t[7],l=_*o+i*r+c*a-p*s,h=c*o+i*s+p*r-_*a,d=p*o+i*a+_*s-c*r,m=i*o-_*r-c*s-p*a;return me.rotateZ(e,t,n),r=e[0],s=e[1],a=e[2],o=e[3],e[4]=l*o+m*r+h*a-d*s,e[5]=h*o+m*s+d*r-l*a,e[6]=d*o+m*a+l*s-h*r,e[7]=m*o-l*r-h*s-d*a,e}function Pl(e,t,n){var r=n[0],s=n[1],a=n[2],o=n[3],_=t[0],c=t[1],p=t[2],i=t[3];return e[0]=_*o+i*r+c*a-p*s,e[1]=c*o+i*s+p*r-_*a,e[2]=p*o+i*a+_*s-c*r,e[3]=i*o-_*r-c*s-p*a,_=t[4],c=t[5],p=t[6],i=t[7],e[4]=_*o+i*r+c*a-p*s,e[5]=c*o+i*s+p*r-_*a,e[6]=p*o+i*a+_*s-c*r,e[7]=i*o-_*r-c*s-p*a,e}function jl(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[0],c=n[1],p=n[2],i=n[3];return e[0]=r*i+o*_+s*p-a*c,e[1]=s*i+o*c+a*_-r*p,e[2]=a*i+o*p+r*c-s*_,e[3]=o*i-r*_-s*c-a*p,_=n[4],c=n[5],p=n[6],i=n[7],e[4]=r*i+o*_+s*p-a*c,e[5]=s*i+o*c+a*_-r*p,e[6]=a*i+o*p+r*c-s*_,e[7]=o*i-r*_-s*c-a*p,e}function Cl(e,t,n,r){if(Math.abs(r)<$.EPSILON)return Nn(e,t);var s=Math.hypot(n[0],n[1],n[2]);r=r*.5;var a=Math.sin(r),o=a*n[0]/s,_=a*n[1]/s,c=a*n[2]/s,p=Math.cos(r),i=t[0],l=t[1],h=t[2],d=t[3];e[0]=i*p+d*o+l*c-h*_,e[1]=l*p+d*_+h*o-i*c,e[2]=h*p+d*c+i*_-l*o,e[3]=d*p-i*o-l*_-h*c;var m=t[4],f=t[5],u=t[6],g=t[7];return e[4]=m*p+g*o+f*c-u*_,e[5]=f*p+g*_+u*o-m*c,e[6]=u*p+g*c+m*_-f*o,e[7]=g*p-m*o-f*_-u*c,e}function Ll(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e[3]=t[3]+n[3],e[4]=t[4]+n[4],e[5]=t[5]+n[5],e[6]=t[6]+n[6],e[7]=t[7]+n[7],e}function Vn(e,t,n){var r=t[0],s=t[1],a=t[2],o=t[3],_=n[4],c=n[5],p=n[6],i=n[7],l=t[4],h=t[5],d=t[6],m=t[7],f=n[0],u=n[1],g=n[2],y=n[3];return e[0]=r*y+o*f+s*g-a*u,e[1]=s*y+o*u+a*f-r*g,e[2]=a*y+o*g+r*u-s*f,e[3]=o*y-r*f-s*u-a*g,e[4]=r*i+o*_+s*p-a*c+l*y+m*f+h*g-d*u,e[5]=s*i+o*c+a*_-r*p+h*y+m*u+d*f-l*g,e[6]=a*i+o*p+r*c-s*_+d*y+m*g+l*u-h*f,e[7]=o*i-r*_-s*c-a*p+m*y-l*f-h*u-d*g,e}var Il=Vn;L.mul=Il;function Rl(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e}var Hn=me.dot;L.dot=Hn;function El(e,t,n,r){var s=1-r;return Hn(t,n)<0&&(r=-r),e[0]=t[0]*s+n[0]*r,e[1]=t[1]*s+n[1]*r,e[2]=t[2]*s+n[2]*r,e[3]=t[3]*s+n[3]*r,e[4]=t[4]*s+n[4]*r,e[5]=t[5]*s+n[5]*r,e[6]=t[6]*s+n[6]*r,e[7]=t[7]*s+n[7]*r,e}function Fl(e,t){var n=ct(t);return e[0]=-t[0]/n,e[1]=-t[1]/n,e[2]=-t[2]/n,e[3]=t[3]/n,e[4]=-t[4]/n,e[5]=-t[5]/n,e[6]=-t[6]/n,e[7]=t[7]/n,e}function kl(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e[4]=-t[4],e[5]=-t[5],e[6]=-t[6],e[7]=t[7],e}var Un=me.length;L.length=Un;var Wl=Un;L.len=Wl;var ct=me.squaredLength;L.squaredLength=ct;var Bl=ct;L.sqrLen=Bl;function Dl(e,t){var n=ct(t);if(n>0){n=Math.sqrt(n);var r=t[0]/n,s=t[1]/n,a=t[2]/n,o=t[3]/n,_=t[4],c=t[5],p=t[6],i=t[7],l=r*_+s*c+a*p+o*i;e[0]=r,e[1]=s,e[2]=a,e[3]=o,e[4]=(_-r*l)/n,e[5]=(c-s*l)/n,e[6]=(p-a*l)/n,e[7]=(i-o*l)/n}return e}function ql(e){return"quat2("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+")"}function zl(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]}function Nl(e,t){var n=e[0],r=e[1],s=e[2],a=e[3],o=e[4],_=e[5],c=e[6],p=e[7],i=t[0],l=t[1],h=t[2],d=t[3],m=t[4],f=t[5],u=t[6],g=t[7];return Math.abs(n-i)<=$.EPSILON*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-l)<=$.EPSILON*Math.max(1,Math.abs(r),Math.abs(l))&&Math.abs(s-h)<=$.EPSILON*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(a-d)<=$.EPSILON*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-m)<=$.EPSILON*Math.max(1,Math.abs(o),Math.abs(m))&&Math.abs(_-f)<=$.EPSILON*Math.max(1,Math.abs(_),Math.abs(f))&&Math.abs(c-u)<=$.EPSILON*Math.max(1,Math.abs(c),Math.abs(u))&&Math.abs(p-g)<=$.EPSILON*Math.max(1,Math.abs(p),Math.abs(g))}});var nr=U(P=>{"use strict";function _t(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_t=function(n){return typeof n}:_t=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},_t(e)}Object.defineProperty(P,"__esModule",{value:!0});P.create=Gn;P.clone=Hl;P.fromValues=Ul;P.copy=Xl;P.set=Yl;P.add=Gl;P.subtract=Qn;P.multiply=$n;P.divide=Zn;P.ceil=Ql;P.floor=$l;P.min=Zl;P.max=Jl;P.round=Kl;P.scale=ec;P.scaleAndAdd=tc;P.distance=Jn;P.squaredDistance=Kn;P.length=er;P.squaredLength=tr;P.negate=nc;P.inverse=rc;P.normalize=ic;P.dot=sc;P.cross=ac;P.lerp=oc;P.random=lc;P.transformMat2=cc;P.transformMat2d=_c;P.transformMat3=hc;P.transformMat4=pc;P.rotate=dc;P.angle=uc;P.zero=mc;P.str=fc;P.exactEquals=gc;P.equals=vc;P.forEach=P.sqrLen=P.sqrDist=P.dist=P.div=P.mul=P.sub=P.len=void 0;var Ae=Vl(se());function Yn(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(Yn=function(s){return s?n:t})(e)}function Vl(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||_t(e)!=="object"&&typeof e!="function")return{default:e};var n=Yn(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}function Gn(){var e=new Ae.ARRAY_TYPE(2);return Ae.ARRAY_TYPE!=Float32Array&&(e[0]=0,e[1]=0),e}function Hl(e){var t=new Ae.ARRAY_TYPE(2);return t[0]=e[0],t[1]=e[1],t}function Ul(e,t){var n=new Ae.ARRAY_TYPE(2);return n[0]=e,n[1]=t,n}function Xl(e,t){return e[0]=t[0],e[1]=t[1],e}function Yl(e,t,n){return e[0]=t,e[1]=n,e}function Gl(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function Qn(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function $n(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e}function Zn(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e}function Ql(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function $l(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function Zl(e,t,n){return e[0]=Math.min(t[0],n[0]),e[1]=Math.min(t[1],n[1]),e}function Jl(e,t,n){return e[0]=Math.max(t[0],n[0]),e[1]=Math.max(t[1],n[1]),e}function Kl(e,t){return e[0]=Math.round(t[0]),e[1]=Math.round(t[1]),e}function ec(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function tc(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e}function Jn(e,t){var n=t[0]-e[0],r=t[1]-e[1];return Math.hypot(n,r)}function Kn(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function er(e){var t=e[0],n=e[1];return Math.hypot(t,n)}function tr(e){var t=e[0],n=e[1];return t*t+n*n}function nc(e,t){return e[0]=-t[0],e[1]=-t[1],e}function rc(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function ic(e,t){var n=t[0],r=t[1],s=n*n+r*r;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e}function sc(e,t){return e[0]*t[0]+e[1]*t[1]}function ac(e,t,n){var r=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=r,e}function oc(e,t,n,r){var s=t[0],a=t[1];return e[0]=s+r*(n[0]-s),e[1]=a+r*(n[1]-a),e}function lc(e,t){t=t||1;var n=Ae.RANDOM()*2*Math.PI;return e[0]=Math.cos(n)*t,e[1]=Math.sin(n)*t,e}function cc(e,t,n){var r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s,e[1]=n[1]*r+n[3]*s,e}function _c(e,t,n){var r=t[0],s=t[1];return e[0]=n[0]*r+n[2]*s+n[4],e[1]=n[1]*r+n[3]*s+n[5],e}function hc(e,t,n){var r=t[0],s=t[1];return e[0]=n[0]*r+n[3]*s+n[6],e[1]=n[1]*r+n[4]*s+n[7],e}function pc(e,t,n){var r=t[0],s=t[1];return e[0]=n[0]*r+n[4]*s+n[12],e[1]=n[1]*r+n[5]*s+n[13],e}function dc(e,t,n,r){var s=t[0]-n[0],a=t[1]-n[1],o=Math.sin(r),_=Math.cos(r);return e[0]=s*_-a*o+n[0],e[1]=s*o+a*_+n[1],e}function uc(e,t){var n=e[0],r=e[1],s=t[0],a=t[1],o=Math.sqrt(n*n+r*r)*Math.sqrt(s*s+a*a),_=o&&(n*s+r*a)/o;return Math.acos(Math.min(Math.max(_,-1),1))}function mc(e){return e[0]=0,e[1]=0,e}function fc(e){return"vec2("+e[0]+", "+e[1]+")"}function gc(e,t){return e[0]===t[0]&&e[1]===t[1]}function vc(e,t){var n=e[0],r=e[1],s=t[0],a=t[1];return Math.abs(n-s)<=Ae.EPSILON*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(r-a)<=Ae.EPSILON*Math.max(1,Math.abs(r),Math.abs(a))}var yc=er;P.len=yc;var wc=Qn;P.sub=wc;var bc=$n;P.mul=bc;var xc=Zn;P.div=xc;var Mc=Jn;P.dist=Mc;var Tc=Kn;P.sqrDist=Tc;var Ac=tr;P.sqrLen=Ac;var Sc=function(){var e=Gn();return function(t,n,r,s,a,o){var _,c;for(n||(n=2),r||(r=0),s?c=Math.min(s*n+r,t.length):c=t.length,_=r;_<c;_+=n)e[0]=t[_],e[1]=t[_+1],a(e,e,o),t[_]=e[0],t[_+1]=e[1];return t}}();P.forEach=Sc});var J=U(X=>{"use strict";function ht(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ht=function(n){return typeof n}:ht=function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},ht(e)}Object.defineProperty(X,"__esModule",{value:!0});X.vec4=X.vec3=X.vec2=X.quat2=X.quat=X.mat4=X.mat3=X.mat2d=X.mat2=X.glMatrix=void 0;var Oc=_e(se());X.glMatrix=Oc;var Pc=_e(Yt());X.mat2=Pc;var jc=_e(Zt());X.mat2d=jc;var Cc=_e(vt());X.mat3=Cc;var Lc=_e(yt());X.mat4=Lc;var Ic=_e(Tt());X.quat=Ic;var Rc=_e(Xn());X.quat2=Rc;var Ec=_e(nr());X.vec2=Ec;var Fc=_e(wt());X.vec3=Fc;var kc=_e(bt());X.vec4=kc;function rr(e){if(typeof WeakMap!="function")return null;var t=new WeakMap,n=new WeakMap;return(rr=function(s){return s?n:t})(e)}function _e(e,t){if(!t&&e&&e.__esModule)return e;if(e===null||ht(e)!=="object"&&typeof e!="function")return{default:e};var n=rr(t);if(n&&n.has(e))return n.get(e);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if(a!=="default"&&Object.prototype.hasOwnProperty.call(e,a)){var o=s?Object.getOwnPropertyDescriptor(e,a):null;o&&(o.get||o.set)?Object.defineProperty(r,a,o):r[a]=e[a]}return r.default=e,n&&n.set(e,r),r}});var ir=U(()=>{WL.registerComponent("8thwall-camera",{camera:{type:WL.Type.Enum,values:["auto","back","front"],default:"auto"}},{name:"wonderland-engine",init:function(){this.position=[0,0,0,0],this.rotation=[0,0,0,0],this.started=!1;let e=["auto","back","front"];this.camera=e[this.camera],this.camera=="auto"&&(this.camera="back"),this.onStart=this.onStart.bind(this),this.onUpdate=this.onUpdate.bind(this),XR8.addCameraPipelineModules([XR8.GlTextureRenderer.pipelineModule(),XR8.XrController.pipelineModule(),this]),this.camera=="back"?XR8.run({canvas:Module.canvas,ownRunLoop:!1}):this.camera=="back"?(XR8.XrController.configure({disableWorldTracking:!0}),XR8.run({canvas:Module.canvas,ownRunLoop:!1,cameraConfig:{direction:XR8.XrConfig.camera().FRONT}})):console.error("[8thwall-camera] Invalid camera setting:",this.camera)},update:function(){if(this.started){if(WL.scene.onPostRender.length==0&&(WL.scene.onPreRender.push(function(){XR8.runPreRender(Date.now()),_wl_reset_context()}),WL.scene.onPostRender.push(function(){XR8.runPostRender(Date.now())})),this.rotation[0]==0&&this.rotation[1]==0&&this.rotation[2]==0&&this.rotation[3]==0)return;this.object.resetTransform(),this.object.rotate(this.rotation),this.object.translate(this.position)}},onUpdate:function(e){if(!e.processCpuResult.reality)return;let t=e.processCpuResult.reality.rotation;this.rotation[0]=t.x,this.rotation[1]=t.y,this.rotation[2]=t.z,this.rotation[3]=t.w;let n=e.processCpuResult.reality.position;this.position[0]=n.x,this.position[1]=n.y,this.position[2]=n.z},onStart:function(){this.started=!0}})});var sr=U(()=>{WL.registerComponent("cursor-target",{},{init:function(){this.hoverFunctions=[],this.unHoverFunctions=[],this.clickFunctions=[],this.moveFunctions=[],this.downFunctions=[],this.upFunctions=[]},onHover:function(e,t){for(let n of this.hoverFunctions)n(e,t)},onUnhover:function(e,t){for(let n of this.unHoverFunctions)n(e,t)},onClick:function(e,t){for(let n of this.clickFunctions)n(e,t)},onMove:function(e,t){for(let n of this.moveFunctions)n(e,t)},onDown:function(e,t){for(let n of this.downFunctions)n(e,t)},onUp:function(e,t){for(let n of this.upFunctions)n(e,t)},addHoverFunction:function(e){this._validateCallback(e),this.hoverFunctions.push(e)},removeHoverFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.hoverFunctions,e)},addUnHoverFunction:function(e){this._validateCallback(e),this.unHoverFunctions.push(e)},removeUnHoverFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.unHoverFunctions,e)},addClickFunction:function(e){this._validateCallback(e),this.clickFunctions.push(e)},removeClickFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.clickFunctions,e)},addMoveFunction:function(e){this._validateCallback(e),this.moveFunctions.push(e)},removeMoveFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.moveFunctions,e)},addDownFunction:function(e){this._validateCallback(e),this.downFunctions.push(e)},removeDownFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.downFunctions,e)},addUpFunction:function(e){this._validateCallback(e),this.upFunctions.push(e)},removeUpFunction:function(e){this._validateCallback(e),this._removeItemOnce(this.upFunctions,e)},_removeItemOnce:function(e,t){var n=e.indexOf(t);return n>-1&&e.splice(n,1),e},_validateCallback:function(e){if(typeof e!="function")throw new TypeError(this.object.name+".cursor-target: Argument needs to be a function")}})});var Wc={};var we,ar=oe(()=>{we=Z(J());WL.registerComponent("cursor",{collisionGroup:{type:WL.Type.Int,default:1},cursorRayObject:{type:WL.Type.Object},cursorRayScalingAxis:{type:WL.Type.Enum,values:["x","y","z","none"],default:"z"},cursorObject:{type:WL.Type.Object},handedness:{type:WL.Type.Enum,values:["input component","left","right","none"],default:"input component"},rayCastMode:{type:WL.Type.Enum,values:["collision","physx"],default:"collision"},styleCursor:{type:WL.Type.Bool,default:!0}},{init:function(){this.session=null,this.collisionMask=1<<this.collisionGroup,this.maxDistance=100;let e=this.onDestroy.bind(this);WL.onSceneLoaded.push(e),this.onDestroyCallbacks=[()=>{let t=WL.onSceneLoaded.indexOf(e);t>=0&&WL.onSceneLoaded.splice(t,1)}]},start:function(){if(this.handedness==0){let t=this.object.getComponent("input");t?(this.handedness=t.handedness,this.input=t):console.warn("cursor component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];if(this.globalTarget=this.object.addComponent("cursor-target"),this.origin=new Float32Array(3),this.cursorObjScale=new Float32Array(3),this.direction=[0,0,0],this.tempQuat=new Float32Array(4),this.viewComponent=this.object.getComponent("view"),this.viewComponent!=null){let t=this.onClick.bind(this);WL.canvas.addEventListener("click",t);let n=this.onPointerMove.bind(this);WL.canvas.addEventListener("pointermove",n);let r=this.onPointerDown.bind(this);WL.canvas.addEventListener("pointerdown",r);let s=this.onPointerUp.bind(this);WL.canvas.addEventListener("pointerup",s),this.projectionMatrix=new Float32Array(16),we.mat4.invert(this.projectionMatrix,this.viewComponent.projectionMatrix);let a=this.onViewportResize.bind(this);window.addEventListener("resize",a),this.onDestroyCallbacks.push(()=>{WL.canvas.removeEventListener("click",t),WL.canvas.removeEventListener("pointermove",n),WL.canvas.removeEventListener("pointerdown",r),WL.canvas.removeEventListener("pointerup",s),window.removeEventListener("resize",a)})}this.isHovering=!1,this.visible=!0,this.isDown=!1,this.lastIsDown=!1,this.cursorPos=new Float32Array(3),this.hoveringObject=null;let e=this.setupVREvents.bind(this);WL.onXRSessionStart.push(e),this.onDestroyCallbacks.push(()=>{let t=WL.onXRSessionStart.indexOf(e);t>=0&&WL.onXRSessionStart.splice(t,1)}),this.cursorRayObject&&(this.cursorRayScale=new Float32Array(3),this.cursorRayScale.set(this.cursorRayObject.scalingLocal),this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction),this._setCursorRayTransform([this.origin[0]+this.direction[0],this.origin[1]+this.direction[1],this.origin[2]+this.direction[2]]))},onViewportResize:function(){this.viewComponent&&we.mat4.invert(this.projectionMatrix,this.viewComponent.projectionMatrix)},_setCursorRayTransform:function(e){if(!this.cursorRayObject)return;let t=we.vec3.dist(this.origin,e);this.cursorRayObject.setTranslationLocal([0,0,-t/2]),this.cursorRayScalingAxis!=4&&(this.cursorRayObject.resetScaling(),this.cursorRayScale[this.cursorRayScalingAxis]=t/2,this.cursorRayObject.scale(this.cursorRayScale))},_setCursorVisibility:function(e){this.visible!=e&&(this.visible=e,this.cursorObject&&(e?(this.cursorObject.resetScaling(),this.cursorObject.scale(this.cursorObjScale)):(this.cursorObjScale.set(this.cursorObject.scalingLocal),this.cursorObject.scale([0,0,0]))))},update:function(){this.doUpdate(!1)},doUpdate:function(e){if(this.session){if(this.arTouchDown&&this.input&&WL.xrSession.inputSources[0].handedness==="none"&&WL.xrSession.inputSources[0].gamepad){let n=WL.xrSession.inputSources[0].gamepad.axes;this.direction=[n[0],-n[1],-1],this.updateDirection()}else this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction);let t=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);t.hitCount>0?this.cursorPos.set(t.locations[0]):this.cursorPos.fill(0),this.hoverBehaviour(t,e)}this.cursorObject&&(this.hoveringObject&&(this.cursorPos[0]!=0||this.cursorPos[1]!=0||this.cursorPos[2]!=0)?(this._setCursorVisibility(!0),this.cursorObject.setTranslationWorld(this.cursorPos),this._setCursorRayTransform(this.cursorPos)):this._setCursorVisibility(!1))},hoverBehaviour:function(e,t){if(e.hitCount>0){if(!this.hoveringObject||!this.hoveringObject.equals(e.objects[0])){if(this.hoveringObject){let s=this.hoveringObject.getComponent("cursor-target");s&&s.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.hoveringObject=e.objects[0],this.styleCursor&&(WL.canvas.style.cursor="pointer");let r=this.hoveringObject.getComponent("cursor-target");r&&(this.hoveringObjectTarget=r,r.onHover(this.hoveringObject,this)),this.globalTarget.onHover(this.hoveringObject,this)}this.hoveringObjectTarget&&this.hoveringObjectTarget.onMove(this.hoveringObject,this);let n=this.hoveringObject.getComponent("cursor-target");this.isDown!==this.lastIsDown&&(this.isDown?(n&&n.onDown(this.hoveringObject,this),this.globalTarget.onDown(this.hoveringObject,this)):(n&&n.onUp(this.hoveringObject,this),this.globalTarget.onUp(this.hoveringObject,this))),t&&(n&&n.onClick(this.hoveringObject,this),this.globalTarget.onClick(this.hoveringObject,this))}else if(this.hoveringObject&&e.hitCount==0){let n=this.hoveringObject.getComponent("cursor-target");n&&n.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this),this.hoveringObject=null,this.hoveringObjectTarget=null,this.styleCursor&&(WL.canvas.style.cursor="default")}this.lastIsDown=this.isDown},setupVREvents:function(e){this.session=e;let t=function(a){this.session=null}.bind(this);e.addEventListener("end",t);let n=this.onSelect.bind(this);e.addEventListener("select",n);let r=this.onSelectStart.bind(this);e.addEventListener("selectstart",r);let s=this.onSelectEnd.bind(this);e.addEventListener("selectend",s),this.onDestroyCallbacks.push(()=>{this.session&&(e.removeEventListener("end",t),e.removeEventListener("select",n),e.removeEventListener("selectstart",r),e.removeEventListener("selectend",s))}),this.onViewportResize()},onSelect:function(e){e.inputSource.handedness==this.handedness&&this.doUpdate(!0)},onSelectStart:function(e){this.arTouchDown=!0,e.inputSource.handedness==this.handedness&&(this.isDown=!0)},onSelectEnd:function(e){this.arTouchDown=!1,e.inputSource.handedness==this.handedness&&(this.isDown=!1)},onPointerMove:function(e){if(!e.isPrimary)return;let t=e.target.getBoundingClientRect(),n=this.updateMousePos(e.clientX,e.clientY,t.width,t.height);this.hoverBehaviour(n,!1)},onClick:function(e){let t=e.target.getBoundingClientRect(),n=this.updateMousePos(e.clientX,e.clientY,t.width,t.height);this.hoverBehaviour(n,!0)},onPointerDown:function(e){if(!e.isPrimary||e.button!==0)return;let t=e.target.getBoundingClientRect(),n=this.updateMousePos(e.clientX,e.clientY,t.width,t.height);this.isDown=!0,this.hoverBehaviour(n,!1)},onPointerUp:function(e){if(!e.isPrimary||e.button!==0)return;let t=e.target.getBoundingClientRect(),n=this.updateMousePos(e.clientX,e.clientY,t.width,t.height);this.isDown=!1,this.hoverBehaviour(n,!1)},updateMousePos:function(e,t,n,r){let s=e/n,a=t/r;return this.direction=[s*2-1,-a*2+1,-1],this.updateDirection()},updateDirection:function(){this.object.getTranslationWorld(this.origin),we.vec3.transformMat4(this.direction,this.direction,this.projectionMatrix),we.vec3.normalize(this.direction,this.direction),we.vec3.transformQuat(this.direction,this.direction,this.object.transformWorld);let e=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(this.origin,this.direction,this.collisionMask):WL.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);return e.hitCount>0?this.cursorPos.set(e.locations[0]):this.cursorPos.fill(0),e},onDeactivate:function(){if(this._setCursorVisibility(!1),this.hoveringObject){let e=this.hoveringObject.getComponent("cursor-target");e&&e.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.cursorRayObject&&this.cursorRayObject.scale([0,0,0])},onActivate:function(){this._setCursorVisibility(!0)},onDestroy:function(){for(let e of this.onDestroyCallbacks)e()}})});var or=U(()=>{WL.registerComponent("debug-object",{obj:{type:WL.Type.Object}},{start:function(){},init:function(){let e=[0,0,0];glMatrix.quat2.getTranslation(e,this.object.transformWorld),console.log("Debug Object:",this.object.name),console.log("Other object:",this.obj.name),console.log("	translation",e),console.log("	transformWorld",this.object.transformWorld),console.log("	transformLocal",this.object.transformLocal)},update:function(){}})});var lr=U(()=>{function Bc(e,t,n,r){let s=Math.cos(t/2),a=Math.cos(n/2),o=Math.cos(r/2),_=Math.sin(t/2),c=Math.sin(n/2),p=Math.sin(r/2);e[0]=_*a*o+s*c*p,e[1]=s*c*o-_*a*p,e[2]=s*a*p-_*c*o,e[3]=s*a*o+_*c*p}WL.registerComponent("device-orientation-look",{},{start:function(){this.rotationX=0,this.rotationY=0,this.lastClientX=-1,this.lastClientY=-1},init:function(){this.deviceOrientation=[0,0,0,1],this.screenOrientation=window.innerHeight>window.innerWidth?0:90,this._origin=[0,0,0],window.addEventListener("deviceorientation",function(e){let t=e.alpha||0,n=e.beta||0,r=e.gamma||0,s=Math.PI/180;Bc(this.deviceOrientation,n*s,t*s,-r*s)}.bind(this)),window.addEventListener("orientationchange",function(e){this.screenOrientation=window.orientation||0}.bind(this),!1)},update:function(){Module.webxr_session==null&&(glMatrix.quat2.getTranslation(this._origin,this.object.transformLocal),this.object.resetTransform(),this.screenOrientation!=0&&this.object.rotateAxisAngleDeg([0,0,-1],this.screenOrientation),this.object.rotate([-Math.sqrt(.5),0,0,Math.sqrt(.5)]),this.object.rotate(this.deviceOrientation),this.object.translate(this._origin))}})});var cr=U(()=>{WL.registerComponent("finger-cursor",{},{init:function(){this.lastTarget=null},start:function(){this.tip=this.object.getComponent("collision")},update:function(){let e=this.tip.queryOverlaps(),t=null;for(let n=0;n<e.length;++n){let r=e[n].object,s=r.getComponent("cursor-target");if(s){s.equals(this.lastTarget)||(s.onHover(r,this),s.onClick(r,this)),t=s;break}}if(t)this.lastTarget=t;else{this.lastTarget&&this.lastTarget.onUnhover(this.lastTarget.object,this),this.lastTarget=null;return}}})});var _r=U(()=>{WL.registerComponent("fixed-foveation",{fixedFoveation:{type:WL.Type.Float,default:.5}},{start:function(){WL.xrSession?this.setFixedFoveation():WL.onXRSessionStart.push(this.setFixedFoveation.bind(this))},setFixedFoveation:function(){"webxr_baseLayer"in Module&&(Module.webxr_baseLayer.fixedFoveation=this.fixedFoveation)}})});var Dc={};var Se,hr=oe(()=>{Se=Z(J());WL.registerComponent("hand-tracking",{handedness:{type:WL.Type.Enum,default:"left",values:["left","right"]},jointMesh:{type:WL.Type.Mesh,default:null},jointMaterial:{type:WL.Type.Material,default:null},handSkin:{type:WL.Type.Skin,default:null},deactivateChildrenWithoutPose:{type:WL.Type.Bool,default:!0},controllerToDeactivate:{type:WL.Type.Object}},{ORDERED_JOINTS:["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],init:function(){this.handedness=["left","right"][this.handedness]},start:function(){if(this.joints=[],this.session=null,this.hasPose=!1,this._childrenActive=!0,!("XRHand"in window)){console.warn("WebXR Hand Tracking not supported by this browser."),this.active=!1;return}if(this.handSkin){let t=this.handSkin.jointIds;this.joints[this.ORDERED_JOINTS[0]]=new WL.Object(t[0]);for(let n=0;n<t.length;++n){let r=new WL.Object(t[n]);this.joints[r.name]=r}return}for(let e=0;e<=this.ORDERED_JOINTS.length;++e){let t=WL.scene.addObject(this.object.parent),n=t.addComponent("mesh");n.mesh=this.jointMesh,n.material=this.jointMaterial,this.joints[this.ORDERED_JOINTS[e]]=t}},update:function(e){if(this.session||WL.xrSession&&this.setupVREvents(WL.xrSession),!!this.session){if(this.hasPose=!1,this.session&&this.session.inputSources)for(let t=0;t<=this.session.inputSources.length;++t){let n=this.session.inputSources[t];if(!n||!n.hand||n.handedness!=this.handedness)continue;if(this.hasPose=!0,n.hand.get("wrist")!==null){let a=Module.webxr_frame.getJointPose(n.hand.get("wrist"),WebXR.refSpaces[WebXR.refSpace]);a&&(this.object.resetTranslationRotation(),this.object.transformLocal.set([a.transform.orientation.x,a.transform.orientation.y,a.transform.orientation.z,a.transform.orientation.w]),this.object.translate([a.transform.position.x,a.transform.position.y,a.transform.position.z]))}let r=new Float32Array(3),s=new Float32Array(4);Se.quat.invert(s,this.object.transformLocal),this.object.getTranslationLocal(r);for(let a=0;a<this.ORDERED_JOINTS.length;++a){let o=this.ORDERED_JOINTS[a],_=this.joints[o];if(_==null)continue;let c=null;if(n.hand.get(o)!==null&&(c=Module.webxr_frame.getJointPose(n.hand.get(o),WebXR.refSpaces[WebXR.refSpace])),c!==null)if(this.handSkin)_.resetTranslationRotation(),_.translate([c.transform.position.x-r[0],c.transform.position.y-r[1],c.transform.position.z-r[2]]),_.rotate(s),_.rotateObject([c.transform.orientation.x,c.transform.orientation.y,c.transform.orientation.z,c.transform.orientation.w]);else{_.resetTransform(),_.transformLocal.set([c.transform.orientation.x,c.transform.orientation.y,c.transform.orientation.z,c.transform.orientation.w]),_.translate([c.transform.position.x,c.transform.position.y,c.transform.position.z]);let p=c.radius||.007;_.scale([p,p,p])}else this.handSkin||_.scale([0,0,0])}}!this.hasPose&&this._childrenActive?(this._childrenActive=!1,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!1),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!0,this.setChildrenActive(!0,this.controllerToDeactivate))):this.hasPose&&!this._childrenActive&&(this._childrenActive=!0,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!0),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!1,this.setChildrenActive(!1,this.controllerToDeactivate)))}},setChildrenActive:function(e,t){t=t||this.object;let n=t.children;for(let r of n)r.active=e,this.setChildrenActive(e,r)},isGrabbing:function(){let e=[0,0,0];Se.quat2.getTranslation(e,this.joints["index-finger-tip"].transformLocal);let t=[0,0,0];return Se.quat2.getTranslation(t,this.joints["thumb-tip"].transformLocal),Se.vec3.sqrDist(t,e)<.001},setupVREvents:function(e){this.session=e}})});var qc={};var pr,dr=oe(()=>{pr=Z(J());WL.registerComponent("hit-test-location",{},{init:function(){WL.onXRSessionStart.push(this.xrSessionStart.bind(this)),WL.onXRSessionEnd.push(this.xrSessionEnd.bind(this)),this.tempScaling=new Float32Array(3),this.tempScaling.set(this.object.scalingLocal),this.visible=!1,this.object.scale([0,0,0])},update:function(e){let t=this.visible;if(this.xrHitTestSource){let n=Module.webxr_frame;if(!n)return;let r=n.getHitTestResults(this.xrHitTestSource);if(r.length>0){let s=r[0].getPose(this.xrViewerSpace);this.visible=!0,pr.quat2.fromMat4(this.object.transformLocal,s.transform.matrix),this.object.setDirty()}else this.visible=!1}this.visible!=t&&(this.visible?(this.object.scalingLocal.set(this.tempScaling),this.object.setDirty()):(this.tempScaling.set(this.object.scalingLocal),this.object.scale([0,0,0])))},xrSessionStart:function(e){e.requestReferenceSpace("viewer").then(function(t){this.xrViewerSpace=t,e.requestHitTestSource({space:this.xrViewerSpace}).then(function(n){this.xrHitTestSource=n}.bind(this)).catch(console.error)}.bind(this)).catch(console.error)},xrSessionEnd:function(){this.xrHitTestSource&&(this.xrHitTestSource.cancel(),this.xrHitTestSource=null)}})});var St=U(pt=>{(function(){"use strict";var e=function(){this.init()};e.prototype={init:function(){var i=this||t;return i._counter=1e3,i._html5AudioPool=[],i.html5PoolSize=10,i._codecs={},i._howls=[],i._muted=!1,i._volume=1,i._canPlayEvent="canplaythrough",i._navigator=typeof window<"u"&&window.navigator?window.navigator:null,i.masterGain=null,i.noAudio=!1,i.usingWebAudio=!0,i.autoSuspend=!0,i.ctx=null,i.autoUnlock=!0,i._setup(),i},volume:function(i){var l=this||t;if(i=parseFloat(i),l.ctx||p(),typeof i<"u"&&i>=0&&i<=1){if(l._volume=i,l._muted)return l;l.usingWebAudio&&l.masterGain.gain.setValueAtTime(i,t.ctx.currentTime);for(var h=0;h<l._howls.length;h++)if(!l._howls[h]._webAudio)for(var d=l._howls[h]._getSoundIds(),m=0;m<d.length;m++){var f=l._howls[h]._soundById(d[m]);f&&f._node&&(f._node.volume=f._volume*i)}return l}return l._volume},mute:function(i){var l=this||t;l.ctx||p(),l._muted=i,l.usingWebAudio&&l.masterGain.gain.setValueAtTime(i?0:l._volume,t.ctx.currentTime);for(var h=0;h<l._howls.length;h++)if(!l._howls[h]._webAudio)for(var d=l._howls[h]._getSoundIds(),m=0;m<d.length;m++){var f=l._howls[h]._soundById(d[m]);f&&f._node&&(f._node.muted=i?!0:f._muted)}return l},stop:function(){for(var i=this||t,l=0;l<i._howls.length;l++)i._howls[l].stop();return i},unload:function(){for(var i=this||t,l=i._howls.length-1;l>=0;l--)i._howls[l].unload();return i.usingWebAudio&&i.ctx&&typeof i.ctx.close<"u"&&(i.ctx.close(),i.ctx=null,p()),i},codecs:function(i){return(this||t)._codecs[i.replace(/^x-/,"")]},_setup:function(){var i=this||t;if(i.state=i.ctx&&i.ctx.state||"suspended",i._autoSuspend(),!i.usingWebAudio)if(typeof Audio<"u")try{var l=new Audio;typeof l.oncanplaythrough>"u"&&(i._canPlayEvent="canplay")}catch{i.noAudio=!0}else i.noAudio=!0;try{var l=new Audio;l.muted&&(i.noAudio=!0)}catch{}return i.noAudio||i._setupCodecs(),i},_setupCodecs:function(){var i=this||t,l=null;try{l=typeof Audio<"u"?new Audio:null}catch{return i}if(!l||typeof l.canPlayType!="function")return i;var h=l.canPlayType("audio/mpeg;").replace(/^no$/,""),d=i._navigator?i._navigator.userAgent:"",m=d.match(/OPR\/([0-6].)/g),f=m&&parseInt(m[0].split("/")[1],10)<33,u=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,g=d.match(/Version\/(.*?) /),y=u&&g&&parseInt(g[1],10)<15;return i._codecs={mp3:!!(!f&&(h||l.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!h,opus:!!l.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!l.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(l.canPlayType('audio/wav; codecs="1"')||l.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!l.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!l.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(l.canPlayType("audio/x-m4a;")||l.canPlayType("audio/m4a;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(l.canPlayType("audio/x-m4b;")||l.canPlayType("audio/m4b;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(l.canPlayType("audio/x-mp4;")||l.canPlayType("audio/mp4;")||l.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!y&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!y&&l.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!l.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(l.canPlayType("audio/x-flac;")||l.canPlayType("audio/flac;")).replace(/^no$/,"")},i},_unlockAudio:function(){var i=this||t;if(!(i._audioUnlocked||!i.ctx)){i._audioUnlocked=!1,i.autoUnlock=!1,!i._mobileUnloaded&&i.ctx.sampleRate!==44100&&(i._mobileUnloaded=!0,i.unload()),i._scratchBuffer=i.ctx.createBuffer(1,1,22050);var l=function(h){for(;i._html5AudioPool.length<i.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,i._releaseHtml5Audio(d)}catch{i.noAudio=!0;break}for(var m=0;m<i._howls.length;m++)if(!i._howls[m]._webAudio)for(var f=i._howls[m]._getSoundIds(),u=0;u<f.length;u++){var g=i._howls[m]._soundById(f[u]);g&&g._node&&!g._node._unlocked&&(g._node._unlocked=!0,g._node.load())}i._autoResume();var y=i.ctx.createBufferSource();y.buffer=i._scratchBuffer,y.connect(i.ctx.destination),typeof y.start>"u"?y.noteOn(0):y.start(0),typeof i.ctx.resume=="function"&&i.ctx.resume(),y.onended=function(){y.disconnect(0),i._audioUnlocked=!0,document.removeEventListener("touchstart",l,!0),document.removeEventListener("touchend",l,!0),document.removeEventListener("click",l,!0),document.removeEventListener("keydown",l,!0);for(var w=0;w<i._howls.length;w++)i._howls[w]._emit("unlock")}};return document.addEventListener("touchstart",l,!0),document.addEventListener("touchend",l,!0),document.addEventListener("click",l,!0),document.addEventListener("keydown",l,!0),i}},_obtainHtml5Audio:function(){var i=this||t;if(i._html5AudioPool.length)return i._html5AudioPool.pop();var l=new Audio().play();return l&&typeof Promise<"u"&&(l instanceof Promise||typeof l.then=="function")&&l.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(i){var l=this||t;return i._unlocked&&l._html5AudioPool.push(i),l},_autoSuspend:function(){var i=this;if(!(!i.autoSuspend||!i.ctx||typeof i.ctx.suspend>"u"||!t.usingWebAudio)){for(var l=0;l<i._howls.length;l++)if(i._howls[l]._webAudio){for(var h=0;h<i._howls[l]._sounds.length;h++)if(!i._howls[l]._sounds[h]._paused)return i}return i._suspendTimer&&clearTimeout(i._suspendTimer),i._suspendTimer=setTimeout(function(){if(i.autoSuspend){i._suspendTimer=null,i.state="suspending";var d=function(){i.state="suspended",i._resumeAfterSuspend&&(delete i._resumeAfterSuspend,i._autoResume())};i.ctx.suspend().then(d,d)}},3e4),i}},_autoResume:function(){var i=this;if(!(!i.ctx||typeof i.ctx.resume>"u"||!t.usingWebAudio))return i.state==="running"&&i.ctx.state!=="interrupted"&&i._suspendTimer?(clearTimeout(i._suspendTimer),i._suspendTimer=null):i.state==="suspended"||i.state==="running"&&i.ctx.state==="interrupted"?(i.ctx.resume().then(function(){i.state="running";for(var l=0;l<i._howls.length;l++)i._howls[l]._emit("resume")}),i._suspendTimer&&(clearTimeout(i._suspendTimer),i._suspendTimer=null)):i.state==="suspending"&&(i._resumeAfterSuspend=!0),i}};var t=new e,n=function(i){var l=this;if(!i.src||i.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}l.init(i)};n.prototype={init:function(i){var l=this;return t.ctx||p(),l._autoplay=i.autoplay||!1,l._format=typeof i.format!="string"?i.format:[i.format],l._html5=i.html5||!1,l._muted=i.mute||!1,l._loop=i.loop||!1,l._pool=i.pool||5,l._preload=typeof i.preload=="boolean"||i.preload==="metadata"?i.preload:!0,l._rate=i.rate||1,l._sprite=i.sprite||{},l._src=typeof i.src!="string"?i.src:[i.src],l._volume=i.volume!==void 0?i.volume:1,l._xhr={method:i.xhr&&i.xhr.method?i.xhr.method:"GET",headers:i.xhr&&i.xhr.headers?i.xhr.headers:null,withCredentials:i.xhr&&i.xhr.withCredentials?i.xhr.withCredentials:!1},l._duration=0,l._state="unloaded",l._sounds=[],l._endTimers={},l._queue=[],l._playLock=!1,l._onend=i.onend?[{fn:i.onend}]:[],l._onfade=i.onfade?[{fn:i.onfade}]:[],l._onload=i.onload?[{fn:i.onload}]:[],l._onloaderror=i.onloaderror?[{fn:i.onloaderror}]:[],l._onplayerror=i.onplayerror?[{fn:i.onplayerror}]:[],l._onpause=i.onpause?[{fn:i.onpause}]:[],l._onplay=i.onplay?[{fn:i.onplay}]:[],l._onstop=i.onstop?[{fn:i.onstop}]:[],l._onmute=i.onmute?[{fn:i.onmute}]:[],l._onvolume=i.onvolume?[{fn:i.onvolume}]:[],l._onrate=i.onrate?[{fn:i.onrate}]:[],l._onseek=i.onseek?[{fn:i.onseek}]:[],l._onunlock=i.onunlock?[{fn:i.onunlock}]:[],l._onresume=[],l._webAudio=t.usingWebAudio&&!l._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(l),l._autoplay&&l._queue.push({event:"play",action:function(){l.play()}}),l._preload&&l._preload!=="none"&&l.load(),l},load:function(){var i=this,l=null;if(t.noAudio){i._emit("loaderror",null,"No audio support.");return}typeof i._src=="string"&&(i._src=[i._src]);for(var h=0;h<i._src.length;h++){var d,m;if(i._format&&i._format[h])d=i._format[h];else{if(m=i._src[h],typeof m!="string"){i._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(m),d||(d=/\.([^.]+)$/.exec(m.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&t.codecs(d)){l=i._src[h];break}}if(!l){i._emit("loaderror",null,"No codec support for selected audio sources.");return}return i._src=l,i._state="loading",window.location.protocol==="https:"&&l.slice(0,5)==="http:"&&(i._html5=!0,i._webAudio=!1),new r(i),i._webAudio&&a(i),i},play:function(i,l){var h=this,d=null;if(typeof i=="number")d=i,i=null;else{if(typeof i=="string"&&h._state==="loaded"&&!h._sprite[i])return null;if(typeof i>"u"&&(i="__default",!h._playLock)){for(var m=0,f=0;f<h._sounds.length;f++)h._sounds[f]._paused&&!h._sounds[f]._ended&&(m++,d=h._sounds[f]._id);m===1?i=null:d=null}}var u=d?h._soundById(d):h._inactiveSound();if(!u)return null;if(d&&!i&&(i=u._sprite||"__default"),h._state!=="loaded"){u._sprite=i,u._ended=!1;var g=u._id;return h._queue.push({event:"play",action:function(){h.play(g)}}),g}if(d&&!u._paused)return l||h._loadQueue("play"),u._id;h._webAudio&&t._autoResume();var y=Math.max(0,u._seek>0?u._seek:h._sprite[i][0]/1e3),w=Math.max(0,(h._sprite[i][0]+h._sprite[i][1])/1e3-y),b=w*1e3/Math.abs(u._rate),M=h._sprite[i][0]/1e3,T=(h._sprite[i][0]+h._sprite[i][1])/1e3;u._sprite=i,u._ended=!1;var F=function(){u._paused=!1,u._seek=y,u._start=M,u._stop=T,u._loop=!!(u._loop||h._sprite[i][2])};if(y>=T){h._ended(u);return}var j=u._node;if(h._webAudio){var B=function(){h._playLock=!1,F(),h._refreshBuffer(u);var k=u._muted||h._muted?0:u._volume;j.gain.setValueAtTime(k,t.ctx.currentTime),u._playStart=t.ctx.currentTime,typeof j.bufferSource.start>"u"?u._loop?j.bufferSource.noteGrainOn(0,y,86400):j.bufferSource.noteGrainOn(0,y,w):u._loop?j.bufferSource.start(0,y,86400):j.bufferSource.start(0,y,w),b!==1/0&&(h._endTimers[u._id]=setTimeout(h._ended.bind(h,u),b)),l||setTimeout(function(){h._emit("play",u._id),h._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?B():(h._playLock=!0,h.once("resume",B),h._clearTimer(u._id))}else{var W=function(){j.currentTime=y,j.muted=u._muted||h._muted||t._muted||j.muted,j.volume=u._volume*t.volume(),j.playbackRate=u._rate;try{var k=j.play();if(k&&typeof Promise<"u"&&(k instanceof Promise||typeof k.then=="function")?(h._playLock=!0,F(),k.then(function(){h._playLock=!1,j._unlocked=!0,l?h._loadQueue():h._emit("play",u._id)}).catch(function(){h._playLock=!1,h._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),u._ended=!0,u._paused=!0})):l||(h._playLock=!1,F(),h._emit("play",u._id)),j.playbackRate=u._rate,j.paused){h._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}i!=="__default"||u._loop?h._endTimers[u._id]=setTimeout(h._ended.bind(h,u),b):(h._endTimers[u._id]=function(){h._ended(u),j.removeEventListener("ended",h._endTimers[u._id],!1)},j.addEventListener("ended",h._endTimers[u._id],!1))}catch(I){h._emit("playerror",u._id,I)}};j.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(j.src=h._src,j.load());var V=window&&window.ejecta||!j.readyState&&t._navigator.isCocoonJS;if(j.readyState>=3||V)W();else{h._playLock=!0,h._state="loading";var D=function(){h._state="loaded",W(),j.removeEventListener(t._canPlayEvent,D,!1)};j.addEventListener(t._canPlayEvent,D,!1),h._clearTimer(u._id)}}return u._id},pause:function(i){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"pause",action:function(){l.pause(i)}}),l;for(var h=l._getSoundIds(i),d=0;d<h.length;d++){l._clearTimer(h[d]);var m=l._soundById(h[d]);if(m&&!m._paused&&(m._seek=l.seek(h[d]),m._rateSeek=0,m._paused=!0,l._stopFade(h[d]),m._node))if(l._webAudio){if(!m._node.bufferSource)continue;typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),l._cleanBuffer(m._node)}else(!isNaN(m._node.duration)||m._node.duration===1/0)&&m._node.pause();arguments[1]||l._emit("pause",m?m._id:null)}return l},stop:function(i,l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"stop",action:function(){h.stop(i)}}),h;for(var d=h._getSoundIds(i),m=0;m<d.length;m++){h._clearTimer(d[m]);var f=h._soundById(d[m]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,h._stopFade(d[m]),f._node&&(h._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),h._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&h._clearSound(f._node))),l||h._emit("stop",f._id))}return h},mute:function(i,l){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"mute",action:function(){h.mute(i,l)}}),h;if(typeof l>"u")if(typeof i=="boolean")h._muted=i;else return h._muted;for(var d=h._getSoundIds(l),m=0;m<d.length;m++){var f=h._soundById(d[m]);f&&(f._muted=i,f._interval&&h._stopFade(f._id),h._webAudio&&f._node?f._node.gain.setValueAtTime(i?0:f._volume,t.ctx.currentTime):f._node&&(f._node.muted=t._muted?!0:i),h._emit("mute",f._id))}return h},volume:function(){var i=this,l=arguments,h,d;if(l.length===0)return i._volume;if(l.length===1||l.length===2&&typeof l[1]>"u"){var m=i._getSoundIds(),f=m.indexOf(l[0]);f>=0?d=parseInt(l[0],10):h=parseFloat(l[0])}else l.length>=2&&(h=parseFloat(l[0]),d=parseInt(l[1],10));var u;if(typeof h<"u"&&h>=0&&h<=1){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"volume",action:function(){i.volume.apply(i,l)}}),i;typeof d>"u"&&(i._volume=h),d=i._getSoundIds(d);for(var g=0;g<d.length;g++)u=i._soundById(d[g]),u&&(u._volume=h,l[2]||i._stopFade(d[g]),i._webAudio&&u._node&&!u._muted?u._node.gain.setValueAtTime(h,t.ctx.currentTime):u._node&&!u._muted&&(u._node.volume=h*t.volume()),i._emit("volume",u._id))}else return u=d?i._soundById(d):i._sounds[0],u?u._volume:0;return i},fade:function(i,l,h,d){var m=this;if(m._state!=="loaded"||m._playLock)return m._queue.push({event:"fade",action:function(){m.fade(i,l,h,d)}}),m;i=Math.min(Math.max(0,parseFloat(i)),1),l=Math.min(Math.max(0,parseFloat(l)),1),h=parseFloat(h),m.volume(i,d);for(var f=m._getSoundIds(d),u=0;u<f.length;u++){var g=m._soundById(f[u]);if(g){if(d||m._stopFade(f[u]),m._webAudio&&!g._muted){var y=t.ctx.currentTime,w=y+h/1e3;g._volume=i,g._node.gain.setValueAtTime(i,y),g._node.gain.linearRampToValueAtTime(l,w)}m._startFadeInterval(g,i,l,h,f[u],typeof d>"u")}}return m},_startFadeInterval:function(i,l,h,d,m,f){var u=this,g=l,y=h-l,w=Math.abs(y/.01),b=Math.max(4,w>0?d/w:d),M=Date.now();i._fadeTo=h,i._interval=setInterval(function(){var T=(Date.now()-M)/d;M=Date.now(),g+=y*T,g=Math.round(g*100)/100,y<0?g=Math.max(h,g):g=Math.min(h,g),u._webAudio?i._volume=g:u.volume(g,i._id,!0),f&&(u._volume=g),(h<l&&g<=h||h>l&&g>=h)&&(clearInterval(i._interval),i._interval=null,i._fadeTo=null,u.volume(h,i._id),u._emit("fade",i._id))},b)},_stopFade:function(i){var l=this,h=l._soundById(i);return h&&h._interval&&(l._webAudio&&h._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(h._interval),h._interval=null,l.volume(h._fadeTo,i),h._fadeTo=null,l._emit("fade",i)),l},loop:function(){var i=this,l=arguments,h,d,m;if(l.length===0)return i._loop;if(l.length===1)if(typeof l[0]=="boolean")h=l[0],i._loop=h;else return m=i._soundById(parseInt(l[0],10)),m?m._loop:!1;else l.length===2&&(h=l[0],d=parseInt(l[1],10));for(var f=i._getSoundIds(d),u=0;u<f.length;u++)m=i._soundById(f[u]),m&&(m._loop=h,i._webAudio&&m._node&&m._node.bufferSource&&(m._node.bufferSource.loop=h,h&&(m._node.bufferSource.loopStart=m._start||0,m._node.bufferSource.loopEnd=m._stop,i.playing(f[u])&&(i.pause(f[u],!0),i.play(f[u],!0)))));return i},rate:function(){var i=this,l=arguments,h,d;if(l.length===0)d=i._sounds[0]._id;else if(l.length===1){var m=i._getSoundIds(),f=m.indexOf(l[0]);f>=0?d=parseInt(l[0],10):h=parseFloat(l[0])}else l.length===2&&(h=parseFloat(l[0]),d=parseInt(l[1],10));var u;if(typeof h=="number"){if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"rate",action:function(){i.rate.apply(i,l)}}),i;typeof d>"u"&&(i._rate=h),d=i._getSoundIds(d);for(var g=0;g<d.length;g++)if(u=i._soundById(d[g]),u){i.playing(d[g])&&(u._rateSeek=i.seek(d[g]),u._playStart=i._webAudio?t.ctx.currentTime:u._playStart),u._rate=h,i._webAudio&&u._node&&u._node.bufferSource?u._node.bufferSource.playbackRate.setValueAtTime(h,t.ctx.currentTime):u._node&&(u._node.playbackRate=h);var y=i.seek(d[g]),w=(i._sprite[u._sprite][0]+i._sprite[u._sprite][1])/1e3-y,b=w*1e3/Math.abs(u._rate);(i._endTimers[d[g]]||!u._paused)&&(i._clearTimer(d[g]),i._endTimers[d[g]]=setTimeout(i._ended.bind(i,u),b)),i._emit("rate",u._id)}}else return u=i._soundById(d),u?u._rate:i._rate;return i},seek:function(){var i=this,l=arguments,h,d;if(l.length===0)i._sounds.length&&(d=i._sounds[0]._id);else if(l.length===1){var m=i._getSoundIds(),f=m.indexOf(l[0]);f>=0?d=parseInt(l[0],10):i._sounds.length&&(d=i._sounds[0]._id,h=parseFloat(l[0]))}else l.length===2&&(h=parseFloat(l[0]),d=parseInt(l[1],10));if(typeof d>"u")return 0;if(typeof h=="number"&&(i._state!=="loaded"||i._playLock))return i._queue.push({event:"seek",action:function(){i.seek.apply(i,l)}}),i;var u=i._soundById(d);if(u)if(typeof h=="number"&&h>=0){var g=i.playing(d);g&&i.pause(d,!0),u._seek=h,u._ended=!1,i._clearTimer(d),!i._webAudio&&u._node&&!isNaN(u._node.duration)&&(u._node.currentTime=h);var y=function(){g&&i.play(d,!0),i._emit("seek",d)};if(g&&!i._webAudio){var w=function(){i._playLock?setTimeout(w,0):y()};setTimeout(w,0)}else y()}else if(i._webAudio){var b=i.playing(d)?t.ctx.currentTime-u._playStart:0,M=u._rateSeek?u._rateSeek-u._seek:0;return u._seek+(M+b*Math.abs(u._rate))}else return u._node.currentTime;return i},playing:function(i){var l=this;if(typeof i=="number"){var h=l._soundById(i);return h?!h._paused:!1}for(var d=0;d<l._sounds.length;d++)if(!l._sounds[d]._paused)return!0;return!1},duration:function(i){var l=this,h=l._duration,d=l._soundById(i);return d&&(h=l._sprite[d._sprite][1]/1e3),h},state:function(){return this._state},unload:function(){for(var i=this,l=i._sounds,h=0;h<l.length;h++)l[h]._paused||i.stop(l[h]._id),i._webAudio||(i._clearSound(l[h]._node),l[h]._node.removeEventListener("error",l[h]._errorFn,!1),l[h]._node.removeEventListener(t._canPlayEvent,l[h]._loadFn,!1),l[h]._node.removeEventListener("ended",l[h]._endFn,!1),t._releaseHtml5Audio(l[h]._node)),delete l[h]._node,i._clearTimer(l[h]._id);var d=t._howls.indexOf(i);d>=0&&t._howls.splice(d,1);var m=!0;for(h=0;h<t._howls.length;h++)if(t._howls[h]._src===i._src||i._src.indexOf(t._howls[h]._src)>=0){m=!1;break}return s&&m&&delete s[i._src],t.noAudio=!1,i._state="unloaded",i._sounds=[],i=null,null},on:function(i,l,h,d){var m=this,f=m["_on"+i];return typeof l=="function"&&f.push(d?{id:h,fn:l,once:d}:{id:h,fn:l}),m},off:function(i,l,h){var d=this,m=d["_on"+i],f=0;if(typeof l=="number"&&(h=l,l=null),l||h)for(f=0;f<m.length;f++){var u=h===m[f].id;if(l===m[f].fn&&u||!l&&u){m.splice(f,1);break}}else if(i)d["_on"+i]=[];else{var g=Object.keys(d);for(f=0;f<g.length;f++)g[f].indexOf("_on")===0&&Array.isArray(d[g[f]])&&(d[g[f]]=[])}return d},once:function(i,l,h){var d=this;return d.on(i,l,h,1),d},_emit:function(i,l,h){for(var d=this,m=d["_on"+i],f=m.length-1;f>=0;f--)(!m[f].id||m[f].id===l||i==="load")&&(setTimeout(function(u){u.call(this,l,h)}.bind(d,m[f].fn),0),m[f].once&&d.off(i,m[f].fn,m[f].id));return d._loadQueue(i),d},_loadQueue:function(i){var l=this;if(l._queue.length>0){var h=l._queue[0];h.event===i&&(l._queue.shift(),l._loadQueue()),i||h.action()}return l},_ended:function(i){var l=this,h=i._sprite;if(!l._webAudio&&i._node&&!i._node.paused&&!i._node.ended&&i._node.currentTime<i._stop)return setTimeout(l._ended.bind(l,i),100),l;var d=!!(i._loop||l._sprite[h][2]);if(l._emit("end",i._id),!l._webAudio&&d&&l.stop(i._id,!0).play(i._id),l._webAudio&&d){l._emit("play",i._id),i._seek=i._start||0,i._rateSeek=0,i._playStart=t.ctx.currentTime;var m=(i._stop-i._start)*1e3/Math.abs(i._rate);l._endTimers[i._id]=setTimeout(l._ended.bind(l,i),m)}return l._webAudio&&!d&&(i._paused=!0,i._ended=!0,i._seek=i._start||0,i._rateSeek=0,l._clearTimer(i._id),l._cleanBuffer(i._node),t._autoSuspend()),!l._webAudio&&!d&&l.stop(i._id,!0),l},_clearTimer:function(i){var l=this;if(l._endTimers[i]){if(typeof l._endTimers[i]!="function")clearTimeout(l._endTimers[i]);else{var h=l._soundById(i);h&&h._node&&h._node.removeEventListener("ended",l._endTimers[i],!1)}delete l._endTimers[i]}return l},_soundById:function(i){for(var l=this,h=0;h<l._sounds.length;h++)if(i===l._sounds[h]._id)return l._sounds[h];return null},_inactiveSound:function(){var i=this;i._drain();for(var l=0;l<i._sounds.length;l++)if(i._sounds[l]._ended)return i._sounds[l].reset();return new r(i)},_drain:function(){var i=this,l=i._pool,h=0,d=0;if(!(i._sounds.length<l)){for(d=0;d<i._sounds.length;d++)i._sounds[d]._ended&&h++;for(d=i._sounds.length-1;d>=0;d--){if(h<=l)return;i._sounds[d]._ended&&(i._webAudio&&i._sounds[d]._node&&i._sounds[d]._node.disconnect(0),i._sounds.splice(d,1),h--)}}},_getSoundIds:function(i){var l=this;if(typeof i>"u"){for(var h=[],d=0;d<l._sounds.length;d++)h.push(l._sounds[d]._id);return h}else return[i]},_refreshBuffer:function(i){var l=this;return i._node.bufferSource=t.ctx.createBufferSource(),i._node.bufferSource.buffer=s[l._src],i._panner?i._node.bufferSource.connect(i._panner):i._node.bufferSource.connect(i._node),i._node.bufferSource.loop=i._loop,i._loop&&(i._node.bufferSource.loopStart=i._start||0,i._node.bufferSource.loopEnd=i._stop||0),i._node.bufferSource.playbackRate.setValueAtTime(i._rate,t.ctx.currentTime),l},_cleanBuffer:function(i){var l=this,h=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&i.bufferSource&&(i.bufferSource.onended=null,i.bufferSource.disconnect(0),h))try{i.bufferSource.buffer=t._scratchBuffer}catch{}return i.bufferSource=null,l},_clearSound:function(i){var l=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);l||(i.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var r=function(i){this._parent=i,this.init()};r.prototype={init:function(){var i=this,l=i._parent;return i._muted=l._muted,i._loop=l._loop,i._volume=l._volume,i._rate=l._rate,i._seek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++t._counter,l._sounds.push(i),i.create(),i},create:function(){var i=this,l=i._parent,h=t._muted||i._muted||i._parent._muted?0:i._volume;return l._webAudio?(i._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),i._node.gain.setValueAtTime(h,t.ctx.currentTime),i._node.paused=!0,i._node.connect(t.masterGain)):t.noAudio||(i._node=t._obtainHtml5Audio(),i._errorFn=i._errorListener.bind(i),i._node.addEventListener("error",i._errorFn,!1),i._loadFn=i._loadListener.bind(i),i._node.addEventListener(t._canPlayEvent,i._loadFn,!1),i._endFn=i._endListener.bind(i),i._node.addEventListener("ended",i._endFn,!1),i._node.src=l._src,i._node.preload=l._preload===!0?"auto":l._preload,i._node.volume=h*t.volume(),i._node.load()),i},reset:function(){var i=this,l=i._parent;return i._muted=l._muted,i._loop=l._loop,i._volume=l._volume,i._rate=l._rate,i._seek=0,i._rateSeek=0,i._paused=!0,i._ended=!0,i._sprite="__default",i._id=++t._counter,i},_errorListener:function(){var i=this;i._parent._emit("loaderror",i._id,i._node.error?i._node.error.code:0),i._node.removeEventListener("error",i._errorFn,!1)},_loadListener:function(){var i=this,l=i._parent;l._duration=Math.ceil(i._node.duration*10)/10,Object.keys(l._sprite).length===0&&(l._sprite={__default:[0,l._duration*1e3]}),l._state!=="loaded"&&(l._state="loaded",l._emit("load"),l._loadQueue()),i._node.removeEventListener(t._canPlayEvent,i._loadFn,!1)},_endListener:function(){var i=this,l=i._parent;l._duration===1/0&&(l._duration=Math.ceil(i._node.duration*10)/10,l._sprite.__default[1]===1/0&&(l._sprite.__default[1]=l._duration*1e3),l._ended(i)),i._node.removeEventListener("ended",i._endFn,!1)}};var s={},a=function(i){var l=i._src;if(s[l]){i._duration=s[l].duration,c(i);return}if(/^data:[^;]+;base64,/.test(l)){for(var h=atob(l.split(",")[1]),d=new Uint8Array(h.length),m=0;m<h.length;++m)d[m]=h.charCodeAt(m);_(d.buffer,i)}else{var f=new XMLHttpRequest;f.open(i._xhr.method,l,!0),f.withCredentials=i._xhr.withCredentials,f.responseType="arraybuffer",i._xhr.headers&&Object.keys(i._xhr.headers).forEach(function(u){f.setRequestHeader(u,i._xhr.headers[u])}),f.onload=function(){var u=(f.status+"")[0];if(u!=="0"&&u!=="2"&&u!=="3"){i._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".");return}_(f.response,i)},f.onerror=function(){i._webAudio&&(i._html5=!0,i._webAudio=!1,i._sounds=[],delete s[l],i.load())},o(f)}},o=function(i){try{i.send()}catch{i.onerror()}},_=function(i,l){var h=function(){l._emit("loaderror",null,"Decoding audio data failed.")},d=function(m){m&&l._sounds.length>0?(s[l._src]=m,c(l,m)):h()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(i).then(d).catch(h):t.ctx.decodeAudioData(i,d,h)},c=function(i,l){l&&!i._duration&&(i._duration=l.duration),Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue())},p=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var i=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),l=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),h=l?parseInt(l[1],10):null;if(i&&h&&h<9){var d=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!d&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:t,Howl:n}}),typeof pt<"u"&&(pt.Howler=t,pt.Howl=n),typeof global<"u"?(global.HowlerGlobal=e,global.Howler=t,global.Howl=n,global.Sound=r):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=t,window.Howl=n,window.Sound=r)})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var r=n._howls.length-1;r>=0;r--)n._howls[r].stereo(t);return n},HowlerGlobal.prototype.pos=function(t,n,r){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(n=typeof n!="number"?s._pos[1]:n,r=typeof r!="number"?s._pos[2]:r,typeof t=="number")s._pos=[t,n,r],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(t,n,r,s,a,o){var _=this;if(!_.ctx||!_.ctx.listener)return _;var c=_._orientation;if(n=typeof n!="number"?c[1]:n,r=typeof r!="number"?c[2]:r,s=typeof s!="number"?c[3]:s,a=typeof a!="number"?c[4]:a,o=typeof o!="number"?c[5]:o,typeof t=="number")_._orientation=[t,n,r,s,a,o],typeof _.ctx.listener.forwardX<"u"?(_.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),_.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),_.ctx.listener.forwardZ.setTargetAtTime(r,Howler.ctx.currentTime,.1),_.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),_.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),_.ctx.listener.upZ.setTargetAtTime(o,Howler.ctx.currentTime,.1)):_.ctx.listener.setOrientation(t,n,r,s,a,o);else return c;return _},Howl.prototype.init=function(t){return function(n){var r=this;return r._orientation=n.orientation||[1,0,0],r._stereo=n.stereo||null,r._pos=n.pos||null,r._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},r._onstereo=n.onstereo?[{fn:n.onstereo}]:[],r._onpos=n.onpos?[{fn:n.onpos}]:[],r._onorientation=n.onorientation?[{fn:n.onorientation}]:[],t.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,n){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"stereo",action:function(){r.stereo(t,n)}}),r;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof t=="number")r._stereo=t,r._pos=[t,0,0];else return r._stereo;for(var a=r._getSoundIds(n),o=0;o<a.length;o++){var _=r._soundById(a[o]);if(_)if(typeof t=="number")_._stereo=t,_._pos=[t,0,0],_._node&&(_._pannerAttr.panningModel="equalpower",(!_._panner||!_._panner.pan)&&e(_,s),s==="spatial"?typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):_._panner.setPosition(t,0,0):_._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),r._emit("stereo",_._id);else return _._stereo}return r},Howl.prototype.pos=function(t,n,r,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(t,n,r,s)}}),a;if(n=typeof n!="number"?0:n,r=typeof r!="number"?-.5:r,typeof s>"u")if(typeof t=="number")a._pos=[t,n,r];else return a._pos;for(var o=a._getSoundIds(s),_=0;_<o.length;_++){var c=a._soundById(o[_]);if(c)if(typeof t=="number")c._pos=[t,n,r],c._node&&((!c._panner||c._panner.pan)&&e(c,"spatial"),typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setPosition(t,n,r)),a._emit("pos",c._id);else return c._pos}return a},Howl.prototype.orientation=function(t,n,r,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(t,n,r,s)}}),a;if(n=typeof n!="number"?a._orientation[1]:n,r=typeof r!="number"?a._orientation[2]:r,typeof s>"u")if(typeof t=="number")a._orientation=[t,n,r];else return a._orientation;for(var o=a._getSoundIds(s),_=0;_<o.length;_++){var c=a._soundById(o[_]);if(c)if(typeof t=="number")c._orientation=[t,n,r],c._node&&(c._panner||(c._pos||(c._pos=a._pos||[0,0,-.5]),e(c,"spatial")),typeof c._panner.orientationX<"u"?(c._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),c._panner.orientationZ.setValueAtTime(r,Howler.ctx.currentTime)):c._panner.setOrientation(t,n,r)),a._emit("orientation",c._id);else return c._orientation}return a},Howl.prototype.pannerAttr=function(){var t=this,n=arguments,r,s,a;if(!t._webAudio)return t;if(n.length===0)return t._pannerAttr;if(n.length===1)if(typeof n[0]=="object")r=n[0],typeof s>"u"&&(r.pannerAttr||(r.pannerAttr={coneInnerAngle:r.coneInnerAngle,coneOuterAngle:r.coneOuterAngle,coneOuterGain:r.coneOuterGain,distanceModel:r.distanceModel,maxDistance:r.maxDistance,refDistance:r.refDistance,rolloffFactor:r.rolloffFactor,panningModel:r.panningModel}),t._pannerAttr={coneInnerAngle:typeof r.pannerAttr.coneInnerAngle<"u"?r.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof r.pannerAttr.coneOuterAngle<"u"?r.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof r.pannerAttr.coneOuterGain<"u"?r.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof r.pannerAttr.distanceModel<"u"?r.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof r.pannerAttr.maxDistance<"u"?r.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof r.pannerAttr.refDistance<"u"?r.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof r.pannerAttr.rolloffFactor<"u"?r.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof r.pannerAttr.panningModel<"u"?r.pannerAttr.panningModel:t._panningModel});else return a=t._soundById(parseInt(n[0],10)),a?a._pannerAttr:t._pannerAttr;else n.length===2&&(r=n[0],s=parseInt(n[1],10));for(var o=t._getSoundIds(s),_=0;_<o.length;_++)if(a=t._soundById(o[_]),a){var c=a._pannerAttr;c={coneInnerAngle:typeof r.coneInnerAngle<"u"?r.coneInnerAngle:c.coneInnerAngle,coneOuterAngle:typeof r.coneOuterAngle<"u"?r.coneOuterAngle:c.coneOuterAngle,coneOuterGain:typeof r.coneOuterGain<"u"?r.coneOuterGain:c.coneOuterGain,distanceModel:typeof r.distanceModel<"u"?r.distanceModel:c.distanceModel,maxDistance:typeof r.maxDistance<"u"?r.maxDistance:c.maxDistance,refDistance:typeof r.refDistance<"u"?r.refDistance:c.refDistance,rolloffFactor:typeof r.rolloffFactor<"u"?r.rolloffFactor:c.rolloffFactor,panningModel:typeof r.panningModel<"u"?r.panningModel:c.panningModel};var p=a._panner;p?(p.coneInnerAngle=c.coneInnerAngle,p.coneOuterAngle=c.coneOuterAngle,p.coneOuterGain=c.coneOuterGain,p.distanceModel=c.distanceModel,p.maxDistance=c.maxDistance,p.refDistance=c.refDistance,p.rolloffFactor=c.rolloffFactor,p.panningModel=c.panningModel):(a._pos||(a._pos=t._pos||[0,0,-.5]),e(a,"spatial"))}return t},Sound.prototype.init=function(t){return function(){var n=this,r=n._parent;n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,t.call(this),n._stereo?r.stereo(n._stereo):n._pos&&r.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var n=this,r=n._parent;return n._orientation=r._orientation,n._stereo=r._stereo,n._pos=r._pos,n._pannerAttr=r._pannerAttr,n._stereo?r.stereo(n._stereo):n._pos?r.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,r._refreshBuffer(n)),t.call(this)}}(Sound.prototype.reset);var e=function(t,n){n=n||"spatial",n==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()});var zc={};var S_,ur=oe(()=>{S_=Z(St());WL.registerComponent("howler-audio-listener",{spatial:{type:WL.Type.Bool,default:!0}},{init:function(){this.origin=new Float32Array(3),this.fwd=new Float32Array(3),this.up=new Float32Array(3)},update:function(){this.spatial&&(this.object.getTranslationWorld(this.origin),this.object.getForward(this.fwd),this.object.getUp(this.up),Howler.pos(this.origin[0],this.origin[1],this.origin[2]),Howler.orientation(this.fwd[0],this.fwd[1],this.fwd[2],this.up[0],this.up[1],this.up[2]))}})});var Nc={};var mr,fr=oe(()=>{mr=Z(St());WL.registerComponent("howler-audio-source",{volume:{type:WL.Type.Float,default:1},spatial:{type:WL.Type.Bool,default:!0},loop:{type:WL.Type.Bool,default:!1},autoplay:{type:WL.Type.Bool,default:!1},src:{type:WL.Type.String,default:""}},{start:function(){this.audio=new mr.Howl({src:[this.src],loop:this.loop,volume:this.volume,autoplay:this.autoplay}),this.lastPlayedAudioId=null,this.origin=new Float32Array(3),this.lastOrigin=new Float32Array(3),this.spatial&&this.autoplay&&(this.updatePosition(),this.play());let e=()=>{this.stop();let t=WL.onSceneLoaded.indexOf(e);t>=0&&WL.onSceneLoaded.splice(t,1)};WL.onSceneLoaded.push(e)},update:function(){!this.spatial||!this.lastPlayedAudioId||(this.object.getTranslationWorld(this.origin),(Math.abs(this.lastOrigin[0]-this.origin[0])>.005||Math.abs(this.lastOrigin[1]-this.origin[1])>.005||Math.abs(this.lastOrigin[2]-this.origin[2])>.005)&&this.updatePosition())},updatePosition:function(){this.audio.pos(this.origin[0],this.origin[1],this.origin[2],this.lastPlayedAudioId),this.lastOrigin.set(this.origin)},play:function(){this.lastPlayedAudioId&&this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=this.audio.play(),this.spatial&&this.updatePosition()},stop:function(){this.lastPlayedAudioId&&(this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=null)}})});var gr=U(()=>{WL.registerComponent("image-texture",{url:{type:WL.Type.String,default:""},meshIndex:{type:WL.Type.Int,default:0},material:{type:WL.Type.Material}},{init:function(){this.material||(console.warn("image-texture: material property not set, please set 'material' instead of deprecated 'meshIndex'."),this.material=this.object.getComponent("mesh",this.meshIndex).material)},start:function(){WL.textures.load(this.url,"anonymous").then(e=>{this.material.shader=="Flat Opaque Textured"?this.material.flatTexture=e:mat.shader=="Phong Opaque Textured"?this.material.diffuseTexture=e:console.error("Shader",this.material.shader,"not supported by image-texture")}).catch(console.err)}})});var Vc={};var vr,yr=oe(()=>{vr=Z(J());WL.registerComponent("mouse-look",{sensitity:{type:WL.Type.Float,default:.25},requireMouseDown:{type:WL.Type.Bool,default:!0},mouseButtonIndex:{type:WL.Type.Int,default:0},pointerLockOnClick:{type:WL.Type.Bool,default:!1}},{init:function(){this.currentRotationY=0,this.currentRotationX=0,this.origin=new Float32Array(3),this.parentOrigin=new Float32Array(3),document.addEventListener("mousemove",function(e){if(this.active&&(this.mouseDown||!this.requireMouseDown)){this.rotationY=-this.sensitity*e.movementX/100,this.rotationX=-this.sensitity*e.movementY/100,this.currentRotationX+=this.rotationX,this.currentRotationY+=this.rotationY,this.currentRotationX=Math.min(1.507,this.currentRotationX),this.currentRotationX=Math.max(-1.507,this.currentRotationX),this.object.getTranslationWorld(this.origin);let t=this.object.parent;t!==null&&(t.getTranslationWorld(this.parentOrigin),vr.vec3.sub(this.origin,this.origin,this.parentOrigin)),this.object.resetTranslationRotation(),this.object.rotateAxisAngleRad([1,0,0],this.currentRotationX),this.object.rotateAxisAngleRad([0,1,0],this.currentRotationY),this.object.translate(this.origin)}}.bind(this)),this.pointerLockOnClick&&WL.canvas.addEventListener("mousedown",()=>{WL.canvas.requestPointerLock=WL.canvas.requestPointerLock||WL.canvas.mozRequestPointerLock||WL.canvas.webkitRequestPointerLock,WL.canvas.requestPointerLock()}),this.requireMouseDown&&(this.mouseButtonIndex==2&&WL.canvas.addEventListener("contextmenu",function(e){e.preventDefault()},!1),WL.canvas.addEventListener("mousedown",function(e){if(e.button==this.mouseButtonIndex&&(this.mouseDown=!0,document.body.style.cursor="grabbing",e.button==1))return e.preventDefault(),!1}.bind(this)),WL.canvas.addEventListener("mouseup",function(e){e.button==this.mouseButtonIndex&&(this.mouseDown=!1,document.body.style.cursor="initial")}.bind(this)))},start:function(){this.rotationX=0,this.rotationY=0}})});var wr=U(()=>{WL.registerComponent("player-height",{height:{type:WL.Type.Float,default:1.75}},{init:function(){WL.onXRSessionStart.push(this.onXRSessionStart.bind(this)),WL.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))},start:function(){this.object.resetTranslationRotation(),this.object.translate([0,this.height,0])},onXRSessionStart:function(){["local","viewer"].includes(WebXR.refSpace)||this.object.resetTranslationRotation()},onXRSessionEnd:function(){["local","viewer"].includes(WebXR.refSpace)||(this.object.resetTranslationRotation(),this.object.translate([0,this.height,0]))}})});var br=U(()=>{WL.registerComponent("target-framerate",{framerate:{type:WL.Type.Float,default:90}},{start:function(){WL.xrSession?this.setTargetFramerate(WL.xrSession):WL.onXRSessionStart.push(this.setTargetFramerate.bind(this))},setTargetFramerate:function(e){if(e.supportedFrameRates&&e.updateTargetFrameRate){let t=WL.xrSession.supportedFrameRates;t.sort((n,r)=>Math.abs(n-this.framerate)-Math.abs(r-this.framerate)),WL.xrSession.updateTargetFrameRate(t[0])}}})});var Hc={};var fe,xr=oe(()=>{fe=Z(J());WL.registerComponent("teleport",{teleportIndicatorMeshObject:{type:WL.Type.Object},camRoot:{type:WL.Type.Object},cam:{type:WL.Type.Object},eyeLeft:{type:WL.Type.Object},eyeRight:{type:WL.Type.Object},handedness:{type:WL.Type.Enum,values:["input component","left","right","none"],default:"input component"},floorGroup:{type:WL.Type.Int,default:1},thumbstickActivationThreshhold:{type:WL.Type.Float,default:-.7},thumbstickDeactivationThreshhold:{type:WL.Type.Float,default:.3},indicatorYOffset:{type:WL.Type.Float,default:.01},rayCastMode:{type:WL.Type.Enum,values:["collision","physx"],default:"collision"},maxDistance:{type:WL.Type.Float,default:100}},{init:function(){if(this._prevThumbstickAxis=new Float32Array(2),this._tempVec=new Float32Array(3),this._tempVec0=new Float32Array(3),this._currentIndicatorRotation=0,this.input=this.object.getComponent("input"),!this.input){console.error(this.object.name,"generic-teleport-component.js: input component is required on the object");return}if(!this.teleportIndicatorMeshObject){console.error(this.object.name,"generic-teleport-component.js: Teleport indicator mesh is missing");return}if(!this.camRoot){console.error(this.object.name,"generic-teleport-component.js: camRoot not set");return}this.isIndicating=!1,this.cam&&(this.isMouseIndicating=!1,WL.canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),WL.canvas.addEventListener("mouseup",this.onMouseUp.bind(this))),this.indicatorHidden=!0,this.hitSpot=new Float32Array(3),this._hasHit=!1,this._extraRotation=0,this._currentStickAxes=new Float32Array(2)},start:function(){if(this.handedness==0){let e=this.object.getComponent("input");e?(this.handedness=e.handedness,this.input=e):console.warn("teleport component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];WL.onXRSessionStart.push(this.setupVREvents.bind(this)),this.teleportIndicatorMeshObject.active=!1},_getCamRotation:function(){return this.eyeLeft.getForward(this._tempVec),this._tempVec[1]=0,fe.vec3.normalize(this._tempVec,this._tempVec),Math.atan2(this._tempVec[0],this._tempVec[2])},update:function(){let e=0;if(this.gamepad&&this.gamepad.axes&&(this._currentStickAxes[0]=this.gamepad.axes[2],this._currentStickAxes[1]=this.gamepad.axes[3],e=Math.abs(this._currentStickAxes[0])+Math.abs(this._currentStickAxes[1])),!this.isIndicating&&this._prevThumbstickAxis[1]>=this.thumbstickActivationThreshhold&&this._currentStickAxes[1]<this.thumbstickActivationThreshhold?this.isIndicating=!0:this.isIndicating&&e<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,this._extraRotation)),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){let t=this._tempVec0;fe.quat2.getTranslation(t,this.object.transformWorld);let n=this.object.getForward(this._tempVec),r=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(t,n,1<<this.floorGroup):WL.physics.rayCast(t,n,1<<this.floorGroup,this.maxDistance);r.hitCount>0?(this.indicatorHidden=!1,this._extraRotation=Math.PI+Math.atan2(this._currentStickAxes[0],this._currentStickAxes[1]),this._currentIndicatorRotation=this._getCamRotation()+(this._extraRotation-Math.PI),this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(r.locations[0]),this.teleportIndicatorMeshObject.translate([0,this.indicatorYOffset,0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot.set(r.locations[0]),this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}else this.teleportIndicatorMeshObject&&this.isMouseIndicating&&this.onMousePressed();this._prevThumbstickAxis.set(this._currentStickAxes)},setupVREvents:function(e){if(this.session=e,e.addEventListener("end",function(){this.gamepad=null,this.session=null}.bind(this)),e.inputSources&&e.inputSources.length)for(let t=0;t<e.inputSources.length;t++){let n=e.inputSources[t];n.handedness==this.handedness&&(this.gamepad=n.gamepad)}e.addEventListener("inputsourceschange",function(t){if(t.added&&t.added.length)for(let n=0;n<t.added.length;n++){let r=t.added[n];r.handedness==this.handedness&&(this.gamepad=r.gamepad)}}.bind(this))},onMouseDown:function(){this.isMouseIndicating=!0},onMouseUp:function(){this.isMouseIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,0)},onMousePressed:function(){let e=[0,0,0];fe.quat2.getTranslation(e,this.cam.transformWorld);let t=this.cam.getForward(this._tempVec),n=this.rayHit=this.rayCastMode==0?WL.scene.rayCast(e,t,1<<this.floorGroup):WL.physics.rayCast(e,t,1<<this.floorGroup,this.maxDistance);n.hitCount>0?(this.indicatorHidden=!1,t[1]=0,fe.vec3.normalize(t,t),this._currentIndicatorRotation=-Math.sign(t[2])*Math.acos(t[0])-Math.PI*.5,this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(n.locations[0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot=n.locations[0],this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)},_teleportPlayer:function(e,t){this.camRoot.rotateAxisAngleRad([0,1,0],t);let n=this._tempVec,r=this._tempVec0;this.session?(this.eyeLeft.getTranslationWorld(n),this.eyeRight.getTranslationWorld(r),fe.vec3.add(n,n,r),fe.vec3.scale(n,n,.5)):this.cam.getTranslationWorld(n),this.camRoot.getTranslationWorld(r),fe.vec3.sub(n,r,n),n[0]+=e[0],n[1]=e[1],n[2]+=e[2],this.camRoot.setTranslationWorld(n)}})});var Xc={};var R,Uc,Mr=oe(()=>{R=Z(J());Math.clamp=function(e,t,n){return Math.max(t,Math.min(e,n))};Uc=function(){let e=new Float32Array(3),t=new Float32Array(3),n=new Float32Array(3),r=new Float32Array(3),s=new Float32Array(3),a=new Float32Array(3),o=new Float32Array(3),_=new Float32Array(4),c=new Float32Array(4),p=new Float32Array(4),i=new Float32Array(4);return function(l,h,d,m,f,u,g,y,w,b){R.vec3.sub(n,m,d);let M=R.vec3.length(n);R.vec3.sub(e,m,f);let T=R.vec3.length(e);R.vec3.sub(e,u,d);let F=Math.clamp(R.vec3.length(e),g,M+T-g);R.vec3.sub(t,f,d),R.vec3.sub(r,d,m),R.vec3.sub(s,f,m),R.vec3.normalize(t,t),R.vec3.normalize(n,n),R.vec3.normalize(r,r),R.vec3.normalize(s,s),R.vec3.normalize(e,e);let j=Math.acos(Math.clamp(R.vec3.dot(t,n),-1,1)),B=Math.acos(Math.clamp(R.vec3.dot(r,s),-1,1)),W=Math.acos(Math.clamp(R.vec3.dot(t,e),-1,1)),V=Math.acos(Math.clamp((T*T-M*M-F*F)/(-2*M*F),-1,1)),D=Math.acos(Math.clamp((F*F-M*M-T*T)/(-2*M*T),-1,1));R.vec3.sub(t,f,d),R.vec3.sub(n,m,d),R.vec3.sub(e,u,d),R.vec3.cross(a,t,n),R.vec3.cross(o,t,e),b?(R.vec3.sub(n,b,m),R.vec3.transformQuat(n,[0,0,-1],w)):R.vec3.sub(n,m,d);let k=R.vec3.length(a);k==0?a.set([1,0,0]):R.vec3.scale(a,a,1/k),R.vec3.normalize(o,o),R.quat.conjugate(y,y),R.quat.setAxisAngle(c,R.vec3.transformQuat(_,a,y),V-j),R.quat.setAxisAngle(i,R.vec3.transformQuat(_,o,y),W),R.quat.mul(l,l,R.quat.mul(_,c,i)),R.quat.normalize(l,l),R.quat.conjugate(w,w),R.quat.setAxisAngle(p,R.vec3.transformQuat(_,a,w),D-B),R.quat.mul(h,h,p),R.quat.normalize(h,h)}}();WL.registerComponent("two-joint-ik-solver",{root:{type:WL.Type.Object},middle:{type:WL.Type.Object},end:{type:WL.Type.Object},target:{type:WL.Type.Object},helper:{type:WL.Type.Object}},{init:function(){this.pos=new Float32Array(3*7),this.p=[this.pos.subarray(0,3),this.pos.subarray(3,6),this.pos.subarray(6,9),this.pos.subarray(9,12),this.pos.subarray(12,15),this.pos.subarray(15,18),this.pos.subarray(18,21)]},update:function(){let e=this.p;this.root.getTranslationWorld(e[0]),this.middle.getTranslationWorld(e[1]),this.end.getTranslationWorld(e[2]),this.target.getTranslationWorld(e[3]);let t=e[4],n=e[5];this.root.getTranslationLocal(t),this.middle.getTranslationLocal(n),this.helper&&this.helper.getTranslationWorld(e[6]),Uc(this.root.transformLocal,this.middle.transformLocal,e[0],e[1],e[2],e[3],.01,this.root.transformWorld.subarray(0,4),this.middle.transformWorld.subarray(0,4),this.helper?e[6]:null),this.root.setTranslationLocal(t),this.middle.setTranslationLocal(n),this.root.setDirty(),this.middle.setDirty()}})});var Tr=U(()=>{WL.registerComponent("video-texture",{url:{type:WL.Type.String,default:""},material:{type:WL.Type.Material},loop:{type:WL.Type.Bool,default:!0},autoplay:{type:WL.Type.Bool,default:!0},muted:{type:WL.Type.Bool,default:!0}},{init:function(){if(!this.material){console.error("video-texture: material property not set");return}this.loaded=!1,this.frameUpdateRequested=!0},start:function(){if(this.video=document.createElement("video"),this.video.src=this.url,this.video.crossOrigin="anonymous",this.video.loop=this.loop,this.video.muted=this.muted,this.video.addEventListener("playing",function(){this.loaded=!0}.bind(this)),this.autoplay){let e=()=>{this.video.play(),window.removeEventListener("click",e),window.removeEventListener("touchstart",e)};window.addEventListener("click",e),window.addEventListener("touchstart",e)}},click:function(){},applyTexture:function(){let e=this.material;this.texture=new WL.Texture(this.video),e.shader=="Flat Opaque Textured"?e.flatTexture=this.texture:e.shader=="Phong Opaque Textured"?e.diffuseTexture=this.texture:console.error("Shader",e.shader,"not supported by video-texture"),"requestVideoFrameCallback"in this.video?this.video.requestVideoFrameCallback(this.updateVideo.bind(this)):this.video.addEventListener("timeupdate",function(){this.frameUpdateRequested=!0}.bind(this))},update:function(e){this.loaded&&this.frameUpdateRequested&&(this.texture?this.texture.update():this.applyTexture(),this.frameUpdateRequested=!1)},updateVideo:function(){this.frameUpdateRequested=!0,this.video.requestVideoFrameCallback(this.updateVideo.bind(this))}})});var Ar=U(()=>{WL.registerComponent("vr-mode-active-switch",{activateComponents:{type:WL.Type.Enum,values:["in VR","in non-VR"],default:"in VR"},affectChildren:{type:WL.Type.Bool,default:!0}},{start:function(){this.components=[],this.getComponents(this.object),this.onXRSessionEnd(),WL.onXRSessionStart.push(this.onXRSessionStart.bind(this)),WL.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))},getComponents:function(e){let t=e.getComponents().filter(n=>n.type!="vr-mode-active-switch");if(this.components=this.components.concat(t),this.affectChildren){let n=e.children;for(let r=0;r<n.length;++r)this.getComponents(n[r])}},setComponentsActive:function(e){let t=this.components;for(let n=0;n<t.length;++n)t[n].active=e},onXRSessionStart:function(){this.active&&this.setComponentsActive(this.activateComponents==0)},onXRSessionEnd:function(){this.active&&this.setComponentsActive(this.activateComponents!=0)}})});var Qc={};var v,Yc,Gc,Sr=oe(()=>{v=Z(J()),Yc={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},Gc={PositiveX:[1,0,0],NegativeX:[-1,0,0],PositiveY:[0,1,0],NegativeY:[0,-1,0],PositiveZ:[0,0,1],NegativeZ:[0,0,-1]};WL.registerComponent("vrm",{src:{type:WL.Type.String,default:""},lookAtTarget:{type:WL.Type.Object}},{meta:null,bones:{hips:null,spine:null,chest:null,upperChest:null,neck:null,head:null,leftEye:null,rightEye:null,jaw:null,leftUpperLeg:null,leftLowerLeg:null,leftFoot:null,leftToes:null,rightUpperLeg:null,rightLowerLeg:null,rightFoot:null,rightToes:null,leftShoulder:null,leftUpperArm:null,leftLowerArm:null,leftHand:null,rightShoulder:null,rightUpperArm:null,rightLowerArm:null,rightHand:null,leftThumbMetacarpal:null,leftThumbProximal:null,leftThumbDistal:null,leftIndexProximal:null,leftIndexIntermediate:null,leftIndexDistal:null,leftMiddleProximal:null,leftMiddleIntermediate:null,leftMiddleDistal:null,leftRingProximal:null,leftRingIntermediate:null,leftRingDistal:null,leftLittleProximal:null,leftLittleIntermediate:null,leftLittleDistal:null,rightThumbMetacarpal:null,rightThumbProximal:null,rightThumbDistal:null,rightIndexProximal:null,rightIndexIntermediate:null,rightIndexDistal:null,rightMiddleProximal:null,rightMiddleIntermediate:null,rightMiddleDistal:null,rightRingProximal:null,rightRingIntermediate:null,rightRingDistal:null,rightLittleProximal:null,rightLittleIntermediate:null,rightLittleDistal:null},restPose:{},_nodeConstraints:[],_springChains:[],_sphereColliders:[],_capsuleColliders:[],_firstPersonAnnotations:[],_lookAt:null,_initialized:!1,init:function(){this._tempV3=v.vec3.create(),this._tempV3A=v.vec3.create(),this._tempV3B=v.vec3.create(),this._tempQuat=v.quat.create(),this._tempQuatA=v.quat.create(),this._tempQuatB=v.quat.create(),this._tempMat4A=v.mat4.create(),this._tempQuat2=v.quat2.create(),this._tailToShape=v.vec3.create(),this._headToTail=v.vec3.create(),this._inertia=v.vec3.create(),this._stiffness=v.vec3.create(),this._external=v.vec3.create(),this._rightVector=v.vec3.set(v.vec3.create(),1,0,0),this._upVector=v.vec3.set(v.vec3.create(),0,1,0),this._forwardVector=v.vec3.set(v.vec3.create(),0,0,1),this._identityQuat=v.quat.identity(v.quat.create()),this._rad2deg=180/Math.PI},start:function(){if(!this.src){console.error("vrm: src property not set");return}WL.scene.append(this.src,{loadGltfExtensions:!0}).then(({root:e,extensions:t})=>{e.children.forEach(n=>n.parent=this.object),this._initializeVrm(t),e.destroy()})},_initializeVrm:function(e){if(this._initialized)throw Error("VRM component has already been initialized");let t=e.root.VRMC_vrm;if(!t)throw Error("Missing VRM extensions");if(t.specVersion!=="1.0")throw Error(`Unsupported VRM version, only 1.0 is supported, but encountered '${t.specVersion}'`);this.meta=t.meta,this._parseHumanoid(t.humanoid,e),t.firstPerson&&this._parseFirstPerson(t.firstPerson,e),t.lookAt&&this._parseLookAt(t.lookAt),this._findAndParseNodeConstraints(e);let n=e.root.VRMC_springBone;n&&this._parseAndInitializeSpringBones(n,e),this._initialized=!0},_parseHumanoid:function(e,t){for(let n in e.humanBones){if(!(n in this.bones)){console.warn(`Unrecognized bone '${n}'`);continue}let r=e.humanBones[n].node,s=t.idMapping[r];this.bones[n]=WL._wrapObject(s),this.restPose[n]=v.quat.copy(v.quat.create(),this.bones[n].rotationLocal)}},_parseFirstPerson:function(e,t){for(let n of e.meshAnnotations){let r={node:WL._wrapObject(t.idMapping[n.node]),firstPerson:!0,thirdPerson:!0};switch(n.type){case"firstPersonOnly":r.thirdPerson=!1;break;case"thirdPersonOnly":r.firstPerson=!1;break;case"both":break;case"auto":console.warn("First person mesh annotation type 'auto' is not supported, treating as 'both'!");break;default:console.error(`Invalid mesh annotation type '${n.type}'`);break}this._firstPersonAnnotations.push(r)}},_parseLookAt:function(e){if(e.type!=="bone"){console.warn(`Unsupported lookAt type '${e.type}', only 'bone' is supported`);return}let t=n=>({inputMaxValue:n.inputMaxValue,outputScale:n.outputScale});this._lookAt={offsetFromHeadBone:e.offsetFromHeadBone||[0,0,0],horizontalInner:t(e.rangeMapHorizontalInner),horizontalOuter:t(e.rangeMapHorizontalOuter),verticalDown:t(e.rangeMapVerticalDown),verticalUp:t(e.rangeMapVerticalUp)}},_findAndParseNodeConstraints:function(e){let t=n=>{let r=e.node[n.objectId];if(r&&"VRMC_node_constraint"in r){let a=r.VRMC_node_constraint.constraint,o,_;if("roll"in a?(o="roll",_=Yc[a.roll.rollAxis]):"aim"in a?(o="aim",_=Gc[a.aim.aimAxis]):"rotation"in a&&(o="rotation"),o){let c=WL._wrapObject(e.idMapping[a[o].source]);this._nodeConstraints.push({type:o,source:c,destination:n,axis:_,weight:a[o].weight,destinationRestLocalRotation:v.quat.copy(v.quat.create(),n.rotationLocal),sourceRestLocalRotation:v.quat.copy(v.quat.create(),c.rotationLocal),sourceRestLocalRotationInv:v.quat.invert(v.quat.create(),c.rotationLocal)})}else console.warn("Unrecognized or invalid VRMC_node_constraint, ignoring it")}for(let s of n.children)t(s)};t(this.object)},_parseAndInitializeSpringBones:function(e,t){let n=(e.colliders||[]).map((s,a)=>{let o="capsule"in s.shape?"capsule":"sphere";return{id:a,object:WL._wrapObject(t.idMapping[s.node]),shape:{isCapsule:o==="capsule",radius:s.shape[o].radius,offset:s.shape[o].offset,tail:s.shape[o].tail},cache:{head:v.vec3.create(),tail:v.vec3.create()}}});this._sphereColliders=n.filter(s=>!s.shape.isCapsule),this._capsuleColliders=n.filter(s=>s.shape.isCapsule);let r=(e.colliderGroups||[]).map(s=>({name:s.name,colliders:s.colliders.map(a=>n[a])}));for(let s of e.springs){let a=[];for(let _ of s.joints){let c={hitRadius:0,stiffness:1,gravityPower:0,gravityDir:[0,-1,0],dragForce:.5,node:null,state:null};Object.assign(c,_),c.node=WL._wrapObject(t.idMapping[c.node]),a.push(c)}let o=(s.colliderGroups||[]).flatMap(_=>r[_].colliders);this._springChains.push({name:s.name,center:s.center?WL._wrapObject(t.idMapping[s.center]):null,joints:a,sphereColliders:o.filter(_=>!_.shape.isCapsule),capsuleColliders:o.filter(_=>_.shape.isCapsule)})}for(let s of this._springChains)for(let a=0;a<s.joints.length-1;++a){let o=s.joints[a],_=s.joints[a+1],c=o.node.getTranslationWorld(v.vec3.create()),p=_.node.getTranslationWorld(v.vec3.create()),i=v.vec3.subtract(this._tempV3A,c,p),l={prevTail:p,currentTail:v.vec3.copy(v.vec3.create(),p),initialLocalRotation:v.quat.copy(v.quat.create(),o.node.rotationLocal),initialLocalTransformInvert:v.quat2.invert(v.quat2.create(),o.node.transformLocal),boneAxis:v.vec3.normalize(v.vec3.create(),_.node.getTranslationLocal(this._tempV3)),boneLength:Math.max(.01,v.vec3.length(i)),prevTailCenter:null,currentTailCenter:null};s.center&&(l.prevTailCenter=s.center.transformPointInverseWorld(v.vec3.create(),p),l.currentTailCenter=v.vec3.copy(v.vec3.create(),p)),o.state=l}},update:function(e){this._initialized&&(this._resolveLookAt(),this._resolveConstraints(),this._updateSpringBones(e))},_rangeMap:function(e,t){let n=e.inputMaxValue,r=e.outputScale;return Math.min(t,n)/n*r},_resolveLookAt:function(){if(!this._lookAt||!this.lookAtTarget)return;let e=this.bones.head.transformPointWorld(this._tempV3A,this._lookAt.offsetFromHeadBone),t=this.lookAtTarget.getTranslationWorld(this._tempV3B),n=v.vec3.sub(this._tempV3A,t,e);v.vec3.normalize(n,n),this.bones.head.parent.transformVectorInverseWorld(n);let r=v.vec3.dot(n,this._forwardVector),s=v.vec3.dot(n,this._rightVector),a=Math.atan2(s,r)*this._rad2deg,o=Math.sqrt(s*s+r*r),_=v.vec3.dot(n,this._upVector),c=Math.atan2(-_,o)*this._rad2deg;if(c>0?c=this._rangeMap(this._lookAt.verticalDown,c):c=-this._rangeMap(this._lookAt.verticalUp,-c),this.bones.leftEye){let p=a;p>0?p=this._rangeMap(this._lookAt.horizontalInner,p):p=-this._rangeMap(this._lookAt.horizontalOuter,-p);let i=v.quat.fromEuler(this._tempQuatA,c,p,0);this.bones.leftEye.rotationLocal=v.quat.multiply(i,this.restPose.leftEye,i)}if(this.bones.rightEye){let p=a;p>0?p=this._rangeMap(this._lookAt.horizontalOuter,p):p=-this._rangeMap(this._lookAt.horizontalInner,-p);let i=v.quat.fromEuler(this._tempQuatA,c,p,0);this.bones.rightEye.rotationLocal=v.quat.multiply(i,this.restPose.rightEye,i)}},_resolveConstraints:function(){for(let e of this._nodeConstraints)this._resolveConstraint(e)},_resolveConstraint:function(e){let t=e.destinationRestLocalRotation,n=e.sourceRestLocalRotationInv,r=v.quat.identity(this._tempQuatA);switch(e.type){case"roll":{let s=v.quat.multiply(this._tempQuatA,n,e.source.rotationLocal),a=v.quat.multiply(this._tempQuatA,e.sourceRestLocalRotation,s);v.quat.mul(a,a,n);let o=v.quat.invert(this._tempQuatB,t),_=v.quat.multiply(this._tempQuatB,o,a);v.quat.multiply(_,_,t);let c=v.vec3.transformQuat(this._tempV3A,e.axis,_),p=v.quat.rotationTo(this._tempQuatA,e.axis,c);v.quat.mul(r,t,v.quat.invert(this._tempQuat,p)),v.quat.mul(r,r,_)}break;case"aim":{let s=e.destination.parent.rotationWorld,a=v.vec3.transformQuat(this._tempV3A,e.axis,t);v.vec3.transformQuat(a,a,s);let o=e.source.getTranslationWorld(this._tempV3B);v.vec3.sub(o,o,e.destination.getTranslationWorld(this._tempV3)),v.vec3.normalize(o,o);let _=v.quat.rotationTo(this._tempQuatA,a,o);v.quat.mul(r,v.quat.invert(this._tempQuat,s),_),v.quat.mul(r,r,s),v.quat.mul(r,r,t)}break;case"rotation":{let s=v.quat.mul(r,n,e.source.rotationLocal);v.quat.mul(r,t,s)}break}v.quat.slerp(r,t,r,e.weight),e.destination.rotationLocal=r},_updateSpringBones:function(e){this._sphereColliders.forEach(({object:t,shape:n,cache:r})=>{let s=v.vec3.copy(r.head,n.offset);t.transformVectorWorld(s),v.vec3.add(r.head,t.getTranslationWorld(this._tempV3),s)}),this._capsuleColliders.forEach(({object:t,shape:n,cache:r})=>{let s=t.getTranslationWorld(this._tempV3A),a=v.vec3.copy(r.head,n.offset);t.transformVectorWorld(a),v.vec3.add(r.head,s,a);let o=v.vec3.copy(r.tail,n.tail);t.transformVectorWorld(o),v.vec3.add(r.tail,s,o)}),this._springChains.forEach(t=>{for(let n=0;n<t.joints.length-1;++n){let r=t.joints[n],s=r.node.parent?r.node.parent.rotationWorld:this._identityQuat,a=this._inertia;t.center?(v.vec3.sub(a,r.state.currentTailCenter,r.state.prevTailCenter),t.center.transformVectorWorld(a)):v.vec3.sub(a,r.state.currentTail,r.state.prevTail),v.vec3.scale(a,a,1-r.dragForce);let o=v.vec3.copy(this._stiffness,r.state.boneAxis);v.vec3.transformQuat(o,o,r.state.initialLocalRotation),v.vec3.transformQuat(o,o,s),v.vec3.scale(o,o,e*r.stiffness);let _=v.vec3.scale(this._external,r.gravityDir,e*r.gravityPower),c=v.vec3.copy(this._tempV3A,r.state.currentTail);v.vec3.add(c,c,a),v.vec3.add(c,c,o),v.vec3.add(c,c,_);let p=r.node.getTranslationWorld(this._tempV3B);v.vec3.sub(c,c,p),v.vec3.normalize(c,c),v.vec3.scaleAndAdd(c,p,c,r.state.boneLength);for(let{shape:h,cache:d}of t.sphereColliders){let m=this._tailToShape,f=d.head;m=v.vec3.sub(m,c,f);let u=h.radius+r.hitRadius,g=v.vec3.length(m)-u;g<0&&(v.vec3.normalize(m,m),v.vec3.scaleAndAdd(c,c,m,-g),v.vec3.sub(c,c,p),v.vec3.normalize(c,c),v.vec3.scaleAndAdd(c,p,c,r.state.boneLength))}for(let{shape:h,cache:d}of t.capsuleColliders){let m=this._tailToShape,f=d.head,u=d.tail;m=v.vec3.sub(m,c,f);let g=v.vec3.sub(this._headToTail,u,f),y=v.vec3.dot(g,m);v.vec3.squaredLength(g)<=y?v.vec3.sub(m,c,u):y>0&&(v.vec3.scale(g,g,y/v.vec3.squaredLength(g)),v.vec3.sub(m,m,g));let w=h.radius+r.hitRadius,b=v.vec3.length(m)-w;b<0&&(v.vec3.normalize(m,m),v.vec3.scaleAndAdd(c,c,m,-b),v.vec3.sub(c,c,p),v.vec3.normalize(c,c),v.vec3.scaleAndAdd(c,p,c,r.state.boneLength))}v.vec3.copy(r.state.prevTail,r.state.currentTail),v.vec3.copy(r.state.currentTail,c),t.center&&(v.vec3.copy(r.state.prevTailCenter,r.state.currentTailCenter),v.vec3.copy(r.state.currentTailCenter,c),t.center.transformPointInverseWorld(r.state.currentTailCenter)),r.node.parent.transformPointInverseWorld(c);let i=v.quat2.fromTranslation(this._tempQuat2,c);v.quat2.multiply(i,r.state.initialLocalTransformInvert,i),v.quat2.getTranslation(c,i),v.vec3.normalize(c,c);let l=v.quat.rotationTo(this._tempQuatA,r.state.boneAxis,c);r.node.rotationLocal=v.quat.mul(this._tempQuatA,r.state.initialLocalRotation,l)}})},set firstPerson(e){this._firstPersonAnnotations.forEach(t=>{let n=e==t.firstPerson||e!=t.thirdPerson;t.node.getComponents("mesh").forEach(r=>{r.active=n})})}})});var $c={};var Ot,Or=oe(()=>{Ot=Z(J());WL.registerComponent("wasd-controls",{speed:{type:WL.Type.Float,default:.1},headObject:{type:WL.Type.Object}},{init:function(){this.up=!1,this.right=!1,this.down=!1,this.left=!1,window.addEventListener("keydown",this.press.bind(this)),window.addEventListener("keyup",this.release.bind(this))},start:function(){this.headObject=this.headObject||this.object},update:function(){let e=[0,0,0];this.up&&(e[2]-=1),this.down&&(e[2]+=1),this.left&&(e[0]-=1),this.right&&(e[0]+=1),Ot.vec3.normalize(e,e),e[0]*=this.speed,e[2]*=this.speed,Ot.vec3.transformQuat(e,e,this.headObject.transformWorld),this.object.translate(e)},press:function(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!0:e.keyCode===39||e.keyCode===68?this.right=!0:e.keyCode===40||e.keyCode===83?this.down=!0:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!0)},release:function(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!1:e.keyCode===39||e.keyCode===68?this.right=!1:e.keyCode===40||e.keyCode===83?this.down=!1:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!1)}})});window.glMatrix=J();ir();sr();ar();or();lr();cr();_r();hr();dr();ur();fr();gr();yr();wr();br();xr();Mr();Tr();Ar();Sr();Or();var x;(function(e){e[e.Bool=2]="Bool",e[e.Int=4]="Int",e[e.Float=8]="Float",e[e.String=16]="String",e[e.Enum=32]="Enum",e[e.Object=64]="Object",e[e.Mesh=128]="Mesh",e[e.Texture=256]="Texture",e[e.Material=512]="Material",e[e.Animation=1024]="Animation",e[e.Skin=2048]="Skin",e[e.Color=4096]="Color"})(x||(x={}));var dt;(function(e){e[e.Sphere=0]="Sphere",e[e.AxisAlignedBox=1]="AxisAlignedBox",e[e.Box=2]="Box"})(dt||(dt={}));var Pr;(function(e){e[e.Left=1]="Left",e[e.Center=2]="Center",e[e.Right=3]="Right"})(Pr||(Pr={}));var jr;(function(e){e[e.Line=1]="Line",e[e.Middle=2]="Middle",e[e.Top=3]="Top",e[e.Bottom=4]="Bottom"})(jr||(jr={}));var Cr;(function(e){e[e.None=0]="None",e[e.Outline=1]="Outline"})(Cr||(Cr={}));var Lr;(function(e){e[e.Head=0]="Head",e[e.EyeLeft=1]="EyeLeft",e[e.EyeRight=2]="EyeRight",e[e.ControllerLeft=3]="ControllerLeft",e[e.ControllerRight=4]="ControllerRight",e[e.RayLeft=5]="RayLeft",e[e.RayRight=6]="RayRight"})(Lr||(Lr={}));var Ir;(function(e){e[e.Point=1]="Point",e[e.Spot=2]="Spot",e[e.Sun=3]="Sun"})(Ir||(Ir={}));var Rr;(function(e){e[e.Playing=1]="Playing",e[e.Paused=2]="Paused",e[e.Stopped=3]="Stopped"})(Rr||(Rr={}));var ut;(function(e){e[e.Force=0]="Force",e[e.Impulse=1]="Impulse",e[e.VelocityChange=2]="VelocityChange",e[e.Acceleration=3]="Acceleration"})(ut||(ut={}));var Er;(function(e){e[e.Touch=0]="Touch",e[e.TouchLost=1]="TouchLost",e[e.TriggerTouch=2]="TriggerTouch",e[e.TriggerTouchLost=3]="TriggerTouchLost"})(Er||(Er={}));var Ce;(function(e){e[e.None=0]="None",e[e.Sphere=1]="Sphere",e[e.Capsule=2]="Capsule",e[e.Box=3]="Box",e[e.Plane=4]="Plane",e[e.ConvexMesh=5]="ConvexMesh",e[e.TriangleMesh=6]="TriangleMesh"})(Ce||(Ce={}));var Fr;(function(e){e[e.Position=0]="Position",e[e.Tangent=1]="Tangent",e[e.Normal=2]="Normal",e[e.TextureCoordinate=3]="TextureCoordinate",e[e.Color=4]="Color",e[e.JointId=5]="JointId",e[e.JointWeight=6]="JointWeight",e[e.SecondaryJointId=7]="SecondaryJointId",e[e.SecondaryJointWeight=8]="SecondaryJointWeight"})(Fr||(Fr={}));var kr;(function(e){e[e.UnsignedInt=0]="UnsignedInt",e[e.Int=1]="Int",e[e.Float=2]="Float",e[e.Sampler=3]="Sampler",e[e.Font=4]="Font"})(kr||(kr={}));var z=class{_manager;_id;_object;_type;_engine;constructor(t,n=-1,r=-1){this._engine=t,this._manager=n,this._id=r,this._object=null,this._type=null}get engine(){return this._engine}get type(){return this._type||this._engine.wasm._typeNameFor(this._manager)}get object(){if(!this._object){let t=this._engine.wasm._wl_component_get_object(this._manager,this._id);this._object=this._engine.wrapObject(t)}return this._object}set active(t){this._engine.wasm._wl_component_setActive(this._manager,this._id,t)}get active(){return this._engine.wasm._wl_component_isActive(this._manager,this._id)!=0}destroy(){this._engine.wasm._wl_component_remove(this._manager,this._id),this._manager=void 0,this._id=void 0}equals(t){return t?this._manager==t._manager&&this._id==t._id:!1}};Je(z,"TypeName"),Je(z,"Properties");var Wr;(function(e){e[e.None=0]="None",e[e.X=1]="X",e[e.Y=2]="Y",e[e.Z=4]="Z"})(Wr||(Wr={}));var Ve=class extends z{set static(t){this._engine.wasm._wl_physx_component_set_static(this._id,t)}get static(){return!!this._engine.wasm._wl_physx_component_get_static(this._id)}set kinematic(t){this._engine.wasm._wl_physx_component_set_kinematic(this._id,t)}get kinematic(){return!!this._engine.wasm._wl_physx_component_get_kinematic(this._id)}set gravity(t){this._engine.wasm._wl_physx_component_set_gravity(this._id,t)}get gravity(){return!!this._engine.wasm._wl_physx_component_get_gravity(this._id)}set simulate(t){this._engine.wasm._wl_physx_component_set_simulate(this._id,t)}get simulate(){return!!this._engine.wasm._wl_physx_component_get_simulate(this._id)}set allowSimulation(t){this._engine.wasm._wl_physx_component_set_allowSimulation(this._id,t)}get allowSimulation(){return!!this._engine.wasm._wl_physx_component_get_allowSimulation(this._id)}set allowQuery(t){this._engine.wasm._wl_physx_component_set_allowQuery(this._id,t)}get allowQuery(){return!!this._engine.wasm._wl_physx_component_get_allowQuery(this._id)}set trigger(t){this._engine.wasm._wl_physx_component_set_trigger(this._id,t)}get trigger(){return!!this._engine.wasm._wl_physx_component_get_trigger(this._id)}set shape(t){this._engine.wasm._wl_physx_component_set_shape(this._id,t)}get shape(){return this._engine.wasm._wl_physx_component_get_shape(this._id)}set shapeData(t){t==null||![Ce.TriangleMesh,Ce.ConvexMesh].includes(this.shape)||this._engine.wasm._wl_physx_component_set_shape_data(this._id,t.index)}get shapeData(){return[Ce.TriangleMesh,Ce.ConvexMesh].includes(this.shape)?{index:this._engine.wasm._wl_physx_component_get_shape_data(this._id)}:null}set extents(t){this.extents.set(t)}get extents(){let t=this._engine.wasm,n=t._wl_physx_component_get_extents(this._id);return new Float32Array(t.HEAPF32.buffer,n,3)}get staticFriction(){return this._engine.wasm._wl_physx_component_get_staticFriction(this._id)}set staticFriction(t){this._engine.wasm._wl_physx_component_set_staticFriction(this._id,t)}get dynamicFriction(){return this._engine.wasm._wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(t){this._engine.wasm._wl_physx_component_set_dynamicFriction(this._id,t)}get bounciness(){return this._engine.wasm._wl_physx_component_get_bounciness(this._id)}set bounciness(t){this._engine.wasm._wl_physx_component_set_bounciness(this._id,t)}get linearDamping(){return this._engine.wasm._wl_physx_component_get_linearDamping(this._id)}set linearDamping(t){this._engine.wasm._wl_physx_component_set_linearDamping(this._id,t)}get angularDamping(){return this._engine.wasm._wl_physx_component_get_angularDamping(this._id)}set angularDamping(t){this._engine.wasm._wl_physx_component_set_angularDamping(this._id,t)}set linearVelocity(t){this._engine.wasm._wl_physx_component_set_linearVelocity(this._id,t[0],t[1],t[2])}get linearVelocity(){let t=this._engine.wasm;return t._wl_physx_component_get_linearVelocity(this._id,t._tempMem),new Float32Array(t.HEAPF32.buffer,t._tempMem,3)}set angularVelocity(t){this._engine.wasm._wl_physx_component_set_angularVelocity(this._id,t[0],t[1],t[2])}get angularVelocity(){let t=this._engine.wasm;return t._wl_physx_component_get_angularVelocity(this._id,t._tempMem),new Float32Array(t.HEAPF32.buffer,t._tempMem,3)}set groupsMask(t){this._engine.wasm._wl_physx_component_set_groupsMask(this._id,t)}get groupsMask(){return this._engine.wasm._wl_physx_component_get_groupsMask(this._id)}set blocksMask(t){this._engine.wasm._wl_physx_component_set_blocksMask(this._id,t)}get blocksMask(){return this._engine.wasm._wl_physx_component_get_blocksMask(this._id)}set linearLockAxis(t){this._engine.wasm._wl_physx_component_set_linearLockAxis(this._id,t)}get linearLockAxis(){return this._engine.wasm._wl_physx_component_get_linearLockAxis(this._id)}set angularLockAxis(t){this._engine.wasm._wl_physx_component_set_angularLockAxis(this._id,t)}get angularLockAxis(){return this._engine.wasm._wl_physx_component_get_angularLockAxis(this._id)}set mass(t){this._engine.wasm._wl_physx_component_set_mass(this._id,t)}get mass(){return this._engine.wasm._wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(t){this._engine.wasm._wl_physx_component_set_massSpaceInertiaTensor(this._id,t[0],t[1],t[2])}addForce(t,n,r,s,a){n=n||ut.Force,s?this._engine.wasm._wl_physx_component_addForceAt(this._id,t[0],t[1],t[2],n,!!r,s[0],s[1],s[2],!!a):this._engine.wasm._wl_physx_component_addForce(this._id,t[0],t[1],t[2],n,!!r)}addTorque(t,n=ut.Force){this._engine.wasm._wl_physx_component_addTorque(this._id,t[0],t[1],t[2],n)}onCollision(t){return this.onCollisionWith(this,t)}onCollisionWith(t,n){let r=this._engine.physics;return r._callbacks[this._id]=r._callbacks[this._id]||[],r._callbacks[this._id].push(n),this._engine.wasm._wl_physx_component_addCallback(this._id,t._id||this._id)}removeCollisionCallback(t){let n=this._engine.physics,r=this._engine.wasm._wl_physx_component_removeCallback(this._id,t);r&&n._callbacks[this._id].splice(-r)}};Je(Ve,"TypeName","physx");for(let e of["static","extents","staticFriction","dynamicFriction","bounciness","linearDamping","angularDamping","shape","shapeData","kinematic","linearVelocity","angularVelocity","mass"])Object.defineProperty(Ve.prototype,e,{enumerable:!0});var Br;(function(e){e[e.UnsignedByte=1]="UnsignedByte",e[e.UnsignedShort=2]="UnsignedShort",e[e.UnsignedInt=4]="UnsignedInt"})(Br||(Br={}));var K_=new Map([[x.Bool,!1],[x.Int,0],[x.Float,0],[x.String,""],[x.Enum,void 0],[x.Object,null],[x.Mesh,null],[x.Texture,null],[x.Material,null],[x.Animation,null],[x.Skin,null],[x.Color,[0,0,0,1]]]);var Pt=class{constructor(){this.PREFAB_UNAME_KEY="pun";this._prefabs=new Map}registerPrefab(t){let n=t.getPrefabUniqueName();if(this._prefabs.has(n))throw new Error("Can't register the same prefab twice: "+n);this._prefabs.set(n,t),t.object[this.PREFAB_UNAME_KEY]=n}getPrefab(t){return this._prefabs.has(t.TypeName)?this._prefabs.get(t.TypeName):null}getPrefabByName(t){return this._prefabs.has(t)?this._prefabs.get(t):null}removePrefab(t){this._prefabs.has(t.TypeName)&&this._prefabs.delete(t.TypeName)}},Q=new Pt;var qr=Z(J(),1);function Le(){return WL.scene}function Dr(){return WL.onXRSessionStart}var jt=Z(J(),1);var He=class{constructor(t){this._layerSize=t,this._layerData=new Array(this._layerSize);for(let n=0;n<this._layerSize;++n)this._layerData[n]=new Array(this._layerSize)}};var Oe=class{get gridSize(){return this._gridSize}get layerCount(){return this._layerCount}get cellSize(){return this._cellSize}constructor(t,n,r){this._gridSize=t,this._layerCount=n,this._cellSize=r,this._gridOffset=this._gridSize*this._cellSize/2,this._gridData=new Array(this._layerCount);for(let s=0;s<this._layerCount;++s)this._gridData[s]=new He(this._gridSize);console.log(this._gridData)}getCellPositionVec3(t){return this.getCellPosition(t[0],t[1],t[2])}getCellPosition(t,n,r){let s=jt.vec3.create();return s[1]=n*this._cellSize,s[0]=t*this._cellSize-this._gridOffset,s[2]=r*this._cellSize-this._gridOffset,s}getCellIndices(t,n,r){let s=jt.vec3.create();return s[0]=Math.round((t+this._gridOffset)/this._cellSize),s[1]=Math.floor(n/this._cellSize),s[2]=Math.round((r+this._gridOffset)/this._cellSize),s}};var Ct=class{get grid(){return this._grid}constructor(t,n,r){this._grid=new Oe(t,n,r)}},Pe=new Ct(30,10,.25);var he=class{static setTag(t,n){t[this.tagKey]=n}static hasTag(t,n){return!(!t[this.tagKey]&&t[this.tagKey]!==n)}static getTag(t){return t[this.tagKey]}};he.tagKey="TAG";var pe=class extends z{start(){he.setTag(this.object,parseInt(this.tag))}};pe.TypeName="tag-component",pe.Properties={tag:{type:x.Enum,values:[0 .toString(),2 .toString()]}};var ae=class extends z{start(){this._scene=Le(),this._cellSize=Pe.grid.cellSize}createPrevisObject(){this._previsObject=this._scene.addObject(null),this._previsObject.translateWorld([0,-5,0]);let n=this._scene.addObject(this._previsObject);n.translateObject([0,this._cellSize/2,0]),n.addComponent("mesh",{mesh:this.previsMesh,material:this.previsMat})}createBlock(n,r,s){let a=this._scene.addObject(s);a[Q.PREFAB_UNAME_KEY]=this.getPrefabUniqueName(),a.translateWorld(n);let o=this._scene.addObject(a);o.resetRotation(),o.translateObject([0,this._cellSize/2,0]),o.rotate(this._previsObject.rotationWorld);let _=this.finalMat.clone();_.diffuseColor=r,o.addComponent("mesh",{mesh:this.finalMesh,material:_}),o.addComponent(pe,{tag:1});let c=this._cellSize/2+.001;return o.addComponent("collision",{collider:dt.AxisAlignedBox,extents:[c,c,c],group:1}),a}updatePrevisPosition(n){this._previsObject.setTranslationWorld(n);let r=qr.vec3.create();this._previsObject.getTranslationWorld(r)}updatePrevisRotation(n,r){this._previsObject.rotateAxisAngleDeg([1,0,0],n),this._previsObject.rotateAxisAngleDeg([0,1,0],r)}setPrevisRotation(n){this._previsObject.resetRotation(),this._previsObject.rotationWorld=n}updatePrevisColor(n){this.previsMat.diffuseColor=n}};ae.TypeName="",ae.Properties={finalMesh:{type:x.Mesh},previsMesh:{type:x.Mesh},finalMat:{type:x.Material},previsMat:{type:x.Material}};var It=class extends ae{getPrefabUniqueName(){return It.TypeName}start(){super.start(),Q.registerPrefab(this),this.createPrevisObject()}},be=It;be.TypeName="block-slope-prefab",be.Properties={finalMesh:{type:x.Mesh},previsMesh:{type:x.Mesh},finalMat:{type:x.Material},previsMat:{type:x.Material}};var Rt=class{constructor(){this._currentPrefab=null,this._currentColor=[.2,.6,.86,1],this.test()}test(){return zt(this,null,function*(){yield new Promise(t=>setTimeout(t,1e3)),this._currentPrefab=Q.getPrefab(be),this._currentPrefab.updatePrevisColor(this._currentColor)})}setBuildContainer(t){this._buildContainer=t}setCurrentPrevizPosition(t){this._currentPrefab.updatePrevisPosition(t)}addCurrentPrevizRotation(t,n){this._currentPrefab.updatePrevisRotation(t,n)}instanciatePrefabAt(t){this._currentPrefab.createBlock(t,this._currentColor,this._buildContainer)}setPrefab(t){this._currentPrefab=t}setColor(t){this._currentColor=t,this._currentPrefab.updatePrevisColor(this._currentColor)}getCurrentBuildData(){return this._buildContainer.getComponent(ge).generateBuildData()}loadBuild(t){this._buildContainer.getComponent(ge).loadBuildData(t)}},Y=new Rt;var mt=Z(J(),1),ge=class extends z{init(){Y.setBuildContainer(this.object)}generateBuildData(){let t=new Array,n=this.object.children;for(let r of n){let s=r.children[0],a=s.getComponent("mesh"),o=mt.vec3.create();r.getTranslationWorld(o);let _=a.material.diffuseColor,c=mt.vec4.fromValues(_[0],_[1],_[2],_[3]);t.push({type:r[Q.PREFAB_UNAME_KEY],color:c,position:o,rotation:s.rotationWorld})}return t}loadBuildData(t){this.clearBlocksInScene();let n;for(let r of t){n=Q.getPrefabByName(r.type),n.setPrevisRotation(r.rotation),Y.setPrefab(n);let s=new Float32Array([r.color[0],r.color[1],r.color[2],r.color[3]]);Y.setColor(s),Y.instanciatePrefabAt(r.position)}}clearBlocksInScene(){for(let t of this.object.children)t.destroy()}};ge.TypeName="build-container",ge.Properties={};var Ie=class extends z{start(){this._grid=new Oe(2,10,.5);let n=this.debugVisualObject.getComponent("mesh"),r=Le(),s=25/2;for(let a=0;a<this._grid.layerCount;++a)for(let o=0;o<this._grid.gridSize;++o)for(let _=0;_<this._grid.gridSize;++_){let c=r.addObject(this.object);c.addComponent("mesh",{mesh:n.mesh,material:n.material}),c.resetTranslation(),c.translate(this._grid.getCellPosition(o,a,_));let p=this._grid.cellSize;c.scale([p,p,p])}}};Ie.TypeName="grid-debug-component",Ie.Properties={debugVisualObject:{type:x.Object,default:null}};var Ue=class{get isPressed(){return this._isPressed}get wasPressed(){return this._wasPressed}constructor(t,n){this._gamepadButton=t,this._index=n,this._isPressed=!1,this._wasPressed=!1,this._onPressedEvent=new Array,this._onReleasedEvent=new Array}update(){if(this._isPressed=this._gamepadButton.pressed,this._isPressed&&!this._wasPressed){for(let t of this._onPressedEvent)t(this);this._wasPressed=!0}if(!this._isPressed&&this._wasPressed){for(let t=0;t<this._onReleasedEvent.length;t++)this._onReleasedEvent[t](this);this._wasPressed=!1}}addPressedListener(t){return this._onPressedEvent.push(t)-1}addReleasedListener(t){return this._onReleasedEvent.push(t)-1}removePressedListener(t){this._onPressedEvent.splice(t,1)}removeReleasedListener(t){this._onReleasedEvent.splice(t,1)}clearPressedListeners(){this._onPressedEvent=new Array}clearReleasedListeners(){this._onReleasedEvent=new Array}};var Xe=class{constructor(t,n){this._joystickTriggerValue=.5;this.setup(t,n)}get hand(){return this._hand}get joystickXValue(){return this._gamepad.axes[2]}get joystickYValue(){return this._gamepad.axes[3]}get joystickXJustMoved(){return this._joystickXJustMoved}get joystickYJustMoved(){return this._joystickYJustMoved}setup(t,n){this._gamepad=t,this._hand=n,this.initButtons()}update(){for(let t of this._buttons.keys())this._buttons.get(t).update();this._joystickXIsMoving=Math.abs(this._gamepad.axes[2])>this._joystickTriggerValue,this._joystickYIsMoving=Math.abs(this._gamepad.axes[3])>this._joystickTriggerValue,this._joystickXJustMoved=this._joystickXIsMoving&&!this._joystickXWasMoving,this._joystickYJustMoved=this._joystickYIsMoving&&!this._joystickYWasMoving,this._joystickXWasMoving=this._joystickXIsMoving,this._joystickYWasMoving=this._joystickYIsMoving}getButton(t){return this._buttons.get(t)}initButtons(){let t=[0,1,4,5];this._buttons!=null&&(this._buttons.clear(),this._buttons=null),this._buttons=new Map;for(let n=0;n<t.length;++n){let r=t[n],s=this._gamepad.buttons[r],a=new Ue(s,r);this._buttons.set(r,a)}}};var Re=Z(J(),1);var xe=class extends z{get isPointing(){return this._isPointing}get currentHitPosition(){return this._currentHitPosition}get currentHitObject(){return this._currentHitObject}start(){this._scene=Le(),this._rayMesh=this.rayVisualObject.getComponent("mesh"),this._rayMesh.material.diffuseColor=Re.vec4.create(),this.rayVisualObject.translate([0,0,-.5]),this._origin=[0,0,0],this._direction=[0,0,0]}update(n){this.rayOrigin.getTranslationWorld(this._origin),this.rayOrigin.getForward(this._direction);let r=this._scene.rayCast(this._origin,this._direction,1);r.hitCount>0?(this._isPointing=!0,this._currentHitPosition=Re.vec3.clone(r.locations[0]),this._currentHitObject=r.objects[0],this.processRayStretch(),this.cursorHitVisualObject.setTranslationWorld(this._currentHitPosition)):(this._isPointing=!1,this.rayObject.resetScaling(),this.cursorHitVisualObject.setTranslationWorld([0,-5,0]))}processRayStretch(){let n=Re.vec3.create();n[0]=this._origin[0],n[1]=this._origin[1],n[2]=this._origin[2];let r=Re.vec3.distance(n,this._currentHitPosition);this.rayObject.resetScaling(),this.rayObject.scale([1,r-.05,1])}};xe.TypeName="pointer-ray",xe.Properties={rayOrigin:{type:x.Object},rayObject:{type:x.Object},rayVisualObject:{type:x.Object},cursorHitVisualObject:{type:x.Object}};var Me=class extends z{init(){this._interactCallbacks=new Array}addInteractCallback(n){this._interactCallbacks.push(n)}removeInteractCallback(n){let r=this._interactCallbacks.indexOf(n);this._interactCallbacks.splice(r,1)}};Me.TypeName="ui-element-base",Me.Properties={};var G=class extends Me{start(){this._meshComponent=this.object.getComponent("mesh"),this._meshMaterial=this._meshComponent.material.clone(),this._meshComponent.material=this._meshMaterial,this._textComponent=this.textObject.getComponent("text"),this.object.addComponent(pe,{tag:2})}interact(){console.log("Button clicked: "+this.object.name);for(let n of this._interactCallbacks)n();this.processVisualFeedback()}processVisualFeedback(){this._meshMaterial.color=[.635,.73,1,1],setTimeout(()=>{this._meshMaterial.color=[1,1,1,1]},100)}};G.TypeName="ui-button",G.Properties={textObject:{type:x.Object}};var Et=class{constructor(){this._soundEmitters=new Map}registerEmitter(t){if(this._soundEmitters.has(t.emitterType)){console.warn("Only one emitter can be register by type");return}console.log(`Register emmitter ${t.emitterType}`),this._soundEmitters.set(t.emitterType,t)}playAt(t,n){if(!this._soundEmitters.has(t)){console.warn(`Can't play sound from emitter ${t}. It doesn't exist`);return}this._soundEmitters.get(t).playAt(n)}},je=new Et;var Ee=class extends z{start(){if(this.inputObject===null)throw new Error("Input Object must be defined");if(this._inputComponent=this.inputObject.getComponent("input"),this._hand=this._inputComponent.handedness,this.pointerRay===null)throw new Error("Pointer Ray Object must be defined");this._pointerRayComponent=this.pointerRay.getComponent(xe),Dr().push(this.onXrSessionStart.bind(this))}update(n){if(this._xrGamepad!=null){if(this._xrGamepad.update(),!this._pointerRayComponent.isPointing){Y.setCurrentPrevizPosition([0,-5,0]);return}switch(he.getTag(this._pointerRayComponent.currentHitObject)){case 1:case 0:{let r=this._pointerRayComponent.currentHitPosition,s=Pe.grid.getCellIndices(r[0],r[1],r[2]),a=Pe.grid.getCellPositionVec3(s);this._xrGamepad.joystickXJustMoved&&(Y.addCurrentPrevizRotation(0,this._xrGamepad.joystickXValue>0?90:-90),je.playAt(2,this._pointerRayComponent.currentHitPosition)),Y.setCurrentPrevizPosition(a);break}case 2:{Y.setCurrentPrevizPosition([0,-5,0]);break}}}}onXrSessionStart(n){this.inputSourcesSetup(n)}inputSourcesSetup(n){for(let r=0;r<n.inputSources.length;++r){let s=n.inputSources[r];s.handedness===this._hand&&(console.log("Setup hand : "+s.handedness+" For XR Controller "+this._hand),this.setupXrGamepad(s.gamepad))}n.addEventListener("inputsourceschange",this.onXrInputSourceChangeHandler.bind(this))}setupXrGamepad(n){this._xrGamepad=new Xe(n,this._hand),this._xrGamepad.getButton(0).addPressedListener(this.onPlacementTriggerPressed.bind(this)),this._xrGamepad.getButton(5).addPressedListener(this.onDeleteButtonPressed.bind(this))}onXrInputSourceChangeHandler(n){for(let r=0;r<n.added.length;++r){let s=n.added[r];s.handedness===this._hand&&(console.log("Setup hand : "+s.handedness+" For XR Controller "+this._hand),this.setupXrGamepad(s.gamepad))}}onPlacementTriggerPressed(){if(this._pointerRayComponent.currentHitObject)switch(he.getTag(this._pointerRayComponent.currentHitObject)){case 1:case 0:{let n=this._pointerRayComponent.currentHitPosition,r=Pe.grid.getCellIndices(n[0],n[1],n[2]),s=Pe.grid.getCellPositionVec3(r);Y.instanciatePrefabAt(s),je.playAt(1,this._pointerRayComponent.currentHitPosition);break}case 2:{let n=this._pointerRayComponent.currentHitObject.getComponent(G);n&&(n.interact(),je.playAt(0,this._pointerRayComponent.currentHitPosition));break}}}onDeleteButtonPressed(){if(this._pointerRayComponent.currentHitObject)switch(he.getTag(this._pointerRayComponent.currentHitObject)){case 1:{this._pointerRayComponent.currentHitObject.parent.destroy(),je.playAt(3,this._pointerRayComponent.currentHitPosition);break}}}};Ee.TypeName="XR-Controller",Ee.Properties={pointerMode:{type:x.Int,default:0},inputObject:{type:x.Object,default:null},pointerRay:{type:x.Object,default:null}};var Ft=class extends ae{getPrefabUniqueName(){return Ft.TypeName}start(){super.start(),Q.registerPrefab(this),this.createPrevisObject()}},Fe=Ft;Fe.TypeName="block-prefab",Fe.Properties={finalMesh:{type:x.Mesh},previsMesh:{type:x.Mesh},finalMat:{type:x.Material},previsMat:{type:x.Material}};var kt=class extends ae{getPrefabUniqueName(){return kt.TypeName}start(){super.start(),Q.registerPrefab(this),this.createPrevisObject()}},ke=kt;ke.TypeName="block-stair-prefab",ke.Properties={finalMesh:{type:x.Mesh},previsMesh:{type:x.Mesh},finalMat:{type:x.Material},previsMat:{type:x.Material}};var gt="SAVE_DATA",Wt=class{constructor(){if(!(typeof window=="undefined"||!window.localStorage)){if(this._localStorage=window.localStorage,this._localStorage.getItem(gt)!==null){this.processExistingSaveData();return}this.createSaveData()}}processExistingSaveData(){this._saveData=JSON.parse(this._localStorage.getItem(gt)),console.log(this._saveData)}createSaveData(){this._saveData={saves:new Array},this._localStorage.setItem(gt,JSON.stringify(this._saveData))}getSavesEntries(){return this._saveData.saves}createNewSaveEntry(t){return{name:t,userPref:{color:[1,1,1],block:""},blocks:new Array}}createOrUpdateSaveEntry(t){let n=this._saveData.saves;for(let r=0;r<n.length;r++)if(n[r].name==t.name){n[r]=t;return}this._saveData.saves.push(t)}removeSaveEntry(t){let n=this._saveData.saves;for(let r=0;r<n.length;r++)if(n[r].name==t.name){n.splice(r,1);return}}flushSaves(){this._localStorage.setItem(gt,JSON.stringify(this._saveData))}},ve=new Wt;var K=class extends z{get emitterType(){return this._emitterType}init(){this.onInit(),je.registerEmitter(this)}start(){this._audioSource=this.object.getComponent("howler-audio-source")}playAt(n){this.object.setTranslationWorld(n),this._audioSource.play()}};K.TypeName="sound-emitter-base",K.Properties={};var Ye=class extends K{onInit(){this._emitterType=0}};Ye.TypeName="sound-emitter-click";var Ge=class extends K{onInit(){this._emitterType=3}};Ge.TypeName="sound-emitter-destroy";var Qe=class extends K{onInit(){this._emitterType=1}};Qe.TypeName="sound-emitter-place";var $e=class extends K{onInit(){this._emitterType=2}};$e.TypeName="sound-emitter-rotate";var We=class extends z{start(){this._prefabComponent=Q.getPrefabByName(this.prefab[Q.PREFAB_UNAME_KEY]),this._buttonComponent=this.object.getComponent(G),this._buttonComponent.addInteractCallback(this.onInteractHandler.bind(this))}onInteractHandler(){Y.setPrefab(this._prefabComponent)}};We.TypeName="block-selector-interactible",We.Properties={prefab:{type:x.Object}};var Be=class extends z{start(){this._color=new Float32Array([this.red,this.green,this.blue,1]),this._buttonComponent=this.object.getComponent(G),this._buttonComponent.addInteractCallback(this.onInteractHandler.bind(this))}onInteractHandler(){Y.setColor(this._color)}};Be.TypeName="color-selector-interactible",Be.Properties={red:{type:x.Float},green:{type:x.Float},blue:{type:x.Float}};var De=class extends z{start(){this._loadButton=this.loadButtonObj.getComponent(G),this._newButton=this.newButtonObj.getComponent(G),this._nextButton=this.nextButtonObj.getComponent(G),this._saveButton=this.saveButtonObj.getComponent(G),this._removeButton=this.removeButtonObj.getComponent(G),this._loadButton.addInteractCallback(this.onLoadButtonClicked.bind(this)),this._newButton.addInteractCallback(this.onNewButtonPressed.bind(this)),this._nextButton.addInteractCallback(this.onNextButtonPressed.bind(this)),this._saveButton.addInteractCallback(this.onSaveButtonPressed.bind(this)),this._removeButton.addInteractCallback(this.onRemoveButtonPressed.bind(this)),this._saveCount=this.saveCountObj.getComponent("text"),this._saveName=this.saveNameObj.getComponent("text"),this._saveEntries=ve.getSavesEntries(),this._currentSaveIndex=this._saveEntries.length<1?-1:0,this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[0].name,this.loadBlankSave()}onLoadButtonClicked(){this._currentSaveIndex<0||(this._currentBuildData=this._saveEntries[this._currentSaveIndex],console.log(this._currentBuildData),Y.loadBuild(this._currentBuildData.blocks))}onNewButtonPressed(){this.setCurrentSelectedSave(-1),Y.loadBuild(this._currentBuildData.blocks)}onNextButtonPressed(){this._currentSaveIndex++,this._currentSaveIndex>this._saveEntries.length-1&&(this._currentSaveIndex=0),this.setCurrentSelectedSave(this._currentSaveIndex),this._saveName.text=this._currentSaveIndex<0?"No save available":this._currentBuildData.name}onSaveButtonPressed(){this._currentBuildData.blocks=Y.getCurrentBuildData(),ve.createOrUpdateSaveEntry(this._currentBuildData),ve.flushSaves(),this._saveEntries=ve.getSavesEntries(),this._currentSaveIndex=this._currentSaveIndex<0?0:this._currentSaveIndex,this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[this._currentSaveIndex].name}onRemoveButtonPressed(){if(this._currentSaveIndex<0)return;let n=this._saveEntries[this._currentSaveIndex];if(n.name==this._currentBuildData.name&&(this.setCurrentSelectedSave(-1),Y.loadBuild(this._currentBuildData.blocks)),ve.removeSaveEntry(n),ve.flushSaves(),this._saveEntries=ve.getSavesEntries(),this._saveEntries.length<1)this._currentSaveIndex=-1;else{let r=this._currentSaveIndex>this._saveEntries.length-1;this._currentSaveIndex=r?0:this._currentSaveIndex}this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[this._currentSaveIndex].name}loadBlankSave(){this.setCurrentSelectedSave(-1),Y.loadBuild(this._currentBuildData.blocks)}setCurrentSelectedSave(n){switch(n){case-1:this._currentBuildData=ve.createNewSaveEntry(new Date().toLocaleString());break;default:this._currentBuildData=this._saveEntries[n];break}}};De.TypeName="save-panel",De.Properties={loadButtonObj:{type:x.Object,default:null},newButtonObj:{type:x.Object,default:null},nextButtonObj:{type:x.Object,default:null},saveButtonObj:{type:x.Object,default:null},removeButtonObj:{type:x.Object,default:null},saveCountObj:{type:x.Object,default:null},saveNameObj:{type:x.Object,default:null}};var qe=class extends z{start(){this._mesh=this.object.getComponent("mesh");let n=this.material.clone();n.occlusionTexture=this.albedoMap,n.normalTexture=this.normalMap,this._mesh.material=n}};qe.TypeName="simple-preview-block-creator",qe.Properties={material:{type:x.Material,default:null},albedoMap:{type:x.Texture,default:null},normalMap:{type:x.Texture,default:null}};WL.registerComponent(ge);WL.registerComponent(Ie);WL.registerComponent(xe);WL.registerComponent(Ee);WL.registerComponent(Fe);WL.registerComponent(be);WL.registerComponent(ke);WL.registerComponent(K);WL.registerComponent(Ye);WL.registerComponent(Ge);WL.registerComponent(Qe);WL.registerComponent($e);WL.registerComponent(We);WL.registerComponent(Be);WL.registerComponent(G);WL.registerComponent(Me);WL.registerComponent(De);WL.registerComponent(qe);WL.registerComponent(pe);})();
/*! Bundled license information:

howler/dist/howler.js:
  (*!
   *  howler.js v2.2.3
   *  howlerjs.com
   *
   *  (c) 2013-2020, James Simpson of GoldFire Studios
   *  goldfirestudios.com
   *
   *  MIT License
   *)
  (*!
   *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
   *  
   *  howler.js v2.2.3
   *  howlerjs.com
   *
   *  (c) 2013-2020, James Simpson of GoldFire Studios
   *  goldfirestudios.com
   *
   *  MIT License
   *)
*/
//# sourceMappingURL=wonderbrick-bundle.js.map
