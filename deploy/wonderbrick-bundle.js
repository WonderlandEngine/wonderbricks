(()=>{var ti=Object.create;var ht=Object.defineProperty;var ni=Object.getOwnPropertyDescriptor;var ii=Object.getOwnPropertyNames;var ri=Object.getPrototypeOf,si=Object.prototype.hasOwnProperty;var oi=(t,e,n)=>e in t?ht(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ai=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Je=(t,e)=>{for(var n in e)ht(t,n,{get:e[n],enumerable:!0})},li=(t,e,n,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of ii(e))!si.call(t,s)&&s!==n&&ht(t,s,{get:()=>e[s],enumerable:!(i=ni(e,s))||i.enumerable});return t};var _n=(t,e,n)=>(n=t!=null?ti(ri(t)):{},li(e||!t||!t.__esModule?ht(n,"default",{value:t,enumerable:!0}):n,t));var M=(t,e,n)=>(oi(t,typeof e!="symbol"?e+"":e,n),n);var hn=(t,e,n)=>new Promise((i,s)=>{var o=_=>{try{c(n.next(_))}catch(p){s(p)}},l=_=>{try{c(n.throw(_))}catch(p){s(p)}},c=_=>_.done?i(_.value):Promise.resolve(_.value).then(o,l);c((n=n.apply(t,e)).next())});var $t=ai(jt=>{(function(){"use strict";var t=function(){this.init()};t.prototype={init:function(){var r=this||e;return r._counter=1e3,r._html5AudioPool=[],r.html5PoolSize=10,r._codecs={},r._howls=[],r._muted=!1,r._volume=1,r._canPlayEvent="canplaythrough",r._navigator=typeof window<"u"&&window.navigator?window.navigator:null,r.masterGain=null,r.noAudio=!1,r.usingWebAudio=!0,r.autoSuspend=!0,r.ctx=null,r.autoUnlock=!0,r._setup(),r},volume:function(r){var a=this||e;if(r=parseFloat(r),a.ctx||p(),typeof r<"u"&&r>=0&&r<=1){if(a._volume=r,a._muted)return a;a.usingWebAudio&&a.masterGain.gain.setValueAtTime(r,e.ctx.currentTime);for(var h=0;h<a._howls.length;h++)if(!a._howls[h]._webAudio)for(var d=a._howls[h]._getSoundIds(),u=0;u<d.length;u++){var f=a._howls[h]._soundById(d[u]);f&&f._node&&(f._node.volume=f._volume*r)}return a}return a._volume},mute:function(r){var a=this||e;a.ctx||p(),a._muted=r,a.usingWebAudio&&a.masterGain.gain.setValueAtTime(r?0:a._volume,e.ctx.currentTime);for(var h=0;h<a._howls.length;h++)if(!a._howls[h]._webAudio)for(var d=a._howls[h]._getSoundIds(),u=0;u<d.length;u++){var f=a._howls[h]._soundById(d[u]);f&&f._node&&(f._node.muted=r?!0:f._muted)}return a},stop:function(){for(var r=this||e,a=0;a<r._howls.length;a++)r._howls[a].stop();return r},unload:function(){for(var r=this||e,a=r._howls.length-1;a>=0;a--)r._howls[a].unload();return r.usingWebAudio&&r.ctx&&typeof r.ctx.close<"u"&&(r.ctx.close(),r.ctx=null,p()),r},codecs:function(r){return(this||e)._codecs[r.replace(/^x-/,"")]},_setup:function(){var r=this||e;if(r.state=r.ctx&&r.ctx.state||"suspended",r._autoSuspend(),!r.usingWebAudio)if(typeof Audio<"u")try{var a=new Audio;typeof a.oncanplaythrough>"u"&&(r._canPlayEvent="canplay")}catch{r.noAudio=!0}else r.noAudio=!0;try{var a=new Audio;a.muted&&(r.noAudio=!0)}catch{}return r.noAudio||r._setupCodecs(),r},_setupCodecs:function(){var r=this||e,a=null;try{a=typeof Audio<"u"?new Audio:null}catch{return r}if(!a||typeof a.canPlayType!="function")return r;var h=a.canPlayType("audio/mpeg;").replace(/^no$/,""),d=r._navigator?r._navigator.userAgent:"",u=d.match(/OPR\/([0-6].)/g),f=u&&parseInt(u[0].split("/")[1],10)<33,m=d.indexOf("Safari")!==-1&&d.indexOf("Chrome")===-1,w=d.match(/Version\/(.*?) /),b=m&&w&&parseInt(w[1],10)<15;return r._codecs={mp3:!!(!f&&(h||a.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!h,opus:!!a.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!a.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(a.canPlayType('audio/wav; codecs="1"')||a.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!a.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!a.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(a.canPlayType("audio/x-m4a;")||a.canPlayType("audio/m4a;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(a.canPlayType("audio/x-m4b;")||a.canPlayType("audio/m4b;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(a.canPlayType("audio/x-mp4;")||a.canPlayType("audio/mp4;")||a.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!b&&a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!b&&a.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!a.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(a.canPlayType("audio/x-flac;")||a.canPlayType("audio/flac;")).replace(/^no$/,"")},r},_unlockAudio:function(){var r=this||e;if(!(r._audioUnlocked||!r.ctx)){r._audioUnlocked=!1,r.autoUnlock=!1,!r._mobileUnloaded&&r.ctx.sampleRate!==44100&&(r._mobileUnloaded=!0,r.unload()),r._scratchBuffer=r.ctx.createBuffer(1,1,22050);var a=function(h){for(;r._html5AudioPool.length<r.html5PoolSize;)try{var d=new Audio;d._unlocked=!0,r._releaseHtml5Audio(d)}catch{r.noAudio=!0;break}for(var u=0;u<r._howls.length;u++)if(!r._howls[u]._webAudio)for(var f=r._howls[u]._getSoundIds(),m=0;m<f.length;m++){var w=r._howls[u]._soundById(f[m]);w&&w._node&&!w._node._unlocked&&(w._node._unlocked=!0,w._node.load())}r._autoResume();var b=r.ctx.createBufferSource();b.buffer=r._scratchBuffer,b.connect(r.ctx.destination),typeof b.start>"u"?b.noteOn(0):b.start(0),typeof r.ctx.resume=="function"&&r.ctx.resume(),b.onended=function(){b.disconnect(0),r._audioUnlocked=!0,document.removeEventListener("touchstart",a,!0),document.removeEventListener("touchend",a,!0),document.removeEventListener("click",a,!0),document.removeEventListener("keydown",a,!0);for(var y=0;y<r._howls.length;y++)r._howls[y]._emit("unlock")}};return document.addEventListener("touchstart",a,!0),document.addEventListener("touchend",a,!0),document.addEventListener("click",a,!0),document.addEventListener("keydown",a,!0),r}},_obtainHtml5Audio:function(){var r=this||e;if(r._html5AudioPool.length)return r._html5AudioPool.pop();var a=new Audio().play();return a&&typeof Promise<"u"&&(a instanceof Promise||typeof a.then=="function")&&a.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(r){var a=this||e;return r._unlocked&&a._html5AudioPool.push(r),a},_autoSuspend:function(){var r=this;if(!(!r.autoSuspend||!r.ctx||typeof r.ctx.suspend>"u"||!e.usingWebAudio)){for(var a=0;a<r._howls.length;a++)if(r._howls[a]._webAudio){for(var h=0;h<r._howls[a]._sounds.length;h++)if(!r._howls[a]._sounds[h]._paused)return r}return r._suspendTimer&&clearTimeout(r._suspendTimer),r._suspendTimer=setTimeout(function(){if(r.autoSuspend){r._suspendTimer=null,r.state="suspending";var d=function(){r.state="suspended",r._resumeAfterSuspend&&(delete r._resumeAfterSuspend,r._autoResume())};r.ctx.suspend().then(d,d)}},3e4),r}},_autoResume:function(){var r=this;if(!(!r.ctx||typeof r.ctx.resume>"u"||!e.usingWebAudio))return r.state==="running"&&r.ctx.state!=="interrupted"&&r._suspendTimer?(clearTimeout(r._suspendTimer),r._suspendTimer=null):r.state==="suspended"||r.state==="running"&&r.ctx.state==="interrupted"?(r.ctx.resume().then(function(){r.state="running";for(var a=0;a<r._howls.length;a++)r._howls[a]._emit("resume")}),r._suspendTimer&&(clearTimeout(r._suspendTimer),r._suspendTimer=null)):r.state==="suspending"&&(r._resumeAfterSuspend=!0),r}};var e=new t,n=function(r){var a=this;if(!r.src||r.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}a.init(r)};n.prototype={init:function(r){var a=this;return e.ctx||p(),a._autoplay=r.autoplay||!1,a._format=typeof r.format!="string"?r.format:[r.format],a._html5=r.html5||!1,a._muted=r.mute||!1,a._loop=r.loop||!1,a._pool=r.pool||5,a._preload=typeof r.preload=="boolean"||r.preload==="metadata"?r.preload:!0,a._rate=r.rate||1,a._sprite=r.sprite||{},a._src=typeof r.src!="string"?r.src:[r.src],a._volume=r.volume!==void 0?r.volume:1,a._xhr={method:r.xhr&&r.xhr.method?r.xhr.method:"GET",headers:r.xhr&&r.xhr.headers?r.xhr.headers:null,withCredentials:r.xhr&&r.xhr.withCredentials?r.xhr.withCredentials:!1},a._duration=0,a._state="unloaded",a._sounds=[],a._endTimers={},a._queue=[],a._playLock=!1,a._onend=r.onend?[{fn:r.onend}]:[],a._onfade=r.onfade?[{fn:r.onfade}]:[],a._onload=r.onload?[{fn:r.onload}]:[],a._onloaderror=r.onloaderror?[{fn:r.onloaderror}]:[],a._onplayerror=r.onplayerror?[{fn:r.onplayerror}]:[],a._onpause=r.onpause?[{fn:r.onpause}]:[],a._onplay=r.onplay?[{fn:r.onplay}]:[],a._onstop=r.onstop?[{fn:r.onstop}]:[],a._onmute=r.onmute?[{fn:r.onmute}]:[],a._onvolume=r.onvolume?[{fn:r.onvolume}]:[],a._onrate=r.onrate?[{fn:r.onrate}]:[],a._onseek=r.onseek?[{fn:r.onseek}]:[],a._onunlock=r.onunlock?[{fn:r.onunlock}]:[],a._onresume=[],a._webAudio=e.usingWebAudio&&!a._html5,typeof e.ctx<"u"&&e.ctx&&e.autoUnlock&&e._unlockAudio(),e._howls.push(a),a._autoplay&&a._queue.push({event:"play",action:function(){a.play()}}),a._preload&&a._preload!=="none"&&a.load(),a},load:function(){var r=this,a=null;if(e.noAudio){r._emit("loaderror",null,"No audio support.");return}typeof r._src=="string"&&(r._src=[r._src]);for(var h=0;h<r._src.length;h++){var d,u;if(r._format&&r._format[h])d=r._format[h];else{if(u=r._src[h],typeof u!="string"){r._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}d=/^data:audio\/([^;,]+);/i.exec(u),d||(d=/\.([^.]+)$/.exec(u.split("?",1)[0])),d&&(d=d[1].toLowerCase())}if(d||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),d&&e.codecs(d)){a=r._src[h];break}}if(!a){r._emit("loaderror",null,"No codec support for selected audio sources.");return}return r._src=a,r._state="loading",window.location.protocol==="https:"&&a.slice(0,5)==="http:"&&(r._html5=!0,r._webAudio=!1),new i(r),r._webAudio&&o(r),r},play:function(r,a){var h=this,d=null;if(typeof r=="number")d=r,r=null;else{if(typeof r=="string"&&h._state==="loaded"&&!h._sprite[r])return null;if(typeof r>"u"&&(r="__default",!h._playLock)){for(var u=0,f=0;f<h._sounds.length;f++)h._sounds[f]._paused&&!h._sounds[f]._ended&&(u++,d=h._sounds[f]._id);u===1?r=null:d=null}}var m=d?h._soundById(d):h._inactiveSound();if(!m)return null;if(d&&!r&&(r=m._sprite||"__default"),h._state!=="loaded"){m._sprite=r,m._ended=!1;var w=m._id;return h._queue.push({event:"play",action:function(){h.play(w)}}),w}if(d&&!m._paused)return a||h._loadQueue("play"),m._id;h._webAudio&&e._autoResume();var b=Math.max(0,m._seek>0?m._seek:h._sprite[r][0]/1e3),y=Math.max(0,(h._sprite[r][0]+h._sprite[r][1])/1e3-b),A=y*1e3/Math.abs(m._rate),T=h._sprite[r][0]/1e3,j=(h._sprite[r][0]+h._sprite[r][1])/1e3;m._sprite=r,m._ended=!1;var O=function(){m._paused=!1,m._seek=b,m._start=T,m._stop=j,m._loop=!!(m._loop||h._sprite[r][2])};if(b>=j){h._ended(m);return}var C=m._node;if(h._webAudio){var k=function(){h._playLock=!1,O(),h._refreshBuffer(m);var R=m._muted||h._muted?0:m._volume;C.gain.setValueAtTime(R,e.ctx.currentTime),m._playStart=e.ctx.currentTime,typeof C.bufferSource.start>"u"?m._loop?C.bufferSource.noteGrainOn(0,b,86400):C.bufferSource.noteGrainOn(0,b,y):m._loop?C.bufferSource.start(0,b,86400):C.bufferSource.start(0,b,y),A!==1/0&&(h._endTimers[m._id]=setTimeout(h._ended.bind(h,m),A)),a||setTimeout(function(){h._emit("play",m._id),h._loadQueue()},0)};e.state==="running"&&e.ctx.state!=="interrupted"?k():(h._playLock=!0,h.once("resume",k),h._clearTimer(m._id))}else{var F=function(){C.currentTime=b,C.muted=m._muted||h._muted||e._muted||C.muted,C.volume=m._volume*e.volume(),C.playbackRate=m._rate;try{var R=C.play();if(R&&typeof Promise<"u"&&(R instanceof Promise||typeof R.then=="function")?(h._playLock=!0,O(),R.then(function(){h._playLock=!1,C._unlocked=!0,a?h._loadQueue():h._emit("play",m._id)}).catch(function(){h._playLock=!1,h._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),m._ended=!0,m._paused=!0})):a||(h._playLock=!1,O(),h._emit("play",m._id)),C.playbackRate=m._rate,C.paused){h._emit("playerror",m._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}r!=="__default"||m._loop?h._endTimers[m._id]=setTimeout(h._ended.bind(h,m),A):(h._endTimers[m._id]=function(){h._ended(m),C.removeEventListener("ended",h._endTimers[m._id],!1)},C.addEventListener("ended",h._endTimers[m._id],!1))}catch(I){h._emit("playerror",m._id,I)}};C.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(C.src=h._src,C.load());var L=window&&window.ejecta||!C.readyState&&e._navigator.isCocoonJS;if(C.readyState>=3||L)F();else{h._playLock=!0,h._state="loading";var B=function(){h._state="loaded",F(),C.removeEventListener(e._canPlayEvent,B,!1)};C.addEventListener(e._canPlayEvent,B,!1),h._clearTimer(m._id)}}return m._id},pause:function(r){var a=this;if(a._state!=="loaded"||a._playLock)return a._queue.push({event:"pause",action:function(){a.pause(r)}}),a;for(var h=a._getSoundIds(r),d=0;d<h.length;d++){a._clearTimer(h[d]);var u=a._soundById(h[d]);if(u&&!u._paused&&(u._seek=a.seek(h[d]),u._rateSeek=0,u._paused=!0,a._stopFade(h[d]),u._node))if(a._webAudio){if(!u._node.bufferSource)continue;typeof u._node.bufferSource.stop>"u"?u._node.bufferSource.noteOff(0):u._node.bufferSource.stop(0),a._cleanBuffer(u._node)}else(!isNaN(u._node.duration)||u._node.duration===1/0)&&u._node.pause();arguments[1]||a._emit("pause",u?u._id:null)}return a},stop:function(r,a){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"stop",action:function(){h.stop(r)}}),h;for(var d=h._getSoundIds(r),u=0;u<d.length;u++){h._clearTimer(d[u]);var f=h._soundById(d[u]);f&&(f._seek=f._start||0,f._rateSeek=0,f._paused=!0,f._ended=!0,h._stopFade(d[u]),f._node&&(h._webAudio?f._node.bufferSource&&(typeof f._node.bufferSource.stop>"u"?f._node.bufferSource.noteOff(0):f._node.bufferSource.stop(0),h._cleanBuffer(f._node)):(!isNaN(f._node.duration)||f._node.duration===1/0)&&(f._node.currentTime=f._start||0,f._node.pause(),f._node.duration===1/0&&h._clearSound(f._node))),a||h._emit("stop",f._id))}return h},mute:function(r,a){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"mute",action:function(){h.mute(r,a)}}),h;if(typeof a>"u")if(typeof r=="boolean")h._muted=r;else return h._muted;for(var d=h._getSoundIds(a),u=0;u<d.length;u++){var f=h._soundById(d[u]);f&&(f._muted=r,f._interval&&h._stopFade(f._id),h._webAudio&&f._node?f._node.gain.setValueAtTime(r?0:f._volume,e.ctx.currentTime):f._node&&(f._node.muted=e._muted?!0:r),h._emit("mute",f._id))}return h},volume:function(){var r=this,a=arguments,h,d;if(a.length===0)return r._volume;if(a.length===1||a.length===2&&typeof a[1]>"u"){var u=r._getSoundIds(),f=u.indexOf(a[0]);f>=0?d=parseInt(a[0],10):h=parseFloat(a[0])}else a.length>=2&&(h=parseFloat(a[0]),d=parseInt(a[1],10));var m;if(typeof h<"u"&&h>=0&&h<=1){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"volume",action:function(){r.volume.apply(r,a)}}),r;typeof d>"u"&&(r._volume=h),d=r._getSoundIds(d);for(var w=0;w<d.length;w++)m=r._soundById(d[w]),m&&(m._volume=h,a[2]||r._stopFade(d[w]),r._webAudio&&m._node&&!m._muted?m._node.gain.setValueAtTime(h,e.ctx.currentTime):m._node&&!m._muted&&(m._node.volume=h*e.volume()),r._emit("volume",m._id))}else return m=d?r._soundById(d):r._sounds[0],m?m._volume:0;return r},fade:function(r,a,h,d){var u=this;if(u._state!=="loaded"||u._playLock)return u._queue.push({event:"fade",action:function(){u.fade(r,a,h,d)}}),u;r=Math.min(Math.max(0,parseFloat(r)),1),a=Math.min(Math.max(0,parseFloat(a)),1),h=parseFloat(h),u.volume(r,d);for(var f=u._getSoundIds(d),m=0;m<f.length;m++){var w=u._soundById(f[m]);if(w){if(d||u._stopFade(f[m]),u._webAudio&&!w._muted){var b=e.ctx.currentTime,y=b+h/1e3;w._volume=r,w._node.gain.setValueAtTime(r,b),w._node.gain.linearRampToValueAtTime(a,y)}u._startFadeInterval(w,r,a,h,f[m],typeof d>"u")}}return u},_startFadeInterval:function(r,a,h,d,u,f){var m=this,w=a,b=h-a,y=Math.abs(b/.01),A=Math.max(4,y>0?d/y:d),T=Date.now();r._fadeTo=h,r._interval=setInterval(function(){var j=(Date.now()-T)/d;T=Date.now(),w+=b*j,w=Math.round(w*100)/100,b<0?w=Math.max(h,w):w=Math.min(h,w),m._webAudio?r._volume=w:m.volume(w,r._id,!0),f&&(m._volume=w),(h<a&&w<=h||h>a&&w>=h)&&(clearInterval(r._interval),r._interval=null,r._fadeTo=null,m.volume(h,r._id),m._emit("fade",r._id))},A)},_stopFade:function(r){var a=this,h=a._soundById(r);return h&&h._interval&&(a._webAudio&&h._node.gain.cancelScheduledValues(e.ctx.currentTime),clearInterval(h._interval),h._interval=null,a.volume(h._fadeTo,r),h._fadeTo=null,a._emit("fade",r)),a},loop:function(){var r=this,a=arguments,h,d,u;if(a.length===0)return r._loop;if(a.length===1)if(typeof a[0]=="boolean")h=a[0],r._loop=h;else return u=r._soundById(parseInt(a[0],10)),u?u._loop:!1;else a.length===2&&(h=a[0],d=parseInt(a[1],10));for(var f=r._getSoundIds(d),m=0;m<f.length;m++)u=r._soundById(f[m]),u&&(u._loop=h,r._webAudio&&u._node&&u._node.bufferSource&&(u._node.bufferSource.loop=h,h&&(u._node.bufferSource.loopStart=u._start||0,u._node.bufferSource.loopEnd=u._stop,r.playing(f[m])&&(r.pause(f[m],!0),r.play(f[m],!0)))));return r},rate:function(){var r=this,a=arguments,h,d;if(a.length===0)d=r._sounds[0]._id;else if(a.length===1){var u=r._getSoundIds(),f=u.indexOf(a[0]);f>=0?d=parseInt(a[0],10):h=parseFloat(a[0])}else a.length===2&&(h=parseFloat(a[0]),d=parseInt(a[1],10));var m;if(typeof h=="number"){if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"rate",action:function(){r.rate.apply(r,a)}}),r;typeof d>"u"&&(r._rate=h),d=r._getSoundIds(d);for(var w=0;w<d.length;w++)if(m=r._soundById(d[w]),m){r.playing(d[w])&&(m._rateSeek=r.seek(d[w]),m._playStart=r._webAudio?e.ctx.currentTime:m._playStart),m._rate=h,r._webAudio&&m._node&&m._node.bufferSource?m._node.bufferSource.playbackRate.setValueAtTime(h,e.ctx.currentTime):m._node&&(m._node.playbackRate=h);var b=r.seek(d[w]),y=(r._sprite[m._sprite][0]+r._sprite[m._sprite][1])/1e3-b,A=y*1e3/Math.abs(m._rate);(r._endTimers[d[w]]||!m._paused)&&(r._clearTimer(d[w]),r._endTimers[d[w]]=setTimeout(r._ended.bind(r,m),A)),r._emit("rate",m._id)}}else return m=r._soundById(d),m?m._rate:r._rate;return r},seek:function(){var r=this,a=arguments,h,d;if(a.length===0)r._sounds.length&&(d=r._sounds[0]._id);else if(a.length===1){var u=r._getSoundIds(),f=u.indexOf(a[0]);f>=0?d=parseInt(a[0],10):r._sounds.length&&(d=r._sounds[0]._id,h=parseFloat(a[0]))}else a.length===2&&(h=parseFloat(a[0]),d=parseInt(a[1],10));if(typeof d>"u")return 0;if(typeof h=="number"&&(r._state!=="loaded"||r._playLock))return r._queue.push({event:"seek",action:function(){r.seek.apply(r,a)}}),r;var m=r._soundById(d);if(m)if(typeof h=="number"&&h>=0){var w=r.playing(d);w&&r.pause(d,!0),m._seek=h,m._ended=!1,r._clearTimer(d),!r._webAudio&&m._node&&!isNaN(m._node.duration)&&(m._node.currentTime=h);var b=function(){w&&r.play(d,!0),r._emit("seek",d)};if(w&&!r._webAudio){var y=function(){r._playLock?setTimeout(y,0):b()};setTimeout(y,0)}else b()}else if(r._webAudio){var A=r.playing(d)?e.ctx.currentTime-m._playStart:0,T=m._rateSeek?m._rateSeek-m._seek:0;return m._seek+(T+A*Math.abs(m._rate))}else return m._node.currentTime;return r},playing:function(r){var a=this;if(typeof r=="number"){var h=a._soundById(r);return h?!h._paused:!1}for(var d=0;d<a._sounds.length;d++)if(!a._sounds[d]._paused)return!0;return!1},duration:function(r){var a=this,h=a._duration,d=a._soundById(r);return d&&(h=a._sprite[d._sprite][1]/1e3),h},state:function(){return this._state},unload:function(){for(var r=this,a=r._sounds,h=0;h<a.length;h++)a[h]._paused||r.stop(a[h]._id),r._webAudio||(r._clearSound(a[h]._node),a[h]._node.removeEventListener("error",a[h]._errorFn,!1),a[h]._node.removeEventListener(e._canPlayEvent,a[h]._loadFn,!1),a[h]._node.removeEventListener("ended",a[h]._endFn,!1),e._releaseHtml5Audio(a[h]._node)),delete a[h]._node,r._clearTimer(a[h]._id);var d=e._howls.indexOf(r);d>=0&&e._howls.splice(d,1);var u=!0;for(h=0;h<e._howls.length;h++)if(e._howls[h]._src===r._src||r._src.indexOf(e._howls[h]._src)>=0){u=!1;break}return s&&u&&delete s[r._src],e.noAudio=!1,r._state="unloaded",r._sounds=[],r=null,null},on:function(r,a,h,d){var u=this,f=u["_on"+r];return typeof a=="function"&&f.push(d?{id:h,fn:a,once:d}:{id:h,fn:a}),u},off:function(r,a,h){var d=this,u=d["_on"+r],f=0;if(typeof a=="number"&&(h=a,a=null),a||h)for(f=0;f<u.length;f++){var m=h===u[f].id;if(a===u[f].fn&&m||!a&&m){u.splice(f,1);break}}else if(r)d["_on"+r]=[];else{var w=Object.keys(d);for(f=0;f<w.length;f++)w[f].indexOf("_on")===0&&Array.isArray(d[w[f]])&&(d[w[f]]=[])}return d},once:function(r,a,h){var d=this;return d.on(r,a,h,1),d},_emit:function(r,a,h){for(var d=this,u=d["_on"+r],f=u.length-1;f>=0;f--)(!u[f].id||u[f].id===a||r==="load")&&(setTimeout(function(m){m.call(this,a,h)}.bind(d,u[f].fn),0),u[f].once&&d.off(r,u[f].fn,u[f].id));return d._loadQueue(r),d},_loadQueue:function(r){var a=this;if(a._queue.length>0){var h=a._queue[0];h.event===r&&(a._queue.shift(),a._loadQueue()),r||h.action()}return a},_ended:function(r){var a=this,h=r._sprite;if(!a._webAudio&&r._node&&!r._node.paused&&!r._node.ended&&r._node.currentTime<r._stop)return setTimeout(a._ended.bind(a,r),100),a;var d=!!(r._loop||a._sprite[h][2]);if(a._emit("end",r._id),!a._webAudio&&d&&a.stop(r._id,!0).play(r._id),a._webAudio&&d){a._emit("play",r._id),r._seek=r._start||0,r._rateSeek=0,r._playStart=e.ctx.currentTime;var u=(r._stop-r._start)*1e3/Math.abs(r._rate);a._endTimers[r._id]=setTimeout(a._ended.bind(a,r),u)}return a._webAudio&&!d&&(r._paused=!0,r._ended=!0,r._seek=r._start||0,r._rateSeek=0,a._clearTimer(r._id),a._cleanBuffer(r._node),e._autoSuspend()),!a._webAudio&&!d&&a.stop(r._id,!0),a},_clearTimer:function(r){var a=this;if(a._endTimers[r]){if(typeof a._endTimers[r]!="function")clearTimeout(a._endTimers[r]);else{var h=a._soundById(r);h&&h._node&&h._node.removeEventListener("ended",a._endTimers[r],!1)}delete a._endTimers[r]}return a},_soundById:function(r){for(var a=this,h=0;h<a._sounds.length;h++)if(r===a._sounds[h]._id)return a._sounds[h];return null},_inactiveSound:function(){var r=this;r._drain();for(var a=0;a<r._sounds.length;a++)if(r._sounds[a]._ended)return r._sounds[a].reset();return new i(r)},_drain:function(){var r=this,a=r._pool,h=0,d=0;if(!(r._sounds.length<a)){for(d=0;d<r._sounds.length;d++)r._sounds[d]._ended&&h++;for(d=r._sounds.length-1;d>=0;d--){if(h<=a)return;r._sounds[d]._ended&&(r._webAudio&&r._sounds[d]._node&&r._sounds[d]._node.disconnect(0),r._sounds.splice(d,1),h--)}}},_getSoundIds:function(r){var a=this;if(typeof r>"u"){for(var h=[],d=0;d<a._sounds.length;d++)h.push(a._sounds[d]._id);return h}else return[r]},_refreshBuffer:function(r){var a=this;return r._node.bufferSource=e.ctx.createBufferSource(),r._node.bufferSource.buffer=s[a._src],r._panner?r._node.bufferSource.connect(r._panner):r._node.bufferSource.connect(r._node),r._node.bufferSource.loop=r._loop,r._loop&&(r._node.bufferSource.loopStart=r._start||0,r._node.bufferSource.loopEnd=r._stop||0),r._node.bufferSource.playbackRate.setValueAtTime(r._rate,e.ctx.currentTime),a},_cleanBuffer:function(r){var a=this,h=e._navigator&&e._navigator.vendor.indexOf("Apple")>=0;if(e._scratchBuffer&&r.bufferSource&&(r.bufferSource.onended=null,r.bufferSource.disconnect(0),h))try{r.bufferSource.buffer=e._scratchBuffer}catch{}return r.bufferSource=null,a},_clearSound:function(r){var a=/MSIE |Trident\//.test(e._navigator&&e._navigator.userAgent);a||(r.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var i=function(r){this._parent=r,this.init()};i.prototype={init:function(){var r=this,a=r._parent;return r._muted=a._muted,r._loop=a._loop,r._volume=a._volume,r._rate=a._rate,r._seek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,a._sounds.push(r),r.create(),r},create:function(){var r=this,a=r._parent,h=e._muted||r._muted||r._parent._muted?0:r._volume;return a._webAudio?(r._node=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),r._node.gain.setValueAtTime(h,e.ctx.currentTime),r._node.paused=!0,r._node.connect(e.masterGain)):e.noAudio||(r._node=e._obtainHtml5Audio(),r._errorFn=r._errorListener.bind(r),r._node.addEventListener("error",r._errorFn,!1),r._loadFn=r._loadListener.bind(r),r._node.addEventListener(e._canPlayEvent,r._loadFn,!1),r._endFn=r._endListener.bind(r),r._node.addEventListener("ended",r._endFn,!1),r._node.src=a._src,r._node.preload=a._preload===!0?"auto":a._preload,r._node.volume=h*e.volume(),r._node.load()),r},reset:function(){var r=this,a=r._parent;return r._muted=a._muted,r._loop=a._loop,r._volume=a._volume,r._rate=a._rate,r._seek=0,r._rateSeek=0,r._paused=!0,r._ended=!0,r._sprite="__default",r._id=++e._counter,r},_errorListener:function(){var r=this;r._parent._emit("loaderror",r._id,r._node.error?r._node.error.code:0),r._node.removeEventListener("error",r._errorFn,!1)},_loadListener:function(){var r=this,a=r._parent;a._duration=Math.ceil(r._node.duration*10)/10,Object.keys(a._sprite).length===0&&(a._sprite={__default:[0,a._duration*1e3]}),a._state!=="loaded"&&(a._state="loaded",a._emit("load"),a._loadQueue()),r._node.removeEventListener(e._canPlayEvent,r._loadFn,!1)},_endListener:function(){var r=this,a=r._parent;a._duration===1/0&&(a._duration=Math.ceil(r._node.duration*10)/10,a._sprite.__default[1]===1/0&&(a._sprite.__default[1]=a._duration*1e3),a._ended(r)),r._node.removeEventListener("ended",r._endFn,!1)}};var s={},o=function(r){var a=r._src;if(s[a]){r._duration=s[a].duration,_(r);return}if(/^data:[^;]+;base64,/.test(a)){for(var h=atob(a.split(",")[1]),d=new Uint8Array(h.length),u=0;u<h.length;++u)d[u]=h.charCodeAt(u);c(d.buffer,r)}else{var f=new XMLHttpRequest;f.open(r._xhr.method,a,!0),f.withCredentials=r._xhr.withCredentials,f.responseType="arraybuffer",r._xhr.headers&&Object.keys(r._xhr.headers).forEach(function(m){f.setRequestHeader(m,r._xhr.headers[m])}),f.onload=function(){var m=(f.status+"")[0];if(m!=="0"&&m!=="2"&&m!=="3"){r._emit("loaderror",null,"Failed loading audio file with status: "+f.status+".");return}c(f.response,r)},f.onerror=function(){r._webAudio&&(r._html5=!0,r._webAudio=!1,r._sounds=[],delete s[a],r.load())},l(f)}},l=function(r){try{r.send()}catch{r.onerror()}},c=function(r,a){var h=function(){a._emit("loaderror",null,"Decoding audio data failed.")},d=function(u){u&&a._sounds.length>0?(s[a._src]=u,_(a,u)):h()};typeof Promise<"u"&&e.ctx.decodeAudioData.length===1?e.ctx.decodeAudioData(r).then(d).catch(h):e.ctx.decodeAudioData(r,d,h)},_=function(r,a){a&&!r._duration&&(r._duration=a.duration),Object.keys(r._sprite).length===0&&(r._sprite={__default:[0,r._duration*1e3]}),r._state!=="loaded"&&(r._state="loaded",r._emit("load"),r._loadQueue())},p=function(){if(e.usingWebAudio){try{typeof AudioContext<"u"?e.ctx=new AudioContext:typeof webkitAudioContext<"u"?e.ctx=new webkitAudioContext:e.usingWebAudio=!1}catch{e.usingWebAudio=!1}e.ctx||(e.usingWebAudio=!1);var r=/iP(hone|od|ad)/.test(e._navigator&&e._navigator.platform),a=e._navigator&&e._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),h=a?parseInt(a[1],10):null;if(r&&h&&h<9){var d=/safari/.test(e._navigator&&e._navigator.userAgent.toLowerCase());e._navigator&&!d&&(e.usingWebAudio=!1)}e.usingWebAudio&&(e.masterGain=typeof e.ctx.createGain>"u"?e.ctx.createGainNode():e.ctx.createGain(),e.masterGain.gain.setValueAtTime(e._muted?0:e._volume,e.ctx.currentTime),e.masterGain.connect(e.ctx.destination)),e._setup()}};typeof define=="function"&&define.amd&&define([],function(){return{Howler:e,Howl:n}}),typeof jt<"u"&&(jt.Howler=e,jt.Howl=n),typeof global<"u"?(global.HowlerGlobal=t,global.Howler=e,global.Howl=n,global.Sound=i):typeof window<"u"&&(window.HowlerGlobal=t,window.Howler=e,window.Howl=n,window.Sound=i)})();(function(){"use strict";HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(e){var n=this;if(!n.ctx||!n.ctx.listener)return n;for(var i=n._howls.length-1;i>=0;i--)n._howls[i].stereo(e);return n},HowlerGlobal.prototype.pos=function(e,n,i){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(n=typeof n!="number"?s._pos[1]:n,i=typeof i!="number"?s._pos[2]:i,typeof e=="number")s._pos=[e,n,i],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(e,n,i,s,o,l){var c=this;if(!c.ctx||!c.ctx.listener)return c;var _=c._orientation;if(n=typeof n!="number"?_[1]:n,i=typeof i!="number"?_[2]:i,s=typeof s!="number"?_[3]:s,o=typeof o!="number"?_[4]:o,l=typeof l!="number"?_[5]:l,typeof e=="number")c._orientation=[e,n,i,s,o,l],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(e,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(n,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(i,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(o,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(l,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(e,n,i,s,o,l);else return _;return c},Howl.prototype.init=function(e){return function(n){var i=this;return i._orientation=n.orientation||[1,0,0],i._stereo=n.stereo||null,i._pos=n.pos||null,i._pannerAttr={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:360,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:360,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:0,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:"inverse",maxDistance:typeof n.maxDistance<"u"?n.maxDistance:1e4,panningModel:typeof n.panningModel<"u"?n.panningModel:"HRTF",refDistance:typeof n.refDistance<"u"?n.refDistance:1,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:1},i._onstereo=n.onstereo?[{fn:n.onstereo}]:[],i._onpos=n.onpos?[{fn:n.onpos}]:[],i._onorientation=n.onorientation?[{fn:n.onorientation}]:[],e.call(this,n)}}(Howl.prototype.init),Howl.prototype.stereo=function(e,n){var i=this;if(!i._webAudio)return i;if(i._state!=="loaded")return i._queue.push({event:"stereo",action:function(){i.stereo(e,n)}}),i;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof n>"u")if(typeof e=="number")i._stereo=e,i._pos=[e,0,0];else return i._stereo;for(var o=i._getSoundIds(n),l=0;l<o.length;l++){var c=i._soundById(o[l]);if(c)if(typeof e=="number")c._stereo=e,c._pos=[e,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&t(c,s),s==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(e,0,0):c._panner.pan.setValueAtTime(e,Howler.ctx.currentTime)),i._emit("stereo",c._id);else return c._stereo}return i},Howl.prototype.pos=function(e,n,i,s){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"pos",action:function(){o.pos(e,n,i,s)}}),o;if(n=typeof n!="number"?0:n,i=typeof i!="number"?-.5:i,typeof s>"u")if(typeof e=="number")o._pos=[e,n,i];else return o._pos;for(var l=o._getSoundIds(s),c=0;c<l.length;c++){var _=o._soundById(l[c]);if(_)if(typeof e=="number")_._pos=[e,n,i],_._node&&((!_._panner||_._panner.pan)&&t(_,"spatial"),typeof _._panner.positionX<"u"?(_._panner.positionX.setValueAtTime(e,Howler.ctx.currentTime),_._panner.positionY.setValueAtTime(n,Howler.ctx.currentTime),_._panner.positionZ.setValueAtTime(i,Howler.ctx.currentTime)):_._panner.setPosition(e,n,i)),o._emit("pos",_._id);else return _._pos}return o},Howl.prototype.orientation=function(e,n,i,s){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"orientation",action:function(){o.orientation(e,n,i,s)}}),o;if(n=typeof n!="number"?o._orientation[1]:n,i=typeof i!="number"?o._orientation[2]:i,typeof s>"u")if(typeof e=="number")o._orientation=[e,n,i];else return o._orientation;for(var l=o._getSoundIds(s),c=0;c<l.length;c++){var _=o._soundById(l[c]);if(_)if(typeof e=="number")_._orientation=[e,n,i],_._node&&(_._panner||(_._pos||(_._pos=o._pos||[0,0,-.5]),t(_,"spatial")),typeof _._panner.orientationX<"u"?(_._panner.orientationX.setValueAtTime(e,Howler.ctx.currentTime),_._panner.orientationY.setValueAtTime(n,Howler.ctx.currentTime),_._panner.orientationZ.setValueAtTime(i,Howler.ctx.currentTime)):_._panner.setOrientation(e,n,i)),o._emit("orientation",_._id);else return _._orientation}return o},Howl.prototype.pannerAttr=function(){var e=this,n=arguments,i,s,o;if(!e._webAudio)return e;if(n.length===0)return e._pannerAttr;if(n.length===1)if(typeof n[0]=="object")i=n[0],typeof s>"u"&&(i.pannerAttr||(i.pannerAttr={coneInnerAngle:i.coneInnerAngle,coneOuterAngle:i.coneOuterAngle,coneOuterGain:i.coneOuterGain,distanceModel:i.distanceModel,maxDistance:i.maxDistance,refDistance:i.refDistance,rolloffFactor:i.rolloffFactor,panningModel:i.panningModel}),e._pannerAttr={coneInnerAngle:typeof i.pannerAttr.coneInnerAngle<"u"?i.pannerAttr.coneInnerAngle:e._coneInnerAngle,coneOuterAngle:typeof i.pannerAttr.coneOuterAngle<"u"?i.pannerAttr.coneOuterAngle:e._coneOuterAngle,coneOuterGain:typeof i.pannerAttr.coneOuterGain<"u"?i.pannerAttr.coneOuterGain:e._coneOuterGain,distanceModel:typeof i.pannerAttr.distanceModel<"u"?i.pannerAttr.distanceModel:e._distanceModel,maxDistance:typeof i.pannerAttr.maxDistance<"u"?i.pannerAttr.maxDistance:e._maxDistance,refDistance:typeof i.pannerAttr.refDistance<"u"?i.pannerAttr.refDistance:e._refDistance,rolloffFactor:typeof i.pannerAttr.rolloffFactor<"u"?i.pannerAttr.rolloffFactor:e._rolloffFactor,panningModel:typeof i.pannerAttr.panningModel<"u"?i.pannerAttr.panningModel:e._panningModel});else return o=e._soundById(parseInt(n[0],10)),o?o._pannerAttr:e._pannerAttr;else n.length===2&&(i=n[0],s=parseInt(n[1],10));for(var l=e._getSoundIds(s),c=0;c<l.length;c++)if(o=e._soundById(l[c]),o){var _=o._pannerAttr;_={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:_.coneInnerAngle,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:_.coneOuterAngle,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:_.coneOuterGain,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:_.distanceModel,maxDistance:typeof i.maxDistance<"u"?i.maxDistance:_.maxDistance,refDistance:typeof i.refDistance<"u"?i.refDistance:_.refDistance,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:_.rolloffFactor,panningModel:typeof i.panningModel<"u"?i.panningModel:_.panningModel};var p=o._panner;p?(p.coneInnerAngle=_.coneInnerAngle,p.coneOuterAngle=_.coneOuterAngle,p.coneOuterGain=_.coneOuterGain,p.distanceModel=_.distanceModel,p.maxDistance=_.maxDistance,p.refDistance=_.refDistance,p.rolloffFactor=_.rolloffFactor,p.panningModel=_.panningModel):(o._pos||(o._pos=e._pos||[0,0,-.5]),t(o,"spatial"))}return e},Sound.prototype.init=function(e){return function(){var n=this,i=n._parent;n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,e.call(this),n._stereo?i.stereo(n._stereo):n._pos&&i.pos(n._pos[0],n._pos[1],n._pos[2],n._id)}}(Sound.prototype.init),Sound.prototype.reset=function(e){return function(){var n=this,i=n._parent;return n._orientation=i._orientation,n._stereo=i._stereo,n._pos=i._pos,n._pannerAttr=i._pannerAttr,n._stereo?i.stereo(n._stereo):n._pos?i.pos(n._pos[0],n._pos[1],n._pos[2],n._id):n._panner&&(n._panner.disconnect(0),n._panner=void 0,i._refreshBuffer(n)),e.call(this)}}(Sound.prototype.reset);var t=function(e,n){n=n||"spatial",n==="spatial"?(e._panner=Howler.ctx.createPanner(),e._panner.coneInnerAngle=e._pannerAttr.coneInnerAngle,e._panner.coneOuterAngle=e._pannerAttr.coneOuterAngle,e._panner.coneOuterGain=e._pannerAttr.coneOuterGain,e._panner.distanceModel=e._pannerAttr.distanceModel,e._panner.maxDistance=e._pannerAttr.maxDistance,e._panner.refDistance=e._pannerAttr.refDistance,e._panner.rolloffFactor=e._pannerAttr.rolloffFactor,e._panner.panningModel=e._pannerAttr.panningModel,typeof e._panner.positionX<"u"?(e._panner.positionX.setValueAtTime(e._pos[0],Howler.ctx.currentTime),e._panner.positionY.setValueAtTime(e._pos[1],Howler.ctx.currentTime),e._panner.positionZ.setValueAtTime(e._pos[2],Howler.ctx.currentTime)):e._panner.setPosition(e._pos[0],e._pos[1],e._pos[2]),typeof e._panner.orientationX<"u"?(e._panner.orientationX.setValueAtTime(e._orientation[0],Howler.ctx.currentTime),e._panner.orientationY.setValueAtTime(e._orientation[1],Howler.ctx.currentTime),e._panner.orientationZ.setValueAtTime(e._orientation[2],Howler.ctx.currentTime)):e._panner.setOrientation(e._orientation[0],e._orientation[1],e._orientation[2])):(e._panner=Howler.ctx.createStereoPanner(),e._panner.pan.setValueAtTime(e._stereo,Howler.ctx.currentTime)),e._panner.connect(e._node),e._paused||e._parent.pause(e._id,!0).play(e._id,!0)}})()});var g;(function(t){t[t.Bool=2]="Bool",t[t.Int=4]="Int",t[t.Float=8]="Float",t[t.String=16]="String",t[t.Enum=32]="Enum",t[t.Object=64]="Object",t[t.Mesh=128]="Mesh",t[t.Texture=256]="Texture",t[t.Material=512]="Material",t[t.Animation=1024]="Animation",t[t.Skin=2048]="Skin",t[t.Color=4096]="Color"})(g||(g={}));var pt;(function(t){t[t.Sphere=0]="Sphere",t[t.AxisAlignedBox=1]="AxisAlignedBox",t[t.Box=2]="Box"})(pt||(pt={}));var pn;(function(t){t[t.Left=1]="Left",t[t.Center=2]="Center",t[t.Right=3]="Right"})(pn||(pn={}));var dn;(function(t){t[t.Line=1]="Line",t[t.Middle=2]="Middle",t[t.Top=3]="Top",t[t.Bottom=4]="Bottom"})(dn||(dn={}));var mn;(function(t){t[t.None=0]="None",t[t.Outline=1]="Outline"})(mn||(mn={}));var un;(function(t){t[t.Head=0]="Head",t[t.EyeLeft=1]="EyeLeft",t[t.EyeRight=2]="EyeRight",t[t.ControllerLeft=3]="ControllerLeft",t[t.ControllerRight=4]="ControllerRight",t[t.RayLeft=5]="RayLeft",t[t.RayRight=6]="RayRight"})(un||(un={}));var fn;(function(t){t[t.Point=1]="Point",t[t.Spot=2]="Spot",t[t.Sun=3]="Sun"})(fn||(fn={}));var gn;(function(t){t[t.Playing=1]="Playing",t[t.Paused=2]="Paused",t[t.Stopped=3]="Stopped"})(gn||(gn={}));var dt;(function(t){t[t.Force=0]="Force",t[t.Impulse=1]="Impulse",t[t.VelocityChange=2]="VelocityChange",t[t.Acceleration=3]="Acceleration"})(dt||(dt={}));var vn;(function(t){t[t.Touch=0]="Touch",t[t.TouchLost=1]="TouchLost",t[t.TriggerTouch=2]="TriggerTouch",t[t.TriggerTouchLost=3]="TriggerTouchLost"})(vn||(vn={}));var ue;(function(t){t[t.None=0]="None",t[t.Sphere=1]="Sphere",t[t.Capsule=2]="Capsule",t[t.Box=3]="Box",t[t.Plane=4]="Plane",t[t.ConvexMesh=5]="ConvexMesh",t[t.TriangleMesh=6]="TriangleMesh"})(ue||(ue={}));var N;(function(t){t[t.Position=0]="Position",t[t.Tangent=1]="Tangent",t[t.Normal=2]="Normal",t[t.TextureCoordinate=3]="TextureCoordinate",t[t.Color=4]="Color",t[t.JointId=5]="JointId",t[t.JointWeight=6]="JointWeight",t[t.SecondaryJointId=7]="SecondaryJointId",t[t.SecondaryJointWeight=8]="SecondaryJointWeight"})(N||(N={}));var Y;(function(t){t[t.UnsignedInt=0]="UnsignedInt",t[t.Int=1]="Int",t[t.Float=2]="Float",t[t.Sampler=3]="Sampler",t[t.Font=4]="Font"})(Y||(Y={}));var x=class{_manager;_id;_object;_type;_engine;constructor(e,n=-1,i=-1){this._engine=e,this._manager=n,this._id=i,this._object=null,this._type=null}get engine(){return this._engine}get type(){return this._type||this._engine.wasm._typeNameFor(this._manager)}get object(){if(!this._object){let e=this._engine.wasm._wl_component_get_object(this._manager,this._id);this._object=this._engine.wrapObject(e)}return this._object}set active(e){this._engine.wasm._wl_component_setActive(this._manager,this._id,e)}get active(){return this._engine.wasm._wl_component_isActive(this._manager,this._id)!=0}destroy(){this._engine.wasm._wl_component_remove(this._manager,this._id),this._manager=void 0,this._id=void 0}equals(e){return e?this._manager==e._manager&&this._id==e._id:!1}};M(x,"TypeName"),M(x,"Properties");var le=class extends x{set material(e){this._engine.wasm._wl_mesh_component_set_material(this._id,e?e._index:0)}get material(){let e=this._engine.wasm._wl_mesh_component_get_material(this._id);return e>0?new ce(this._engine,e):null}get mesh(){let e=this._engine.wasm._wl_mesh_component_get_mesh(this._id);return e>0?new $(this._engine,e):null}set mesh(e){this._engine.wasm._wl_mesh_component_set_mesh(this._id,e?e._index:0)}get skin(){let e=this._engine.wasm._wl_mesh_component_get_skin(this._id);return e>0?new mt(this._engine,e):null}set skin(e){this._engine.wasm._wl_mesh_component_set_skin(this._id,e?e._index:0)}};M(le,"TypeName","mesh");var wn;(function(t){t[t.None=0]="None",t[t.X=1]="X",t[t.Y=2]="Y",t[t.Z=4]="Z"})(wn||(wn={}));var Ke=class extends x{set static(e){this._engine.wasm._wl_physx_component_set_static(this._id,e)}get static(){return!!this._engine.wasm._wl_physx_component_get_static(this._id)}set kinematic(e){this._engine.wasm._wl_physx_component_set_kinematic(this._id,e)}get kinematic(){return!!this._engine.wasm._wl_physx_component_get_kinematic(this._id)}set gravity(e){this._engine.wasm._wl_physx_component_set_gravity(this._id,e)}get gravity(){return!!this._engine.wasm._wl_physx_component_get_gravity(this._id)}set simulate(e){this._engine.wasm._wl_physx_component_set_simulate(this._id,e)}get simulate(){return!!this._engine.wasm._wl_physx_component_get_simulate(this._id)}set allowSimulation(e){this._engine.wasm._wl_physx_component_set_allowSimulation(this._id,e)}get allowSimulation(){return!!this._engine.wasm._wl_physx_component_get_allowSimulation(this._id)}set allowQuery(e){this._engine.wasm._wl_physx_component_set_allowQuery(this._id,e)}get allowQuery(){return!!this._engine.wasm._wl_physx_component_get_allowQuery(this._id)}set trigger(e){this._engine.wasm._wl_physx_component_set_trigger(this._id,e)}get trigger(){return!!this._engine.wasm._wl_physx_component_get_trigger(this._id)}set shape(e){this._engine.wasm._wl_physx_component_set_shape(this._id,e)}get shape(){return this._engine.wasm._wl_physx_component_get_shape(this._id)}set shapeData(e){e==null||![ue.TriangleMesh,ue.ConvexMesh].includes(this.shape)||this._engine.wasm._wl_physx_component_set_shape_data(this._id,e.index)}get shapeData(){return[ue.TriangleMesh,ue.ConvexMesh].includes(this.shape)?{index:this._engine.wasm._wl_physx_component_get_shape_data(this._id)}:null}set extents(e){this.extents.set(e)}get extents(){let e=this._engine.wasm,n=e._wl_physx_component_get_extents(this._id);return new Float32Array(e.HEAPF32.buffer,n,3)}get staticFriction(){return this._engine.wasm._wl_physx_component_get_staticFriction(this._id)}set staticFriction(e){this._engine.wasm._wl_physx_component_set_staticFriction(this._id,e)}get dynamicFriction(){return this._engine.wasm._wl_physx_component_get_dynamicFriction(this._id)}set dynamicFriction(e){this._engine.wasm._wl_physx_component_set_dynamicFriction(this._id,e)}get bounciness(){return this._engine.wasm._wl_physx_component_get_bounciness(this._id)}set bounciness(e){this._engine.wasm._wl_physx_component_set_bounciness(this._id,e)}get linearDamping(){return this._engine.wasm._wl_physx_component_get_linearDamping(this._id)}set linearDamping(e){this._engine.wasm._wl_physx_component_set_linearDamping(this._id,e)}get angularDamping(){return this._engine.wasm._wl_physx_component_get_angularDamping(this._id)}set angularDamping(e){this._engine.wasm._wl_physx_component_set_angularDamping(this._id,e)}set linearVelocity(e){this._engine.wasm._wl_physx_component_set_linearVelocity(this._id,e[0],e[1],e[2])}get linearVelocity(){let e=this._engine.wasm;return e._wl_physx_component_get_linearVelocity(this._id,e._tempMem),new Float32Array(e.HEAPF32.buffer,e._tempMem,3)}set angularVelocity(e){this._engine.wasm._wl_physx_component_set_angularVelocity(this._id,e[0],e[1],e[2])}get angularVelocity(){let e=this._engine.wasm;return e._wl_physx_component_get_angularVelocity(this._id,e._tempMem),new Float32Array(e.HEAPF32.buffer,e._tempMem,3)}set groupsMask(e){this._engine.wasm._wl_physx_component_set_groupsMask(this._id,e)}get groupsMask(){return this._engine.wasm._wl_physx_component_get_groupsMask(this._id)}set blocksMask(e){this._engine.wasm._wl_physx_component_set_blocksMask(this._id,e)}get blocksMask(){return this._engine.wasm._wl_physx_component_get_blocksMask(this._id)}set linearLockAxis(e){this._engine.wasm._wl_physx_component_set_linearLockAxis(this._id,e)}get linearLockAxis(){return this._engine.wasm._wl_physx_component_get_linearLockAxis(this._id)}set angularLockAxis(e){this._engine.wasm._wl_physx_component_set_angularLockAxis(this._id,e)}get angularLockAxis(){return this._engine.wasm._wl_physx_component_get_angularLockAxis(this._id)}set mass(e){this._engine.wasm._wl_physx_component_set_mass(this._id,e)}get mass(){return this._engine.wasm._wl_physx_component_get_mass(this._id)}set massSpaceInteriaTensor(e){this._engine.wasm._wl_physx_component_set_massSpaceInertiaTensor(this._id,e[0],e[1],e[2])}addForce(e,n,i,s,o){n=n||dt.Force,s?this._engine.wasm._wl_physx_component_addForceAt(this._id,e[0],e[1],e[2],n,!!i,s[0],s[1],s[2],!!o):this._engine.wasm._wl_physx_component_addForce(this._id,e[0],e[1],e[2],n,!!i)}addTorque(e,n=dt.Force){this._engine.wasm._wl_physx_component_addTorque(this._id,e[0],e[1],e[2],n)}onCollision(e){return this.onCollisionWith(this,e)}onCollisionWith(e,n){let i=this._engine.physics;return i._callbacks[this._id]=i._callbacks[this._id]||[],i._callbacks[this._id].push(n),this._engine.wasm._wl_physx_component_addCallback(this._id,e._id||this._id)}removeCollisionCallback(e){let n=this._engine.physics,i=this._engine.wasm._wl_physx_component_removeCallback(this._id,e);i&&n._callbacks[this._id].splice(-i)}};M(Ke,"TypeName","physx");for(let t of["static","extents","staticFriction","dynamicFriction","bounciness","linearDamping","angularDamping","shape","shapeData","kinematic","linearVelocity","angularVelocity","mass"])Object.defineProperty(Ke.prototype,t,{enumerable:!0});var G;(function(t){t[t.UnsignedByte=1]="UnsignedByte",t[t.UnsignedShort=2]="UnsignedShort",t[t.UnsignedInt=4]="UnsignedInt"})(G||(G={}));var $=class{static get VERTEX_FLOAT_SIZE(){return 3+3+2}static get VERTEX_SIZE(){return this.VERTEX_FLOAT_SIZE*4}static get POS(){return{X:0,Y:1,Z:2}}static get TEXCOORD(){return{U:3,V:4}}static get NORMAL(){return{X:5,Y:6,Z:7}}_index;_engine;constructor(e,n){if(this._engine=e??WL,typeof n=="object"){if(!n.vertexCount&&n.vertexData&&(n.vertexCount=n.vertexData.length/$.VERTEX_FLOAT_SIZE),!n.vertexCount)throw new Error("Missing parameter 'vertexCount'");let i=this._engine.wasm,s=0,o=0,l=0;if(n.indexData)switch(o=n.indexType||G.UnsignedShort,l=n.indexData.length*o,s=i._malloc(l),o){case G.UnsignedByte:i.HEAPU8.set(n.indexData,s);break;case G.UnsignedShort:i.HEAPU16.set(n.indexData,s>>1);break;case G.UnsignedInt:i.HEAPU32.set(n.indexData,s>>2);break}let{skinned:c=!1}=n;if(this._index=i._wl_mesh_create(s,l,o,n.vertexCount,c),n.vertexData){let _=this.attribute(N.Position),p=this.attribute(N.Normal),r=this.attribute(N.TextureCoordinate);for(let a=0;a<n.vertexCount;++a){let h=a*$.VERTEX_FLOAT_SIZE;_.set(a,n.vertexData.subarray(h,h+3)),r?.set(a,n.vertexData.subarray(h+3,h+5)),p?.set(a,n.vertexData.subarray(h+5,h+8))}}}else this._index=n}get vertexData(){let e=this._engine.wasm,n=e._wl_mesh_get_vertexData(this._index,this._engine.wasm._tempMem);return new Float32Array(e.HEAPF32.buffer,n,$.VERTEX_FLOAT_SIZE*e.HEAPU32[this._engine.wasm._tempMem/4])}get vertexCount(){return this._engine.wasm._wl_mesh_get_vertexCount(this._index)}get indexData(){let e=this._engine.wasm,n=e._tempMem,i=e._wl_mesh_get_indexData(this._index,n,n+4);if(i===null)return null;let s=e.HEAPU32[n/4];switch(e.HEAPU32[n/4+1]){case G.UnsignedByte:return new Uint8Array(e.HEAPU8.buffer,i,s);case G.UnsignedShort:return new Uint16Array(e.HEAPU16.buffer,i,s);case G.UnsignedInt:return new Uint32Array(e.HEAPU32.buffer,i,s)}return null}update(){this._engine.wasm._wl_mesh_update(this._index)}getBoundingSphere(e=new Float32Array(4)){let n=this._engine.wasm._tempMemFloat;return this._engine.wasm._wl_mesh_get_boundingSphere(this._index,this._engine.wasm._tempMem),e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}attribute(e){if(typeof e!="number")throw new TypeError("Expected number, but got "+typeof e);let n=this._engine.wasm._tempMemUint32;if(this._engine.wasm._wl_mesh_get_attribute(this._index,e,this._engine.wasm._tempMem),n[0]==255)return null;let i=new It(this._engine,e);i._attribute=n[0],i._offset=n[1],i._stride=n[2],i._formatSize=n[3],i._componentCount=n[4];let s=n[5];return i._arraySize=s||1,i.length=this.vertexCount,i}destroy(){this._engine.wasm._wl_mesh_destroy(this._index)}},It=class{_attribute=-1;_offset=0;_stride=0;_formatSize=0;_componentCount=0;_arraySize=1;length=0;_engine;_bufferType;_tempBufferGetter;constructor(e,n=N.Position){this._engine=e;let i=this._engine.wasm;switch(n){case N.Position:case N.Normal:case N.TextureCoordinate:case N.Tangent:case N.Color:case N.JointWeight:this._bufferType=Float32Array,this._tempBufferGetter=i.getTempBufferF32.bind(i);break;case N.JointId:this._bufferType=Uint16Array,this._tempBufferGetter=i.getTempBufferU16.bind(i);break;case N.SecondaryJointWeight:case N.SecondaryJointId:console.error(`Deprecated attribute accessor type: ${n}`);default:throw new Error(`Invalid attribute accessor type: ${n}`)}}createArray(e=1){return e=e>this.length?this.length:e,new this._bufferType(e*this._componentCount*this._arraySize)}get(e,n=this.createArray()){if(n.length%this._componentCount!==0)throw new Error(`out.length, ${n.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let i=this._tempBufferGetter(n.length),s=this._bufferType.BYTES_PER_ELEMENT,o=s*n.length,l=this._formatSize*this._arraySize,c=this._componentCount*s*this._arraySize;this._engine.wasm._wl_mesh_get_attribute_values(this._attribute,l,this._offset+e*this._stride,this._stride,c,i.byteOffset,o);for(let _=0;_<n.length;++_)n[_]=i[_];return n}set(e,n){if(n.length%this._componentCount!==0)throw new Error(`out.length, ${n.length} is not a multiple of the attribute vector components, ${this._componentCount}`);let i=this._bufferType.BYTES_PER_ELEMENT,s=i*n.length,o=this._componentCount*i*this._arraySize,l=this._formatSize*this._arraySize,c=this._engine.wasm;if(n.buffer!=c.HEAPU8.buffer){let _=this._tempBufferGetter(n.length);_.set(n),n=_}return c._wl_mesh_set_attribute_values(this._attribute,o,n.byteOffset,s,l,this._offset+e*this._stride,this._stride),this}},ce=class{_index;_definition;_engine;constructor(e,n){if(this._engine=e,typeof n!="number"){if(!n?.pipeline)throw new Error("Missing parameter 'pipeline'");let i=this._engine.wasm,s=n.pipeline,o=i.lengthBytesUTF8(s)+1;if(i.stringToUTF8(s,i._tempMem,o),this._index=i._wl_material_create(i._tempMem),this._index<0)throw new Error(`No such pipeline '${s}'`)}else this._index=n;if(this._definition=this._engine.wasm._wl_material_get_definition(this._index),!this._engine.wasm._materialDefinitions[this._definition])throw new Error(`Material Definition ${this._definition} not found for material with index ${this._index}`);return new Proxy(this,{get(i,s){let o=e.wasm,c=o._materialDefinitions[i._definition].get(s);if(!c)return i[s];if(o._wl_material_get_param_value(i._index,c.index,o._tempMem)){let _=c.type;switch(_.type){case Y.UnsignedInt:return _.componentCount==1?o._tempMemUint32[0]:new Uint32Array(o.HEAPU32.buffer,o._tempMem,_.componentCount);case Y.Int:return _.componentCount==1?o._tempMemInt[0]:new Int32Array(o.HEAP32.buffer,o._tempMem,_.componentCount);case Y.Float:return _.componentCount==1?o._tempMemFloat[0]:new Float32Array(o.HEAPF32.buffer,o._tempMem,_.componentCount);case Y.Sampler:return new _e(e,o._tempMemInt[0]);default:throw new Error(`Invalid type ${_} on parameter ${c.index} for material ${i._index}`)}}},set(i,s,o){let l=e.wasm,_=l._materialDefinitions[i._definition].get(s);if(!_)return i[s]=o,!0;switch(_.type.type){case Y.UnsignedInt:case Y.Int:case Y.Sampler:let r=o.id??o;l._wl_material_set_param_value_uint(i._index,_.index,r);break;case Y.Float:let a=1;if(typeof o=="number")l._tempMemFloat[0]=o;else{a=o.length;for(let h=0;h<a;++h)l._tempMemFloat[h]=o[h]}l._wl_material_set_param_value_float(i._index,_.index,l._tempMem,a);break;case Y.Font:throw new Error("Setting font properties is currently unsupported.")}return!0}})}get shader(){let e=this._engine.wasm;return e.UTF8ToString(e._wl_material_get_shader(this._index))}clone(){let e=this._engine.wasm._wl_material_clone(this._index);return e>0?new ce(this._engine,e):null}static wrap(e,n){return n>0?new ce(e,n):null}},me=null,_e=class{_engine;_id=0;_imageIndex=void 0;constructor(e,n){this._engine=e??WL;let i=e.wasm;if(n instanceof HTMLImageElement||n instanceof HTMLVideoElement||n instanceof HTMLCanvasElement){let s=i._images.length;i._images.push(n),this._imageIndex=s,this._id=this._engine.wasm._wl_renderer_addImage(s)}else this._id=n;this._engine.textures[this._id]=this}get valid(){return this._id>=0}get id(){return this._id}update(){this.valid&&this._engine.wasm._wl_renderer_updateImage(this._id,this._imageIndex)}get width(){return this._engine.wasm._wl_texture_width(this._id)}get height(){return this._engine.wasm._wl_texture_height(this._id)}updateSubImage(e,n,i,s){if(!this.valid)return;me||(me=document.createElement("canvas"));let o=this._engine.wasm,l=o._images[this._imageIndex];if(l){me.width=i,me.height=s,me.getContext("2d")?.drawImage(l,e,n,i,s,0,0,i,s),o._images[this._imageIndex]=me;try{o._wl_renderer_updateImage(this._id,this._imageIndex,e,(l.videoHeight||l.height)-n-s)}finally{o._images[this._imageIndex]=l}}}destroy(){this._engine.wasm._wl_texture_destroy(this._id),this._imageIndex&&(this._engine.wasm._images[this._imageIndex]=null,this._imageIndex=void 0)}};var mt=class{_index;_engine;constructor(e,n){this._engine=e,this._index=n}get jointCount(){return this._engine.wasm._wl_skin_get_joint_count(this._index)}get jointIds(){let e=this._engine.wasm;return new Uint16Array(e.HEAPU16.buffer,e._wl_skin_joint_ids(this._index),this.jointCount)}get inverseBindTransforms(){let e=this._engine.wasm;return new Float32Array(e.HEAPF32.buffer,e._wl_skin_inverse_bind_transforms(this._index),8*this.jointCount)}get inverseBindScalings(){let e=this._engine.wasm;return new Float32Array(e.HEAPF32.buffer,e._wl_skin_inverse_bind_scalings(this._index),3*this.jointCount)}};var Oo=new Map([[g.Bool,!1],[g.Int,0],[g.Float,0],[g.String,""],[g.Enum,void 0],[g.Object,null],[g.Mesh,null],[g.Texture,null],[g.Material,null],[g.Animation,null],[g.Skin,null],[g.Color,[0,0,0,1]]]);var fe=class extends x{name="wonderland-engine-8thwall-camera";started=!1;view=null;position=[0,0,0];rotation=[0,0,0,-1];glTextureRenderer=null;promptForDeviceMotion(){return new Promise(async(e,n)=>{window.dispatchEvent(new Event("8thwall-request-user-interaction")),window.addEventListener("8thwall-safe-to-request-permissions",async()=>{try{let i=await DeviceMotionEvent.requestPermission();e(i)}catch(i){n(i)}})})}async getPermissions(){if(DeviceMotionEvent&&DeviceMotionEvent.requestPermission)try{if(await DeviceMotionEvent.requestPermission()!=="granted")throw new Error("MotionEvent")}catch(e){if(e.name==="NotAllowedError"){if(await this.promptForDeviceMotion()!=="granted")throw new Error("MotionEvent")}else throw new Error("MotionEvent")}try{(await navigator.mediaDevices.getUserMedia({video:!0,audio:!0})).getTracks().forEach(n=>{n.stop()})}catch{throw new Error("Camera")}}init(){this.view=this.object.getComponent("view"),this.onUpdate=this.onUpdate.bind(this),this.onAttach=this.onAttach.bind(this),this.onException=this.onException.bind(this),this.onCameraStatusChange=this.onCameraStatusChange.bind(this)}async start(){this.view=this.object.getComponent("view"),this.useCustomUIOverlays||hi.init();try{await this.getPermissions()}catch(n){window.dispatchEvent(new CustomEvent("8thwall-permission-fail",{detail:n}));return}await this.waitForXR8(),XR8.XrController.configure({disableWorldTracking:!1}),this.glTextureRenderer=XR8.GlTextureRenderer.pipelineModule(),XR8.addCameraPipelineModules([this.glTextureRenderer,XR8.XrController.pipelineModule(),this]);let e={cameraConfig:{direction:XR8.XrConfig.camera().BACK},canvas:Module.canvas,allowedDevices:XR8.XrConfig.device().ANY,ownRunLoop:!1};XR8.run(e)}onAttach(e){this.started=!0,this.engine.scene.colorClearEnabled=!1;let n=Module.ctx,i=this.object.rotationWorld,s=this.object.getTranslationWorld([]);this.position=Array.from(s),this.rotation=Array.from(i),XR8.XrController.updateCameraProjectionMatrix({origin:{x:s[0],y:s[1],z:s[2]},facing:{x:i[0],y:i[1],z:i[2],w:i[3]},cam:{pixelRectWidth:Module.canvas.width,pixelRectHeight:Module.canvas.height,nearClipPlane:this.view.near,farClipPlane:this.view.far}}),this.engine.scene.onPreRender.push(()=>{n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),XR8.runPreRender(Date.now()),XR8.runRender()}),this.engine.scene.onPostRender.push(()=>{XR8.runPostRender(Date.now())})}onCameraStatusChange(e){e&&e.status==="failed"&&this.onException(new Error(`Camera failed with status: ${e.status}`))}onUpdate(e){if(!e.processCpuResult.reality)return;let{rotation:n,position:i,intrinsics:s}=e.processCpuResult.reality;if(this.rotation[0]=n.x,this.rotation[1]=n.y,this.rotation[2]=n.z,this.rotation[3]=n.w,this.position[0]=i.x,this.position[1]=i.y,this.position[2]=i.z,s){let o=this.view.projectionMatrix;for(let l=0;l<16;l++)Number.isFinite(s[l])&&(o[l]=s[l])}i&&n&&(this.object.rotationWorld=this.rotation,this.object.setTranslationWorld(this.position))}onException(e){console.error("8thwall exception:",e),window.dispatchEvent(new CustomEvent("8thwall-error",{detail:e}))}waitForXR8(){return new Promise((e,n)=>{window.XR8?e():window.addEventListener("xrloaded",()=>e())})}};M(fe,"TypeName","8thwall-camera"),M(fe,"Properties",{useCustomUIOverlays:{type:g.Bool,default:!1}});var hi={init:function(){this.handleRequestUserInteraction=this.handleRequestUserInteraction.bind(this),this.handlePermissionFail=this.handlePermissionFail.bind(this),this.handleError=this.handleError.bind(this),window.addEventListener("8thwall-request-user-interaction",this.handleRequestUserInteraction),window.addEventListener("8thwall-permission-fail",this.handlePermissionFail),window.addEventListener("8thwall-error",this.handleError)},handleRequestUserInteraction:function(){let t=this.showOverlay(pi);window.addEventListener("8thwall-safe-to-request-permissions",()=>{t.remove()})},handlePermissionFail:function(t){this.showOverlay(di)},handleError:function(t){this.showOverlay(mi)},showOverlay:function(t){let e=document.createElement("div");return e.innerHTML=t,document.body.appendChild(e),e}},pi=`
<style>
  #request-permission-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .request-permission-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .request-permission-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="request-permission-overlay">
  <div class="request-permission-overlay_title">This app requires to use your camera and motion sensors</div>

  <button class="request-permission-overlay_button" onclick="window.dispatchEvent(new Event('8thwall-safe-to-request-permissions'))">OK</button>
</div>`,di=`
<style>
  #failed-permission-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .failed-permission-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .failed-permission-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="failed-permission-overlay">
  <div class="failed-permission-overlay_title">Failed to grant permissions. Reset the the permissions and refresh the page.</div>

  <button class="failed-permission-overlay_button" onclick="window.location.reload()">Refresh the page</button>
</div>`,mi=`
<style>
  #wall-error-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: 999;
    color: #fff;
    background-color: rgba(0, 0, 0, 0.5);
    text-align: center;
    font-family: sans-serif;
  }

  .wall-error-overlay_title {
    margin: 30px;
    font-size: 32px;
  }

  .wall-error-overlay_button {
    background-color: #e80086;
    font-size: 22px;
    padding: 10px 30px;
    color: #fff;
    border-radius: 15px;
    border: none;
  }
</style>

<div id="wall-error-overlay">
  <div class="wall-error-overlay_title">Error has occurred. Please reload the page</div>

  <button class="wall-error-overlay_button" onclick="window.location.reload()">Reload</button>
</div>`;var ge=class extends x{init(){this.hoverFunctions=[],this.unHoverFunctions=[],this.clickFunctions=[],this.moveFunctions=[],this.downFunctions=[],this.upFunctions=[]}onHover(e,n){for(let i of this.hoverFunctions)i(e,n)}onUnhover(e,n){for(let i of this.unHoverFunctions)i(e,n)}onClick(e,n){for(let i of this.clickFunctions)i(e,n)}onMove(e,n){for(let i of this.moveFunctions)i(e,n)}onDown(e,n){for(let i of this.downFunctions)i(e,n)}onUp(e,n){for(let i of this.upFunctions)i(e,n)}addHoverFunction(e){this._validateCallback(e),this.hoverFunctions.push(e)}removeHoverFunction(e){this._validateCallback(e),this._removeItemOnce(this.hoverFunctions,e)}addUnHoverFunction(e){this._validateCallback(e),this.unHoverFunctions.push(e)}removeUnHoverFunction(e){this._validateCallback(e),this._removeItemOnce(this.unHoverFunctions,e)}addClickFunction(e){this._validateCallback(e),this.clickFunctions.push(e)}removeClickFunction(e){this._validateCallback(e),this._removeItemOnce(this.clickFunctions,e)}addMoveFunction(e){this._validateCallback(e),this.moveFunctions.push(e)}removeMoveFunction(e){this._validateCallback(e),this._removeItemOnce(this.moveFunctions,e)}addDownFunction(e){this._validateCallback(e),this.downFunctions.push(e)}removeDownFunction(e){this._validateCallback(e),this._removeItemOnce(this.downFunctions,e)}addUpFunction(e){this._validateCallback(e),this.upFunctions.push(e)}removeUpFunction(e){this._validateCallback(e),this._removeItemOnce(this.upFunctions,e)}_removeItemOnce(e,n){var i=e.indexOf(n);return i>-1&&e.splice(i,1),e}_validateCallback(e){if(typeof e!="function")throw new TypeError(this.object.name+".cursor-target: Argument needs to be a function")}};M(ge,"TypeName","cursor-target"),M(ge,"Properties",{});var P=1e-6,E=typeof Float32Array<"u"?Float32Array:Array,W=Math.random;var Ko=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function bn(){var t=new E(9);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}var ie={};Je(ie,{add:()=>Zi,adjoint:()=>Mi,clone:()=>gi,copy:()=>vi,create:()=>fi,determinant:()=>Ti,equals:()=>tr,exactEquals:()=>er,frob:()=>$i,fromQuat:()=>Ni,fromQuat2:()=>Li,fromRotation:()=>Ri,fromRotationTranslation:()=>Mn,fromRotationTranslationScale:()=>Di,fromRotationTranslationScaleOrigin:()=>zi,fromScaling:()=>Ei,fromTranslation:()=>Oi,fromValues:()=>wi,fromXRotation:()=>ki,fromYRotation:()=>Fi,fromZRotation:()=>Bi,frustum:()=>Ui,getRotation:()=>Et,getScaling:()=>Tn,getTranslation:()=>Ot,identity:()=>xn,invert:()=>yi,lookAt:()=>Yi,mul:()=>nr,multiply:()=>yn,multiplyScalar:()=>Ji,multiplyScalarAndAdd:()=>Ki,ortho:()=>Xi,orthoNO:()=>jn,orthoZO:()=>qi,perspective:()=>Vi,perspectiveFromFieldOfView:()=>Wi,perspectiveNO:()=>An,perspectiveZO:()=>Hi,rotate:()=>Si,rotateX:()=>Ci,rotateY:()=>Pi,rotateZ:()=>Ii,scale:()=>ji,set:()=>bi,str:()=>Qi,sub:()=>ir,subtract:()=>Sn,targetTo:()=>Gi,translate:()=>Ai,transpose:()=>xi});function fi(){var t=new E(16);return E!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function gi(t){var e=new E(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function vi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function wi(t,e,n,i,s,o,l,c,_,p,r,a,h,d,u,f){var m=new E(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=i,m[4]=s,m[5]=o,m[6]=l,m[7]=c,m[8]=_,m[9]=p,m[10]=r,m[11]=a,m[12]=h,m[13]=d,m[14]=u,m[15]=f,m}function bi(t,e,n,i,s,o,l,c,_,p,r,a,h,d,u,f,m){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=o,t[5]=l,t[6]=c,t[7]=_,t[8]=p,t[9]=r,t[10]=a,t[11]=h,t[12]=d,t[13]=u,t[14]=f,t[15]=m,t}function xn(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function xi(t,e){if(t===e){var n=e[1],i=e[2],s=e[3],o=e[6],l=e[7],c=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=s,t[13]=l,t[14]=c}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function yi(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=e[4],c=e[5],_=e[6],p=e[7],r=e[8],a=e[9],h=e[10],d=e[11],u=e[12],f=e[13],m=e[14],w=e[15],b=n*c-i*l,y=n*_-s*l,A=n*p-o*l,T=i*_-s*c,j=i*p-o*c,O=s*p-o*_,C=r*f-a*u,k=r*m-h*u,F=r*w-d*u,L=a*m-h*f,B=a*w-d*f,R=h*w-d*m,I=b*R-y*B+A*L+T*F-j*k+O*C;return I?(I=1/I,t[0]=(c*R-_*B+p*L)*I,t[1]=(s*B-i*R-o*L)*I,t[2]=(f*O-m*j+w*T)*I,t[3]=(h*j-a*O-d*T)*I,t[4]=(_*F-l*R-p*k)*I,t[5]=(n*R-s*F+o*k)*I,t[6]=(m*A-u*O-w*y)*I,t[7]=(r*O-h*A+d*y)*I,t[8]=(l*B-c*F+p*C)*I,t[9]=(i*F-n*B-o*C)*I,t[10]=(u*j-f*A+w*b)*I,t[11]=(a*A-r*j-d*b)*I,t[12]=(c*k-l*L-_*C)*I,t[13]=(n*L-i*k+s*C)*I,t[14]=(f*y-u*T-m*b)*I,t[15]=(r*T-a*y+h*b)*I,t):null}function Mi(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=e[4],c=e[5],_=e[6],p=e[7],r=e[8],a=e[9],h=e[10],d=e[11],u=e[12],f=e[13],m=e[14],w=e[15];return t[0]=c*(h*w-d*m)-a*(_*w-p*m)+f*(_*d-p*h),t[1]=-(i*(h*w-d*m)-a*(s*w-o*m)+f*(s*d-o*h)),t[2]=i*(_*w-p*m)-c*(s*w-o*m)+f*(s*p-o*_),t[3]=-(i*(_*d-p*h)-c*(s*d-o*h)+a*(s*p-o*_)),t[4]=-(l*(h*w-d*m)-r*(_*w-p*m)+u*(_*d-p*h)),t[5]=n*(h*w-d*m)-r*(s*w-o*m)+u*(s*d-o*h),t[6]=-(n*(_*w-p*m)-l*(s*w-o*m)+u*(s*p-o*_)),t[7]=n*(_*d-p*h)-l*(s*d-o*h)+r*(s*p-o*_),t[8]=l*(a*w-d*f)-r*(c*w-p*f)+u*(c*d-p*a),t[9]=-(n*(a*w-d*f)-r*(i*w-o*f)+u*(i*d-o*a)),t[10]=n*(c*w-p*f)-l*(i*w-o*f)+u*(i*p-o*c),t[11]=-(n*(c*d-p*a)-l*(i*d-o*a)+r*(i*p-o*c)),t[12]=-(l*(a*m-h*f)-r*(c*m-_*f)+u*(c*h-_*a)),t[13]=n*(a*m-h*f)-r*(i*m-s*f)+u*(i*h-s*a),t[14]=-(n*(c*m-_*f)-l*(i*m-s*f)+u*(i*_-s*c)),t[15]=n*(c*h-_*a)-l*(i*h-s*a)+r*(i*_-s*c),t}function Ti(t){var e=t[0],n=t[1],i=t[2],s=t[3],o=t[4],l=t[5],c=t[6],_=t[7],p=t[8],r=t[9],a=t[10],h=t[11],d=t[12],u=t[13],f=t[14],m=t[15],w=e*l-n*o,b=e*c-i*o,y=e*_-s*o,A=n*c-i*l,T=n*_-s*l,j=i*_-s*c,O=p*u-r*d,C=p*f-a*d,k=p*m-h*d,F=r*f-a*u,L=r*m-h*u,B=a*m-h*f;return w*B-b*L+y*F+A*k-T*C+j*O}function yn(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=e[4],_=e[5],p=e[6],r=e[7],a=e[8],h=e[9],d=e[10],u=e[11],f=e[12],m=e[13],w=e[14],b=e[15],y=n[0],A=n[1],T=n[2],j=n[3];return t[0]=y*i+A*c+T*a+j*f,t[1]=y*s+A*_+T*h+j*m,t[2]=y*o+A*p+T*d+j*w,t[3]=y*l+A*r+T*u+j*b,y=n[4],A=n[5],T=n[6],j=n[7],t[4]=y*i+A*c+T*a+j*f,t[5]=y*s+A*_+T*h+j*m,t[6]=y*o+A*p+T*d+j*w,t[7]=y*l+A*r+T*u+j*b,y=n[8],A=n[9],T=n[10],j=n[11],t[8]=y*i+A*c+T*a+j*f,t[9]=y*s+A*_+T*h+j*m,t[10]=y*o+A*p+T*d+j*w,t[11]=y*l+A*r+T*u+j*b,y=n[12],A=n[13],T=n[14],j=n[15],t[12]=y*i+A*c+T*a+j*f,t[13]=y*s+A*_+T*h+j*m,t[14]=y*o+A*p+T*d+j*w,t[15]=y*l+A*r+T*u+j*b,t}function Ai(t,e,n){var i=n[0],s=n[1],o=n[2],l,c,_,p,r,a,h,d,u,f,m,w;return e===t?(t[12]=e[0]*i+e[4]*s+e[8]*o+e[12],t[13]=e[1]*i+e[5]*s+e[9]*o+e[13],t[14]=e[2]*i+e[6]*s+e[10]*o+e[14],t[15]=e[3]*i+e[7]*s+e[11]*o+e[15]):(l=e[0],c=e[1],_=e[2],p=e[3],r=e[4],a=e[5],h=e[6],d=e[7],u=e[8],f=e[9],m=e[10],w=e[11],t[0]=l,t[1]=c,t[2]=_,t[3]=p,t[4]=r,t[5]=a,t[6]=h,t[7]=d,t[8]=u,t[9]=f,t[10]=m,t[11]=w,t[12]=l*i+r*s+u*o+e[12],t[13]=c*i+a*s+f*o+e[13],t[14]=_*i+h*s+m*o+e[14],t[15]=p*i+d*s+w*o+e[15]),t}function ji(t,e,n){var i=n[0],s=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*s,t[5]=e[5]*s,t[6]=e[6]*s,t[7]=e[7]*s,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Si(t,e,n,i){var s=i[0],o=i[1],l=i[2],c=Math.hypot(s,o,l),_,p,r,a,h,d,u,f,m,w,b,y,A,T,j,O,C,k,F,L,B,R,I,q;return c<P?null:(c=1/c,s*=c,o*=c,l*=c,_=Math.sin(n),p=Math.cos(n),r=1-p,a=e[0],h=e[1],d=e[2],u=e[3],f=e[4],m=e[5],w=e[6],b=e[7],y=e[8],A=e[9],T=e[10],j=e[11],O=s*s*r+p,C=o*s*r+l*_,k=l*s*r-o*_,F=s*o*r-l*_,L=o*o*r+p,B=l*o*r+s*_,R=s*l*r+o*_,I=o*l*r-s*_,q=l*l*r+p,t[0]=a*O+f*C+y*k,t[1]=h*O+m*C+A*k,t[2]=d*O+w*C+T*k,t[3]=u*O+b*C+j*k,t[4]=a*F+f*L+y*B,t[5]=h*F+m*L+A*B,t[6]=d*F+w*L+T*B,t[7]=u*F+b*L+j*B,t[8]=a*R+f*I+y*q,t[9]=h*R+m*I+A*q,t[10]=d*R+w*I+T*q,t[11]=u*R+b*I+j*q,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Ci(t,e,n){var i=Math.sin(n),s=Math.cos(n),o=e[4],l=e[5],c=e[6],_=e[7],p=e[8],r=e[9],a=e[10],h=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*s+p*i,t[5]=l*s+r*i,t[6]=c*s+a*i,t[7]=_*s+h*i,t[8]=p*s-o*i,t[9]=r*s-l*i,t[10]=a*s-c*i,t[11]=h*s-_*i,t}function Pi(t,e,n){var i=Math.sin(n),s=Math.cos(n),o=e[0],l=e[1],c=e[2],_=e[3],p=e[8],r=e[9],a=e[10],h=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s-p*i,t[1]=l*s-r*i,t[2]=c*s-a*i,t[3]=_*s-h*i,t[8]=o*i+p*s,t[9]=l*i+r*s,t[10]=c*i+a*s,t[11]=_*i+h*s,t}function Ii(t,e,n){var i=Math.sin(n),s=Math.cos(n),o=e[0],l=e[1],c=e[2],_=e[3],p=e[4],r=e[5],a=e[6],h=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*s+p*i,t[1]=l*s+r*i,t[2]=c*s+a*i,t[3]=_*s+h*i,t[4]=p*s-o*i,t[5]=r*s-l*i,t[6]=a*s-c*i,t[7]=h*s-_*i,t}function Oi(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Ei(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ri(t,e,n){var i=n[0],s=n[1],o=n[2],l=Math.hypot(i,s,o),c,_,p;return l<P?null:(l=1/l,i*=l,s*=l,o*=l,c=Math.sin(e),_=Math.cos(e),p=1-_,t[0]=i*i*p+_,t[1]=s*i*p+o*c,t[2]=o*i*p-s*c,t[3]=0,t[4]=i*s*p-o*c,t[5]=s*s*p+_,t[6]=o*s*p+i*c,t[7]=0,t[8]=i*o*p+s*c,t[9]=s*o*p-i*c,t[10]=o*o*p+_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function ki(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Fi(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Bi(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Mn(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=i+i,_=s+s,p=o+o,r=i*c,a=i*_,h=i*p,d=s*_,u=s*p,f=o*p,m=l*c,w=l*_,b=l*p;return t[0]=1-(d+f),t[1]=a+b,t[2]=h-w,t[3]=0,t[4]=a-b,t[5]=1-(r+f),t[6]=u+m,t[7]=0,t[8]=h+w,t[9]=u-m,t[10]=1-(r+d),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Li(t,e){var n=new E(3),i=-e[0],s=-e[1],o=-e[2],l=e[3],c=e[4],_=e[5],p=e[6],r=e[7],a=i*i+s*s+o*o+l*l;return a>0?(n[0]=(c*l+r*i+_*o-p*s)*2/a,n[1]=(_*l+r*s+p*i-c*o)*2/a,n[2]=(p*l+r*o+c*s-_*i)*2/a):(n[0]=(c*l+r*i+_*o-p*s)*2,n[1]=(_*l+r*s+p*i-c*o)*2,n[2]=(p*l+r*o+c*s-_*i)*2),Mn(t,e,n),t}function Ot(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Tn(t,e){var n=e[0],i=e[1],s=e[2],o=e[4],l=e[5],c=e[6],_=e[8],p=e[9],r=e[10];return t[0]=Math.hypot(n,i,s),t[1]=Math.hypot(o,l,c),t[2]=Math.hypot(_,p,r),t}function Et(t,e){var n=new E(3);Tn(n,e);var i=1/n[0],s=1/n[1],o=1/n[2],l=e[0]*i,c=e[1]*s,_=e[2]*o,p=e[4]*i,r=e[5]*s,a=e[6]*o,h=e[8]*i,d=e[9]*s,u=e[10]*o,f=l+r+u,m=0;return f>0?(m=Math.sqrt(f+1)*2,t[3]=.25*m,t[0]=(a-d)/m,t[1]=(h-_)/m,t[2]=(c-p)/m):l>r&&l>u?(m=Math.sqrt(1+l-r-u)*2,t[3]=(a-d)/m,t[0]=.25*m,t[1]=(c+p)/m,t[2]=(h+_)/m):r>u?(m=Math.sqrt(1+r-l-u)*2,t[3]=(h-_)/m,t[0]=(c+p)/m,t[1]=.25*m,t[2]=(a+d)/m):(m=Math.sqrt(1+u-l-r)*2,t[3]=(c-p)/m,t[0]=(h+_)/m,t[1]=(a+d)/m,t[2]=.25*m),t}function Di(t,e,n,i){var s=e[0],o=e[1],l=e[2],c=e[3],_=s+s,p=o+o,r=l+l,a=s*_,h=s*p,d=s*r,u=o*p,f=o*r,m=l*r,w=c*_,b=c*p,y=c*r,A=i[0],T=i[1],j=i[2];return t[0]=(1-(u+m))*A,t[1]=(h+y)*A,t[2]=(d-b)*A,t[3]=0,t[4]=(h-y)*T,t[5]=(1-(a+m))*T,t[6]=(f+w)*T,t[7]=0,t[8]=(d+b)*j,t[9]=(f-w)*j,t[10]=(1-(a+u))*j,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function zi(t,e,n,i,s){var o=e[0],l=e[1],c=e[2],_=e[3],p=o+o,r=l+l,a=c+c,h=o*p,d=o*r,u=o*a,f=l*r,m=l*a,w=c*a,b=_*p,y=_*r,A=_*a,T=i[0],j=i[1],O=i[2],C=s[0],k=s[1],F=s[2],L=(1-(f+w))*T,B=(d+A)*T,R=(u-y)*T,I=(d-A)*j,q=(1-(h+w))*j,$e=(m+b)*j,Ze=(u+y)*O,ln=(m-b)*O,cn=(1-(h+f))*O;return t[0]=L,t[1]=B,t[2]=R,t[3]=0,t[4]=I,t[5]=q,t[6]=$e,t[7]=0,t[8]=Ze,t[9]=ln,t[10]=cn,t[11]=0,t[12]=n[0]+C-(L*C+I*k+Ze*F),t[13]=n[1]+k-(B*C+q*k+ln*F),t[14]=n[2]+F-(R*C+$e*k+cn*F),t[15]=1,t}function Ni(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=n+n,c=i+i,_=s+s,p=n*l,r=i*l,a=i*c,h=s*l,d=s*c,u=s*_,f=o*l,m=o*c,w=o*_;return t[0]=1-a-u,t[1]=r+w,t[2]=h-m,t[3]=0,t[4]=r-w,t[5]=1-p-u,t[6]=d+f,t[7]=0,t[8]=h+m,t[9]=d-f,t[10]=1-p-a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ui(t,e,n,i,s,o,l){var c=1/(n-e),_=1/(s-i),p=1/(o-l);return t[0]=o*2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o*2*_,t[6]=0,t[7]=0,t[8]=(n+e)*c,t[9]=(s+i)*_,t[10]=(l+o)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*o*2*p,t[15]=0,t}function An(t,e,n,i,s){var o=1/Math.tan(e/2),l;return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(l=1/(i-s),t[10]=(s+i)*l,t[14]=2*s*i*l):(t[10]=-1,t[14]=-2*i),t}var Vi=An;function Hi(t,e,n,i,s){var o=1/Math.tan(e/2),l;return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,s!=null&&s!==1/0?(l=1/(i-s),t[10]=s*l,t[14]=s*i*l):(t[10]=-1,t[14]=-i),t}function Wi(t,e,n,i){var s=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),c=Math.tan(e.rightDegrees*Math.PI/180),_=2/(l+c),p=2/(s+o);return t[0]=_,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-((l-c)*_*.5),t[9]=(s-o)*p*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t}function jn(t,e,n,i,s,o,l){var c=1/(e-n),_=1/(i-s),p=1/(o-l);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*c,t[13]=(s+i)*_,t[14]=(l+o)*p,t[15]=1,t}var Xi=jn;function qi(t,e,n,i,s,o,l){var c=1/(e-n),_=1/(i-s),p=1/(o-l);return t[0]=-2*c,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+n)*c,t[13]=(s+i)*_,t[14]=o*p,t[15]=1,t}function Yi(t,e,n,i){var s,o,l,c,_,p,r,a,h,d,u=e[0],f=e[1],m=e[2],w=i[0],b=i[1],y=i[2],A=n[0],T=n[1],j=n[2];return Math.abs(u-A)<P&&Math.abs(f-T)<P&&Math.abs(m-j)<P?xn(t):(r=u-A,a=f-T,h=m-j,d=1/Math.hypot(r,a,h),r*=d,a*=d,h*=d,s=b*h-y*a,o=y*r-w*h,l=w*a-b*r,d=Math.hypot(s,o,l),d?(d=1/d,s*=d,o*=d,l*=d):(s=0,o=0,l=0),c=a*l-h*o,_=h*s-r*l,p=r*o-a*s,d=Math.hypot(c,_,p),d?(d=1/d,c*=d,_*=d,p*=d):(c=0,_=0,p=0),t[0]=s,t[1]=c,t[2]=r,t[3]=0,t[4]=o,t[5]=_,t[6]=a,t[7]=0,t[8]=l,t[9]=p,t[10]=h,t[11]=0,t[12]=-(s*u+o*f+l*m),t[13]=-(c*u+_*f+p*m),t[14]=-(r*u+a*f+h*m),t[15]=1,t)}function Gi(t,e,n,i){var s=e[0],o=e[1],l=e[2],c=i[0],_=i[1],p=i[2],r=s-n[0],a=o-n[1],h=l-n[2],d=r*r+a*a+h*h;d>0&&(d=1/Math.sqrt(d),r*=d,a*=d,h*=d);var u=_*h-p*a,f=p*r-c*h,m=c*a-_*r;return d=u*u+f*f+m*m,d>0&&(d=1/Math.sqrt(d),u*=d,f*=d,m*=d),t[0]=u,t[1]=f,t[2]=m,t[3]=0,t[4]=a*m-h*f,t[5]=h*u-r*m,t[6]=r*f-a*u,t[7]=0,t[8]=r,t[9]=a,t[10]=h,t[11]=0,t[12]=s,t[13]=o,t[14]=l,t[15]=1,t}function Qi(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function $i(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Zi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function Sn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function Ji(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function Ki(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t}function er(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function tr(t,e){var n=t[0],i=t[1],s=t[2],o=t[3],l=t[4],c=t[5],_=t[6],p=t[7],r=t[8],a=t[9],h=t[10],d=t[11],u=t[12],f=t[13],m=t[14],w=t[15],b=e[0],y=e[1],A=e[2],T=e[3],j=e[4],O=e[5],C=e[6],k=e[7],F=e[8],L=e[9],B=e[10],R=e[11],I=e[12],q=e[13],$e=e[14],Ze=e[15];return Math.abs(n-b)<=P*Math.max(1,Math.abs(n),Math.abs(b))&&Math.abs(i-y)<=P*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(s-A)<=P*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(o-T)<=P*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(l-j)<=P*Math.max(1,Math.abs(l),Math.abs(j))&&Math.abs(c-O)<=P*Math.max(1,Math.abs(c),Math.abs(O))&&Math.abs(_-C)<=P*Math.max(1,Math.abs(_),Math.abs(C))&&Math.abs(p-k)<=P*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(r-F)<=P*Math.max(1,Math.abs(r),Math.abs(F))&&Math.abs(a-L)<=P*Math.max(1,Math.abs(a),Math.abs(L))&&Math.abs(h-B)<=P*Math.max(1,Math.abs(h),Math.abs(B))&&Math.abs(d-R)<=P*Math.max(1,Math.abs(d),Math.abs(R))&&Math.abs(u-I)<=P*Math.max(1,Math.abs(u),Math.abs(I))&&Math.abs(f-q)<=P*Math.max(1,Math.abs(f),Math.abs(q))&&Math.abs(m-$e)<=P*Math.max(1,Math.abs(m),Math.abs($e))&&Math.abs(w-Ze)<=P*Math.max(1,Math.abs(w),Math.abs(Ze))}var nr=yn,ir=Sn;var S={};Je(S,{add:()=>bs,calculateW:()=>_s,clone:()=>gs,conjugate:()=>ms,copy:()=>xt,create:()=>tt,dot:()=>yt,equals:()=>js,exactEquals:()=>As,exp:()=>Hn,fromEuler:()=>us,fromMat3:()=>Xn,fromValues:()=>vs,getAngle:()=>cs,getAxisAngle:()=>ls,identity:()=>as,invert:()=>ds,len:()=>Ms,length:()=>Mt,lerp:()=>ys,ln:()=>Wn,mul:()=>xs,multiply:()=>Vn,normalize:()=>Qt,pow:()=>hs,random:()=>ps,rotateX:()=>qt,rotateY:()=>Yt,rotateZ:()=>Gt,rotationTo:()=>Ss,scale:()=>qn,set:()=>ws,setAxes:()=>Ps,setAxisAngle:()=>Un,slerp:()=>bt,sqlerp:()=>Cs,sqrLen:()=>Ts,squaredLength:()=>Tt,str:()=>fs});var v={};Je(v,{add:()=>ar,angle:()=>Sr,bezier:()=>wr,ceil:()=>lr,clone:()=>rr,copy:()=>sr,create:()=>ut,cross:()=>et,dist:()=>Fr,distance:()=>En,div:()=>kr,divide:()=>On,dot:()=>gt,equals:()=>Or,exactEquals:()=>Ir,floor:()=>cr,forEach:()=>Dr,fromValues:()=>ft,hermite:()=>vr,inverse:()=>fr,len:()=>kt,length:()=>Cn,lerp:()=>gr,max:()=>hr,min:()=>_r,mul:()=>Rr,multiply:()=>In,negate:()=>ur,normalize:()=>Rt,random:()=>br,rotateX:()=>Tr,rotateY:()=>Ar,rotateZ:()=>jr,round:()=>pr,scale:()=>dr,scaleAndAdd:()=>mr,set:()=>or,sqrDist:()=>Br,sqrLen:()=>Lr,squaredDistance:()=>Rn,squaredLength:()=>kn,str:()=>Pr,sub:()=>Er,subtract:()=>Pn,transformMat3:()=>yr,transformMat4:()=>xr,transformQuat:()=>Mr,zero:()=>Cr});function ut(){var t=new E(3);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function rr(t){var e=new E(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Cn(t){var e=t[0],n=t[1],i=t[2];return Math.hypot(e,n,i)}function ft(t,e,n){var i=new E(3);return i[0]=t,i[1]=e,i[2]=n,i}function sr(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function or(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function ar(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Pn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function In(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function On(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function lr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function cr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function _r(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function hr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function pr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function dr(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function mr(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function En(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return Math.hypot(n,i,s)}function Rn(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2];return n*n+i*i+s*s}function kn(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function ur(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function fr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function Rt(t,e){var n=e[0],i=e[1],s=e[2],o=n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function gt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function et(t,e,n){var i=e[0],s=e[1],o=e[2],l=n[0],c=n[1],_=n[2];return t[0]=s*_-o*c,t[1]=o*l-i*_,t[2]=i*c-s*l,t}function gr(t,e,n,i){var s=e[0],o=e[1],l=e[2];return t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=l+i*(n[2]-l),t}function vr(t,e,n,i,s,o){var l=o*o,c=l*(2*o-3)+1,_=l*(o-2)+o,p=l*(o-1),r=l*(3-2*o);return t[0]=e[0]*c+n[0]*_+i[0]*p+s[0]*r,t[1]=e[1]*c+n[1]*_+i[1]*p+s[1]*r,t[2]=e[2]*c+n[2]*_+i[2]*p+s[2]*r,t}function wr(t,e,n,i,s,o){var l=1-o,c=l*l,_=o*o,p=c*l,r=3*o*c,a=3*_*l,h=_*o;return t[0]=e[0]*p+n[0]*r+i[0]*a+s[0]*h,t[1]=e[1]*p+n[1]*r+i[1]*a+s[1]*h,t[2]=e[2]*p+n[2]*r+i[2]*a+s[2]*h,t}function br(t,e){e=e||1;var n=W()*2*Math.PI,i=W()*2-1,s=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*s,t[1]=Math.sin(n)*s,t[2]=i*e,t}function xr(t,e,n){var i=e[0],s=e[1],o=e[2],l=n[3]*i+n[7]*s+n[11]*o+n[15];return l=l||1,t[0]=(n[0]*i+n[4]*s+n[8]*o+n[12])/l,t[1]=(n[1]*i+n[5]*s+n[9]*o+n[13])/l,t[2]=(n[2]*i+n[6]*s+n[10]*o+n[14])/l,t}function yr(t,e,n){var i=e[0],s=e[1],o=e[2];return t[0]=i*n[0]+s*n[3]+o*n[6],t[1]=i*n[1]+s*n[4]+o*n[7],t[2]=i*n[2]+s*n[5]+o*n[8],t}function Mr(t,e,n){var i=n[0],s=n[1],o=n[2],l=n[3],c=e[0],_=e[1],p=e[2],r=s*p-o*_,a=o*c-i*p,h=i*_-s*c,d=s*h-o*a,u=o*r-i*h,f=i*a-s*r,m=l*2;return r*=m,a*=m,h*=m,d*=2,u*=2,f*=2,t[0]=c+r+d,t[1]=_+a+u,t[2]=p+h+f,t}function Tr(t,e,n,i){var s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0],o[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),o[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Ar(t,e,n,i){var s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),o[1]=s[1],o[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function jr(t,e,n,i){var s=[],o=[];return s[0]=e[0]-n[0],s[1]=e[1]-n[1],s[2]=e[2]-n[2],o[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),o[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),o[2]=s[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Sr(t,e){var n=t[0],i=t[1],s=t[2],o=e[0],l=e[1],c=e[2],_=Math.sqrt(n*n+i*i+s*s),p=Math.sqrt(o*o+l*l+c*c),r=_*p,a=r&&gt(t,e)/r;return Math.acos(Math.min(Math.max(a,-1),1))}function Cr(t){return t[0]=0,t[1]=0,t[2]=0,t}function Pr(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function Ir(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Or(t,e){var n=t[0],i=t[1],s=t[2],o=e[0],l=e[1],c=e[2];return Math.abs(n-o)<=P*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=P*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(s-c)<=P*Math.max(1,Math.abs(s),Math.abs(c))}var Er=Pn,Rr=In,kr=On,Fr=En,Br=Rn,kt=Cn,Lr=kn,Dr=function(){var t=ut();return function(e,n,i,s,o,l){var c,_;for(n||(n=3),i||(i=0),s?_=Math.min(s*n+i,e.length):_=e.length,c=i;c<_;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],o(t,t,l),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2];return e}}();var Z={};Je(Z,{add:()=>zt,ceil:()=>zr,clone:()=>Ft,copy:()=>Lt,create:()=>Fn,cross:()=>Yr,dist:()=>ns,distance:()=>zn,div:()=>ts,divide:()=>Dn,dot:()=>Vt,equals:()=>Xt,exactEquals:()=>Wt,floor:()=>Nr,forEach:()=>os,fromValues:()=>Bt,inverse:()=>qr,len:()=>rs,length:()=>vt,lerp:()=>Ht,max:()=>Vr,min:()=>Ur,mul:()=>es,multiply:()=>Ln,negate:()=>Xr,normalize:()=>Ut,random:()=>Gr,round:()=>Hr,scale:()=>Nt,scaleAndAdd:()=>Wr,set:()=>Dt,sqrDist:()=>is,sqrLen:()=>ss,squaredDistance:()=>Nn,squaredLength:()=>wt,str:()=>Jr,sub:()=>Kr,subtract:()=>Bn,transformMat4:()=>Qr,transformQuat:()=>$r,zero:()=>Zr});function Fn(){var t=new E(4);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Ft(t){var e=new E(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Bt(t,e,n,i){var s=new E(4);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s}function Lt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function Dt(t,e,n,i,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t}function zt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Bn(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Ln(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Dn(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function zr(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t}function Nr(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t}function Ur(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t}function Vr(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t}function Hr(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t}function Nt(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Wr(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t}function zn(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return Math.hypot(n,i,s,o)}function Nn(t,e){var n=e[0]-t[0],i=e[1]-t[1],s=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+s*s+o*o}function vt(t){var e=t[0],n=t[1],i=t[2],s=t[3];return Math.hypot(e,n,i,s)}function wt(t){var e=t[0],n=t[1],i=t[2],s=t[3];return e*e+n*n+i*i+s*s}function Xr(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t}function qr(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t}function Ut(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=n*n+i*i+s*s+o*o;return l>0&&(l=1/Math.sqrt(l)),t[0]=n*l,t[1]=i*l,t[2]=s*l,t[3]=o*l,t}function Vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function Yr(t,e,n,i){var s=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],l=n[0]*i[3]-n[3]*i[0],c=n[1]*i[2]-n[2]*i[1],_=n[1]*i[3]-n[3]*i[1],p=n[2]*i[3]-n[3]*i[2],r=e[0],a=e[1],h=e[2],d=e[3];return t[0]=a*p-h*_+d*c,t[1]=-(r*p)+h*l-d*o,t[2]=r*_-a*l+d*s,t[3]=-(r*c)+a*o-h*s,t}function Ht(t,e,n,i){var s=e[0],o=e[1],l=e[2],c=e[3];return t[0]=s+i*(n[0]-s),t[1]=o+i*(n[1]-o),t[2]=l+i*(n[2]-l),t[3]=c+i*(n[3]-c),t}function Gr(t,e){e=e||1;var n,i,s,o,l,c;do n=W()*2-1,i=W()*2-1,l=n*n+i*i;while(l>=1);do s=W()*2-1,o=W()*2-1,c=s*s+o*o;while(c>=1);var _=Math.sqrt((1-l)/c);return t[0]=e*n,t[1]=e*i,t[2]=e*s*_,t[3]=e*o*_,t}function Qr(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3];return t[0]=n[0]*i+n[4]*s+n[8]*o+n[12]*l,t[1]=n[1]*i+n[5]*s+n[9]*o+n[13]*l,t[2]=n[2]*i+n[6]*s+n[10]*o+n[14]*l,t[3]=n[3]*i+n[7]*s+n[11]*o+n[15]*l,t}function $r(t,e,n){var i=e[0],s=e[1],o=e[2],l=n[0],c=n[1],_=n[2],p=n[3],r=p*i+c*o-_*s,a=p*s+_*i-l*o,h=p*o+l*s-c*i,d=-l*i-c*s-_*o;return t[0]=r*p+d*-l+a*-_-h*-c,t[1]=a*p+d*-c+h*-l-r*-_,t[2]=h*p+d*-_+r*-c-a*-l,t[3]=e[3],t}function Zr(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function Jr(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}function Wt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function Xt(t,e){var n=t[0],i=t[1],s=t[2],o=t[3],l=e[0],c=e[1],_=e[2],p=e[3];return Math.abs(n-l)<=P*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-c)<=P*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(s-_)<=P*Math.max(1,Math.abs(s),Math.abs(_))&&Math.abs(o-p)<=P*Math.max(1,Math.abs(o),Math.abs(p))}var Kr=Bn,es=Ln,ts=Dn,ns=zn,is=Nn,rs=vt,ss=wt,os=function(){var t=Fn();return function(e,n,i,s,o,l){var c,_;for(n||(n=4),i||(i=0),s?_=Math.min(s*n+i,e.length):_=e.length,c=i;c<_;c+=n)t[0]=e[c],t[1]=e[c+1],t[2]=e[c+2],t[3]=e[c+3],o(t,t,l),e[c]=t[0],e[c+1]=t[1],e[c+2]=t[2],e[c+3]=t[3];return e}}();function tt(){var t=new E(4);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function as(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function Un(t,e,n){n=n*.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function ls(t,e){var n=Math.acos(e[3])*2,i=Math.sin(n/2);return i>P?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n}function cs(t,e){var n=yt(t,e);return Math.acos(2*n*n-1)}function Vn(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=n[0],_=n[1],p=n[2],r=n[3];return t[0]=i*r+l*c+s*p-o*_,t[1]=s*r+l*_+o*c-i*p,t[2]=o*r+l*p+i*_-s*c,t[3]=l*r-i*c-s*_-o*p,t}function qt(t,e,n){n*=.5;var i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(n),_=Math.cos(n);return t[0]=i*_+l*c,t[1]=s*_+o*c,t[2]=o*_-s*c,t[3]=l*_-i*c,t}function Yt(t,e,n){n*=.5;var i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(n),_=Math.cos(n);return t[0]=i*_-o*c,t[1]=s*_+l*c,t[2]=o*_+i*c,t[3]=l*_-s*c,t}function Gt(t,e,n){n*=.5;var i=e[0],s=e[1],o=e[2],l=e[3],c=Math.sin(n),_=Math.cos(n);return t[0]=i*_+s*c,t[1]=s*_-i*c,t[2]=o*_+l*c,t[3]=l*_-o*c,t}function _s(t,e){var n=e[0],i=e[1],s=e[2];return t[0]=n,t[1]=i,t[2]=s,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-s*s)),t}function Hn(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=Math.sqrt(n*n+i*i+s*s),c=Math.exp(o),_=l>0?c*Math.sin(l)/l:0;return t[0]=n*_,t[1]=i*_,t[2]=s*_,t[3]=c*Math.cos(l),t}function Wn(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=Math.sqrt(n*n+i*i+s*s),c=l>0?Math.atan2(l,o)/l:0;return t[0]=n*c,t[1]=i*c,t[2]=s*c,t[3]=.5*Math.log(n*n+i*i+s*s+o*o),t}function hs(t,e,n){return Wn(t,e),qn(t,t,n),Hn(t,t),t}function bt(t,e,n,i){var s=e[0],o=e[1],l=e[2],c=e[3],_=n[0],p=n[1],r=n[2],a=n[3],h,d,u,f,m;return d=s*_+o*p+l*r+c*a,d<0&&(d=-d,_=-_,p=-p,r=-r,a=-a),1-d>P?(h=Math.acos(d),u=Math.sin(h),f=Math.sin((1-i)*h)/u,m=Math.sin(i*h)/u):(f=1-i,m=i),t[0]=f*s+m*_,t[1]=f*o+m*p,t[2]=f*l+m*r,t[3]=f*c+m*a,t}function ps(t){var e=W(),n=W(),i=W(),s=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=s*Math.sin(2*Math.PI*n),t[1]=s*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t}function ds(t,e){var n=e[0],i=e[1],s=e[2],o=e[3],l=n*n+i*i+s*s+o*o,c=l?1/l:0;return t[0]=-n*c,t[1]=-i*c,t[2]=-s*c,t[3]=o*c,t}function ms(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t}function Xn(t,e){var n=e[0]+e[4]+e[8],i;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,i=.5/i,t[0]=(e[5]-e[7])*i,t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var s=0;e[4]>e[0]&&(s=1),e[8]>e[s*3+s]&&(s=2);var o=(s+1)%3,l=(s+2)%3;i=Math.sqrt(e[s*3+s]-e[o*3+o]-e[l*3+l]+1),t[s]=.5*i,i=.5/i,t[3]=(e[o*3+l]-e[l*3+o])*i,t[o]=(e[o*3+s]+e[s*3+o])*i,t[l]=(e[l*3+s]+e[s*3+l])*i}return t}function us(t,e,n,i){var s=.5*Math.PI/180;e*=s,n*=s,i*=s;var o=Math.sin(e),l=Math.cos(e),c=Math.sin(n),_=Math.cos(n),p=Math.sin(i),r=Math.cos(i);return t[0]=o*_*r-l*c*p,t[1]=l*c*r+o*_*p,t[2]=l*_*p-o*c*r,t[3]=l*_*r+o*c*p,t}function fs(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}var gs=Ft,vs=Bt,xt=Lt,ws=Dt,bs=zt,xs=Vn,qn=Nt,yt=Vt,ys=Ht,Mt=vt,Ms=Mt,Tt=wt,Ts=Tt,Qt=Ut,As=Wt,js=Xt,Ss=function(){var t=ut(),e=ft(1,0,0),n=ft(0,1,0);return function(i,s,o){var l=gt(s,o);return l<-.999999?(et(t,e,s),kt(t)<1e-6&&et(t,n,s),Rt(t,t),Un(i,t,Math.PI),i):l>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(et(t,s,o),i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=1+l,Qt(i,i))}}(),Cs=function(){var t=tt(),e=tt();return function(n,i,s,o,l,c){return bt(t,i,l,c),bt(e,s,o,c),bt(n,t,e,2*c*(1-c)),n}}(),Ps=function(){var t=bn();return function(e,n,i,s){return t[0]=i[0],t[3]=i[1],t[6]=i[2],t[1]=s[0],t[4]=s[1],t[7]=s[2],t[2]=-n[0],t[5]=-n[1],t[8]=-n[2],Qt(e,Xn(e,t))}}();var U={};Je(U,{add:()=>Zs,clone:()=>Os,conjugate:()=>no,copy:()=>Gn,create:()=>Is,dot:()=>$n,equals:()=>lo,exactEquals:()=>ao,fromMat4:()=>Bs,fromRotation:()=>Fs,fromRotationTranslation:()=>Yn,fromRotationTranslationValues:()=>Rs,fromTranslation:()=>ks,fromValues:()=>Es,getDual:()=>Ns,getReal:()=>zs,getTranslation:()=>Hs,identity:()=>Ls,invert:()=>to,len:()=>io,length:()=>Zn,lerp:()=>eo,mul:()=>Js,multiply:()=>Qn,normalize:()=>so,rotateAroundAxis:()=>$s,rotateByQuatAppend:()=>Gs,rotateByQuatPrepend:()=>Qs,rotateX:()=>Xs,rotateY:()=>qs,rotateZ:()=>Ys,scale:()=>Ks,set:()=>Ds,setDual:()=>Vs,setReal:()=>Us,sqrLen:()=>ro,squaredLength:()=>At,str:()=>oo,translate:()=>Ws});function Is(){var t=new E(8);return E!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t}function Os(t){var e=new E(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e}function Es(t,e,n,i,s,o,l,c){var _=new E(8);return _[0]=t,_[1]=e,_[2]=n,_[3]=i,_[4]=s,_[5]=o,_[6]=l,_[7]=c,_}function Rs(t,e,n,i,s,o,l){var c=new E(8);c[0]=t,c[1]=e,c[2]=n,c[3]=i;var _=s*.5,p=o*.5,r=l*.5;return c[4]=_*i+p*n-r*e,c[5]=p*i+r*t-_*n,c[6]=r*i+_*e-p*t,c[7]=-_*t-p*e-r*n,c}function Yn(t,e,n){var i=n[0]*.5,s=n[1]*.5,o=n[2]*.5,l=e[0],c=e[1],_=e[2],p=e[3];return t[0]=l,t[1]=c,t[2]=_,t[3]=p,t[4]=i*p+s*_-o*c,t[5]=s*p+o*l-i*_,t[6]=o*p+i*c-s*l,t[7]=-i*l-s*c-o*_,t}function ks(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0]*.5,t[5]=e[1]*.5,t[6]=e[2]*.5,t[7]=0,t}function Fs(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Bs(t,e){var n=tt();Et(n,e);var i=new E(3);return Ot(i,e),Yn(t,n,i),t}function Gn(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function Ls(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t}function Ds(t,e,n,i,s,o,l,c,_){return t[0]=e,t[1]=n,t[2]=i,t[3]=s,t[4]=o,t[5]=l,t[6]=c,t[7]=_,t}var zs=xt;function Ns(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t}var Us=xt;function Vs(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t}function Hs(t,e){var n=e[4],i=e[5],s=e[6],o=e[7],l=-e[0],c=-e[1],_=-e[2],p=e[3];return t[0]=(n*p+o*l+i*_-s*c)*2,t[1]=(i*p+o*c+s*l-n*_)*2,t[2]=(s*p+o*_+n*c-i*l)*2,t}function Ws(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=n[0]*.5,_=n[1]*.5,p=n[2]*.5,r=e[4],a=e[5],h=e[6],d=e[7];return t[0]=i,t[1]=s,t[2]=o,t[3]=l,t[4]=l*c+s*p-o*_+r,t[5]=l*_+o*c-i*p+a,t[6]=l*p+i*_-s*c+h,t[7]=-i*c-s*_-o*p+d,t}function Xs(t,e,n){var i=-e[0],s=-e[1],o=-e[2],l=e[3],c=e[4],_=e[5],p=e[6],r=e[7],a=c*l+r*i+_*o-p*s,h=_*l+r*s+p*i-c*o,d=p*l+r*o+c*s-_*i,u=r*l-c*i-_*s-p*o;return qt(t,e,n),i=t[0],s=t[1],o=t[2],l=t[3],t[4]=a*l+u*i+h*o-d*s,t[5]=h*l+u*s+d*i-a*o,t[6]=d*l+u*o+a*s-h*i,t[7]=u*l-a*i-h*s-d*o,t}function qs(t,e,n){var i=-e[0],s=-e[1],o=-e[2],l=e[3],c=e[4],_=e[5],p=e[6],r=e[7],a=c*l+r*i+_*o-p*s,h=_*l+r*s+p*i-c*o,d=p*l+r*o+c*s-_*i,u=r*l-c*i-_*s-p*o;return Yt(t,e,n),i=t[0],s=t[1],o=t[2],l=t[3],t[4]=a*l+u*i+h*o-d*s,t[5]=h*l+u*s+d*i-a*o,t[6]=d*l+u*o+a*s-h*i,t[7]=u*l-a*i-h*s-d*o,t}function Ys(t,e,n){var i=-e[0],s=-e[1],o=-e[2],l=e[3],c=e[4],_=e[5],p=e[6],r=e[7],a=c*l+r*i+_*o-p*s,h=_*l+r*s+p*i-c*o,d=p*l+r*o+c*s-_*i,u=r*l-c*i-_*s-p*o;return Gt(t,e,n),i=t[0],s=t[1],o=t[2],l=t[3],t[4]=a*l+u*i+h*o-d*s,t[5]=h*l+u*s+d*i-a*o,t[6]=d*l+u*o+a*s-h*i,t[7]=u*l-a*i-h*s-d*o,t}function Gs(t,e,n){var i=n[0],s=n[1],o=n[2],l=n[3],c=e[0],_=e[1],p=e[2],r=e[3];return t[0]=c*l+r*i+_*o-p*s,t[1]=_*l+r*s+p*i-c*o,t[2]=p*l+r*o+c*s-_*i,t[3]=r*l-c*i-_*s-p*o,c=e[4],_=e[5],p=e[6],r=e[7],t[4]=c*l+r*i+_*o-p*s,t[5]=_*l+r*s+p*i-c*o,t[6]=p*l+r*o+c*s-_*i,t[7]=r*l-c*i-_*s-p*o,t}function Qs(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=n[0],_=n[1],p=n[2],r=n[3];return t[0]=i*r+l*c+s*p-o*_,t[1]=s*r+l*_+o*c-i*p,t[2]=o*r+l*p+i*_-s*c,t[3]=l*r-i*c-s*_-o*p,c=n[4],_=n[5],p=n[6],r=n[7],t[4]=i*r+l*c+s*p-o*_,t[5]=s*r+l*_+o*c-i*p,t[6]=o*r+l*p+i*_-s*c,t[7]=l*r-i*c-s*_-o*p,t}function $s(t,e,n,i){if(Math.abs(i)<P)return Gn(t,e);var s=Math.hypot(n[0],n[1],n[2]);i=i*.5;var o=Math.sin(i),l=o*n[0]/s,c=o*n[1]/s,_=o*n[2]/s,p=Math.cos(i),r=e[0],a=e[1],h=e[2],d=e[3];t[0]=r*p+d*l+a*_-h*c,t[1]=a*p+d*c+h*l-r*_,t[2]=h*p+d*_+r*c-a*l,t[3]=d*p-r*l-a*c-h*_;var u=e[4],f=e[5],m=e[6],w=e[7];return t[4]=u*p+w*l+f*_-m*c,t[5]=f*p+w*c+m*l-u*_,t[6]=m*p+w*_+u*c-f*l,t[7]=w*p-u*l-f*c-m*_,t}function Zs(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t}function Qn(t,e,n){var i=e[0],s=e[1],o=e[2],l=e[3],c=n[4],_=n[5],p=n[6],r=n[7],a=e[4],h=e[5],d=e[6],u=e[7],f=n[0],m=n[1],w=n[2],b=n[3];return t[0]=i*b+l*f+s*w-o*m,t[1]=s*b+l*m+o*f-i*w,t[2]=o*b+l*w+i*m-s*f,t[3]=l*b-i*f-s*m-o*w,t[4]=i*r+l*c+s*p-o*_+a*b+u*f+h*w-d*m,t[5]=s*r+l*_+o*c-i*p+h*b+u*m+d*f-a*w,t[6]=o*r+l*p+i*_-s*c+d*b+u*w+a*m-h*f,t[7]=l*r-i*c-s*_-o*p+u*b-a*f-h*m-d*w,t}var Js=Qn;function Ks(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t}var $n=yt;function eo(t,e,n,i){var s=1-i;return $n(e,n)<0&&(i=-i),t[0]=e[0]*s+n[0]*i,t[1]=e[1]*s+n[1]*i,t[2]=e[2]*s+n[2]*i,t[3]=e[3]*s+n[3]*i,t[4]=e[4]*s+n[4]*i,t[5]=e[5]*s+n[5]*i,t[6]=e[6]*s+n[6]*i,t[7]=e[7]*s+n[7]*i,t}function to(t,e){var n=At(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t}function no(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t}var Zn=Mt,io=Zn,At=Tt,ro=At;function so(t,e){var n=At(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,s=e[1]/n,o=e[2]/n,l=e[3]/n,c=e[4],_=e[5],p=e[6],r=e[7],a=i*c+s*_+o*p+l*r;t[0]=i,t[1]=s,t[2]=o,t[3]=l,t[4]=(c-i*a)/n,t[5]=(_-s*a)/n,t[6]=(p-o*a)/n,t[7]=(r-l*a)/n}return t}function oo(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"}function ao(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]}function lo(t,e){var n=t[0],i=t[1],s=t[2],o=t[3],l=t[4],c=t[5],_=t[6],p=t[7],r=e[0],a=e[1],h=e[2],d=e[3],u=e[4],f=e[5],m=e[6],w=e[7];return Math.abs(n-r)<=P*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-a)<=P*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-h)<=P*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(o-d)<=P*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(l-u)<=P*Math.max(1,Math.abs(l),Math.abs(u))&&Math.abs(c-f)<=P*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(_-m)<=P*Math.max(1,Math.abs(_),Math.abs(m))&&Math.abs(p-w)<=P*Math.max(1,Math.abs(p),Math.abs(w))}var we=class extends x{init(){this.session=null,this.collisionMask=1<<this.collisionGroup,this.maxDistance=100;let e=this.onDestroy.bind(this);this.engine.onSceneLoaded.push(e),this.onDestroyCallbacks=[()=>{let n=this.engine.onSceneLoaded.indexOf(e);n>=0&&this.engine.onSceneLoaded.splice(n,1)}]}start(){if(this.handedness==0){let n=this.object.getComponent("input");n?(this.handedness=n.handedness,this.input=n):console.warn("cursor component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];if(this.globalTarget=this.object.addComponent("cursor-target"),this.origin=new Float32Array(3),this.cursorObjScale=new Float32Array(3),this.direction=[0,0,0],this.tempQuat=new Float32Array(4),this.viewComponent=this.object.getComponent("view"),this.viewComponent!=null){let n=this.onClick.bind(this);this.engine.canvas.addEventListener("click",n);let i=this.onPointerMove.bind(this);this.engine.canvas.addEventListener("pointermove",i);let s=this.onPointerDown.bind(this);this.engine.canvas.addEventListener("pointerdown",s);let o=this.onPointerUp.bind(this);this.engine.canvas.addEventListener("pointerup",o),this.projectionMatrix=new Float32Array(16),ie.invert(this.projectionMatrix,this.viewComponent.projectionMatrix);let l=this.onViewportResize.bind(this);window.addEventListener("resize",l),this.onDestroyCallbacks.push(()=>{this.engine.canvas.removeEventListener("click",n),this.engine.canvas.removeEventListener("pointermove",i),this.engine.canvas.removeEventListener("pointerdown",s),this.engine.canvas.removeEventListener("pointerup",o),window.removeEventListener("resize",l)})}this.isHovering=!1,this.visible=!0,this.isDown=!1,this.lastIsDown=!1,this.cursorPos=new Float32Array(3),this.hoveringObject=null;let e=this.setupVREvents.bind(this);this.engine.onXRSessionStart.push(e),this.onDestroyCallbacks.push(()=>{let n=this.engine.onXRSessionStart.indexOf(e);n>=0&&this.engine.onXRSessionStart.splice(n,1)}),this.cursorRayObject&&(this.cursorRayScale=new Float32Array(3),this.cursorRayScale.set(this.cursorRayObject.scalingLocal),this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction),this._setCursorRayTransform([this.origin[0]+this.direction[0],this.origin[1]+this.direction[1],this.origin[2]+this.direction[2]]))}onViewportResize(){this.viewComponent&&ie.invert(this.projectionMatrix,this.viewComponent.projectionMatrix)}_setCursorRayTransform(e){if(!this.cursorRayObject)return;let n=v.dist(this.origin,e);this.cursorRayObject.setTranslationLocal([0,0,-n/2]),this.cursorRayScalingAxis!=4&&(this.cursorRayObject.resetScaling(),this.cursorRayScale[this.cursorRayScalingAxis]=n/2,this.cursorRayObject.scale(this.cursorRayScale))}_setCursorVisibility(e){this.visible!=e&&(this.visible=e,this.cursorObject&&(e?(this.cursorObject.resetScaling(),this.cursorObject.scale(this.cursorObjScale)):(this.cursorObjScale.set(this.cursorObject.scalingLocal),this.cursorObject.scale([0,0,0]))))}update(){this.doUpdate(!1)}doUpdate(e){if(this.session){if(this.arTouchDown&&this.input&&this.engine.xrSession.inputSources[0].handedness==="none"&&this.engine.xrSession.inputSources[0].gamepad){let i=this.engine.xrSession.inputSources[0].gamepad.axes;this.direction=[i[0],-i[1],-1],this.updateDirection()}else this.object.getTranslationWorld(this.origin),this.object.getForward(this.direction);let n=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(this.origin,this.direction,this.collisionMask):this.engine.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);n.hitCount>0?this.cursorPos.set(n.locations[0]):this.cursorPos.fill(0),this.hoverBehaviour(n,e)}this.cursorObject&&(this.hoveringObject&&(this.cursorPos[0]!=0||this.cursorPos[1]!=0||this.cursorPos[2]!=0)?(this._setCursorVisibility(!0),this.cursorObject.setTranslationWorld(this.cursorPos),this._setCursorRayTransform(this.cursorPos)):this._setCursorVisibility(!1))}hoverBehaviour(e,n){if(e.hitCount>0){if(!this.hoveringObject||!this.hoveringObject.equals(e.objects[0])){if(this.hoveringObject){let o=this.hoveringObject.getComponent("cursor-target");o&&o.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.hoveringObject=e.objects[0],this.styleCursor&&(this.engine.canvas.style.cursor="pointer");let s=this.hoveringObject.getComponent("cursor-target");s&&(this.hoveringObjectTarget=s,s.onHover(this.hoveringObject,this)),this.globalTarget.onHover(this.hoveringObject,this)}this.hoveringObjectTarget&&this.hoveringObjectTarget.onMove(this.hoveringObject,this);let i=this.hoveringObject.getComponent("cursor-target");this.isDown!==this.lastIsDown&&(this.isDown?(i&&i.onDown(this.hoveringObject,this),this.globalTarget.onDown(this.hoveringObject,this)):(i&&i.onUp(this.hoveringObject,this),this.globalTarget.onUp(this.hoveringObject,this))),n&&(i&&i.onClick(this.hoveringObject,this),this.globalTarget.onClick(this.hoveringObject,this))}else if(this.hoveringObject&&e.hitCount==0){let i=this.hoveringObject.getComponent("cursor-target");i&&i.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this),this.hoveringObject=null,this.hoveringObjectTarget=null,this.styleCursor&&(this.engine.canvas.style.cursor="default")}this.lastIsDown=this.isDown}setupVREvents(e){this.session=e;let n=function(l){this.session=null}.bind(this);e.addEventListener("end",n);let i=this.onSelect.bind(this);e.addEventListener("select",i);let s=this.onSelectStart.bind(this);e.addEventListener("selectstart",s);let o=this.onSelectEnd.bind(this);e.addEventListener("selectend",o),this.onDestroyCallbacks.push(()=>{this.session&&(e.removeEventListener("end",n),e.removeEventListener("select",i),e.removeEventListener("selectstart",s),e.removeEventListener("selectend",o))}),this.onViewportResize()}onSelect(e){e.inputSource.handedness==this.handedness&&this.doUpdate(!0)}onSelectStart(e){this.arTouchDown=!0,e.inputSource.handedness==this.handedness&&(this.isDown=!0)}onSelectEnd(e){this.arTouchDown=!1,e.inputSource.handedness==this.handedness&&(this.isDown=!1)}onPointerMove(e){if(!e.isPrimary)return;let n=e.target.getBoundingClientRect(),i=this.updateMousePos(e.clientX,e.clientY,n.width,n.height);this.hoverBehaviour(i,!1)}onClick(e){let n=e.target.getBoundingClientRect(),i=this.updateMousePos(e.clientX,e.clientY,n.width,n.height);this.hoverBehaviour(i,!0)}onPointerDown(e){if(!e.isPrimary||e.button!==0)return;let n=e.target.getBoundingClientRect(),i=this.updateMousePos(e.clientX,e.clientY,n.width,n.height);this.isDown=!0,this.hoverBehaviour(i,!1)}onPointerUp(e){if(!e.isPrimary||e.button!==0)return;let n=e.target.getBoundingClientRect(),i=this.updateMousePos(e.clientX,e.clientY,n.width,n.height);this.isDown=!1,this.hoverBehaviour(i,!1)}updateMousePos(e,n,i,s){let o=e/i,l=n/s;return this.direction=[o*2-1,-l*2+1,-1],this.updateDirection()}updateDirection(){this.object.getTranslationWorld(this.origin),v.transformMat4(this.direction,this.direction,this.projectionMatrix),v.normalize(this.direction,this.direction),v.transformQuat(this.direction,this.direction,this.object.transformWorld);let e=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(this.origin,this.direction,this.collisionMask):this.engine.physics.rayCast(this.origin,this.direction,this.collisionMask,this.maxDistance);return e.hitCount>0?this.cursorPos.set(e.locations[0]):this.cursorPos.fill(0),e}onDeactivate(){if(this._setCursorVisibility(!1),this.hoveringObject){let e=this.hoveringObject.getComponent("cursor-target");e&&e.onUnhover(this.hoveringObject,this),this.globalTarget.onUnhover(this.hoveringObject,this)}this.cursorRayObject&&this.cursorRayObject.scale([0,0,0])}onActivate(){this._setCursorVisibility(!0)}onDestroy(){for(let e of this.onDestroyCallbacks)e()}};M(we,"TypeName","cursor"),M(we,"Properties",{collisionGroup:{type:g.Int,default:1},cursorRayObject:{type:g.Object},cursorRayScalingAxis:{type:g.Enum,values:["x","y","z","none"],default:"z"},cursorObject:{type:g.Object},handedness:{type:g.Enum,values:["input component","left","right","none"],default:"input component"},rayCastMode:{type:g.Enum,values:["collision","physx"],default:"collision"},styleCursor:{type:g.Bool,default:!0}});var be=class extends x{start(){}init(){let e=[0,0,0];U.getTranslation(e,this.object.transformWorld),console.log("Debug Object:",this.object.name),console.log("Other object:",this.obj.name),console.log("	translation",e),console.log("	transformWorld",this.object.transformWorld),console.log("	transformLocal",this.object.transformLocal)}update(){}};M(be,"TypeName","debug-object"),M(be,"Properties",{obj:{type:g.Object}});function co(t,e,n,i){let s=Math.cos(e/2),o=Math.cos(n/2),l=Math.cos(i/2),c=Math.sin(e/2),_=Math.sin(n/2),p=Math.sin(i/2);t[0]=c*o*l+s*_*p,t[1]=s*_*l-c*o*p,t[2]=s*o*p-c*_*l,t[3]=s*o*l+c*_*p}var xe=class extends x{start(){this.rotationX=0,this.rotationY=0,this.lastClientX=-1,this.lastClientY=-1}init(){this.deviceOrientation=[0,0,0,1],this.screenOrientation=window.innerHeight>window.innerWidth?0:90,this._origin=[0,0,0],window.addEventListener("deviceorientation",function(e){let n=e.alpha||0,i=e.beta||0,s=e.gamma||0,o=Math.PI/180;co(this.deviceOrientation,i*o,n*o,-s*o)}.bind(this)),window.addEventListener("orientationchange",function(e){this.screenOrientation=window.orientation||0}.bind(this),!1)}update(){Module.webxr_session==null&&(this.object.getTranslationLocal(this._origin),this.object.resetTransform(),this.screenOrientation!=0&&this.object.rotateAxisAngleDeg([0,0,-1],this.screenOrientation),this.object.rotate([-Math.sqrt(.5),0,0,Math.sqrt(.5)]),this.object.rotate(this.deviceOrientation),this.object.translate(this._origin))}};M(xe,"TypeName","device-orientation-look"),M(xe,"Properties",{});var ye=class extends x{init(){this.lastTarget=null}start(){this.tip=this.object.getComponent("collision")}update(){let e=this.tip.queryOverlaps(),n=null;for(let i=0;i<e.length;++i){let s=e[i].object,o=s.getComponent("cursor-target");if(o){o.equals(this.lastTarget)||(o.onHover(s,this),o.onClick(s,this)),n=o;break}}if(n)this.lastTarget=n;else{this.lastTarget&&this.lastTarget.onUnhover(this.lastTarget.object,this),this.lastTarget=null;return}}};M(ye,"TypeName","finger-cursor"),M(ye,"Properties",{});var Me=class extends x{start(){this.engine.xrSession?this.setFixedFoveation():this.engine.onXRSessionStart.push(this.setFixedFoveation.bind(this))}setFixedFoveation(){this.engine.xrBaseLayer.fixedFoveation=this.fixedFoveation}};M(Me,"TypeName","fixed-foveation"),M(Me,"Properties",{fixedFoveation:{type:g.Float,default:.5}});var nt=["wrist","thumb-metacarpal","thumb-phalanx-proximal","thumb-phalanx-distal","thumb-tip","index-finger-metacarpal","index-finger-phalanx-proximal","index-finger-phalanx-intermediate","index-finger-phalanx-distal","index-finger-tip","middle-finger-metacarpal","middle-finger-phalanx-proximal","middle-finger-phalanx-intermediate","middle-finger-phalanx-distal","middle-finger-tip","ring-finger-metacarpal","ring-finger-phalanx-proximal","ring-finger-phalanx-intermediate","ring-finger-phalanx-distal","ring-finger-tip","pinky-finger-metacarpal","pinky-finger-phalanx-proximal","pinky-finger-phalanx-intermediate","pinky-finger-phalanx-distal","pinky-finger-tip"],Te=class extends x{init(){this.handedness=["left","right"][this.handedness]}start(){if(this.joints=[],this.session=null,this.hasPose=!1,this._childrenActive=!0,!("XRHand"in window)){console.warn("WebXR Hand Tracking not supported by this browser."),this.active=!1;return}if(this.handSkin){let n=this.handSkin.jointIds;this.joints[nt[0]]=this.engine.wrapObject(n[0]);for(let i=0;i<n.length;++i){let s=this.engine.wrapObject(n[i]);this.joints[s.name]=s}return}for(let e=0;e<=nt.length;++e){let n=this.engine.scene.addObject(this.object.parent),i=n.addComponent("mesh");i.mesh=this.jointMesh,i.material=this.jointMaterial,this.joints[nt[e]]=n}}update(e){if(this.session||this.engine.xrSession&&this.setupVREvents(this.engine.xrSession),!!this.session){if(this.hasPose=!1,this.session&&this.session.inputSources)for(let n=0;n<=this.session.inputSources.length;++n){let i=this.session.inputSources[n];if(!i||!i.hand||i.handedness!=this.handedness)continue;if(this.hasPose=!0,i.hand.get("wrist")!==null){let l=this.engine.wasm.WebXR,c=Module.webxr_frame.getJointPose(i.hand.get("wrist"),l.refSpaces[l.refSpace]);c&&(this.object.resetTranslationRotation(),this.object.transformLocal.set([c.transform.orientation.x,c.transform.orientation.y,c.transform.orientation.z,c.transform.orientation.w]),this.object.translate([c.transform.position.x,c.transform.position.y,c.transform.position.z]))}let s=new Float32Array(3),o=new Float32Array(4);S.invert(o,this.object.transformLocal),this.object.getTranslationLocal(s);for(let l=0;l<nt.length;++l){let c=nt[l],_=this.joints[c];if(_==null)continue;let p=null;if(i.hand.get(c)!==null){let r=this.engine.wasm.WebXR;p=Module.webxr_frame.getJointPose(i.hand.get(c),r.refSpaces[r.refSpace])}if(p!==null)if(this.handSkin)_.resetTranslationRotation(),_.translate([p.transform.position.x-s[0],p.transform.position.y-s[1],p.transform.position.z-s[2]]),_.rotate(o),_.rotateObject([p.transform.orientation.x,p.transform.orientation.y,p.transform.orientation.z,p.transform.orientation.w]);else{_.resetTransform(),_.transformLocal.set([p.transform.orientation.x,p.transform.orientation.y,p.transform.orientation.z,p.transform.orientation.w]),_.translate([p.transform.position.x,p.transform.position.y,p.transform.position.z]);let r=p.radius||.007;_.scale([r,r,r])}else this.handSkin||_.scale([0,0,0])}}!this.hasPose&&this._childrenActive?(this._childrenActive=!1,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!1),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!0,this.setChildrenActive(!0,this.controllerToDeactivate))):this.hasPose&&!this._childrenActive&&(this._childrenActive=!0,this.deactivateChildrenWithoutPose&&this.setChildrenActive(!0),this.controllerToDeactivate&&(this.controllerToDeactivate.active=!1,this.setChildrenActive(!1,this.controllerToDeactivate)))}}setChildrenActive(e,n){n=n||this.object;let i=n.children;for(let s of i)s.active=e,this.setChildrenActive(e,s)}isGrabbing(){let e=[0,0,0];U.getTranslation(e,this.joints["index-finger-tip"].transformLocal);let n=[0,0,0];return U.getTranslation(n,this.joints["thumb-tip"].transformLocal),v.sqrDist(n,e)<.001}setupVREvents(e){this.session=e}};M(Te,"TypeName","hand-tracking"),M(Te,"Properties",{handedness:{type:g.Enum,default:"left",values:["left","right"]},jointMesh:{type:g.Mesh,default:null},jointMaterial:{type:g.Material,default:null},handSkin:{type:g.Skin,default:null},deactivateChildrenWithoutPose:{type:g.Bool,default:!0},controllerToDeactivate:{type:g.Object}});var Ae=class extends x{init(){this.engine.onXRSessionStart.push(this.xrSessionStart.bind(this)),this.engine.onXRSessionEnd.push(this.xrSessionEnd.bind(this)),this.tempScaling=new Float32Array(3),this.tempScaling.set(this.object.scalingLocal),this.visible=!1,this.object.scale([0,0,0])}update(e){let n=this.visible;if(this.xrHitTestSource){let i=this.engine.xrFrame;if(!i)return;let s=i.getHitTestResults(this.xrHitTestSource);if(s.length>0){let o=s[0].getPose(this.xrViewerSpace);this.visible=!0,U.fromMat4(this.object.transformLocal,o.transform.matrix),this.object.setDirty()}else this.visible=!1}this.visible!=n&&(this.visible?(this.object.scalingLocal.set(this.tempScaling),this.object.setDirty()):(this.tempScaling.set(this.object.scalingLocal),this.object.scale([0,0,0])))}xrSessionStart(e){e.requestReferenceSpace("viewer").then(function(n){this.xrViewerSpace=n,e.requestHitTestSource({space:this.xrViewerSpace}).then(function(i){this.xrHitTestSource=i}.bind(this)).catch(console.error)}.bind(this)).catch(console.error)}xrSessionEnd(){this.xrHitTestSource&&(this.xrHitTestSource.cancel(),this.xrHitTestSource=null)}};M(Ae,"TypeName","hit-test-location"),M(Ae,"Properties",{});var Ca=_n($t());var je=class extends x{init(){this.origin=new Float32Array(3),this.fwd=new Float32Array(3),this.up=new Float32Array(3)}update(){this.spatial&&(this.object.getTranslationWorld(this.origin),this.object.getForward(this.fwd),this.object.getUp(this.up),Howler.pos(this.origin[0],this.origin[1],this.origin[2]),Howler.orientation(this.fwd[0],this.fwd[1],this.fwd[2],this.up[0],this.up[1],this.up[2]))}};M(je,"TypeName","howler-audio-listener"),M(je,"Properties",{spatial:{type:g.Bool,default:!0}});var Jn=_n($t());var Se=class extends x{start(){this.audio=new Jn.Howl({src:[this.src],loop:this.loop,volume:this.volume,autoplay:this.autoplay}),this.lastPlayedAudioId=null,this.origin=new Float32Array(3),this.lastOrigin=new Float32Array(3),this.spatial&&this.autoplay&&(this.updatePosition(),this.play());let e=()=>{this.stop();let n=this.engine.onSceneLoaded.indexOf(e);n>=0&&this.engine.onSceneLoaded.splice(n,1)};this.engine.onSceneLoaded.push(e)}update(){!this.spatial||!this.lastPlayedAudioId||(this.object.getTranslationWorld(this.origin),(Math.abs(this.lastOrigin[0]-this.origin[0])>.005||Math.abs(this.lastOrigin[1]-this.origin[1])>.005||Math.abs(this.lastOrigin[2]-this.origin[2])>.005)&&this.updatePosition())}updatePosition(){this.audio.pos(this.origin[0],this.origin[1],this.origin[2],this.lastPlayedAudioId),this.lastOrigin.set(this.origin)}play(){this.lastPlayedAudioId&&this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=this.audio.play(),this.spatial&&this.updatePosition()}stop(){this.lastPlayedAudioId&&(this.audio.stop(this.lastPlayedAudioId),this.lastPlayedAudioId=null)}};M(Se,"TypeName","howler-audio-source"),M(Se,"Properties",{volume:{type:g.Float,default:1},spatial:{type:g.Bool,default:!0},loop:{type:g.Bool,default:!1},autoplay:{type:g.Bool,default:!1},src:{type:g.String,default:""}});var Ce=class extends x{start(){if(!this.material)throw Error("image-texture: material property not set");this.engine.textures.load(this.url,"anonymous").then(e=>{let n=this.material,i=n.shader;i==="Flat Opaque Textured"?n.flatTexture=e:i==="Phong Opaque Textured"||i==="Foliage"?n.diffuseTexture=e:i==="Background"?n.texture=e:i==="Physical Opaque Textured"?n.albedoTexture=e:console.error("Shader",i,"not supported by image-texture")}).catch(console.err)}};M(Ce,"TypeName","image-texture"),M(Ce,"Properties",{url:{type:g.String},material:{type:g.Material}});var Pe=class extends x{init(){this.currentRotationY=0,this.currentRotationX=0,this.origin=new Float32Array(3),this.parentOrigin=new Float32Array(3),this.rotationX=0,this.rotationY=0}start(){document.addEventListener("mousemove",n=>{if(this.active&&(this.mouseDown||!this.requireMouseDown)){this.rotationY=-this.sensitity*n.movementX/100,this.rotationX=-this.sensitity*n.movementY/100,this.currentRotationX+=this.rotationX,this.currentRotationY+=this.rotationY,this.currentRotationX=Math.min(1.507,this.currentRotationX),this.currentRotationX=Math.max(-1.507,this.currentRotationX),this.object.getTranslationWorld(this.origin);let i=this.object.parent;i!==null&&(i.getTranslationWorld(this.parentOrigin),v.sub(this.origin,this.origin,this.parentOrigin)),this.object.resetTranslationRotation(),this.object.rotateAxisAngleRad([1,0,0],this.currentRotationX),this.object.rotateAxisAngleRad([0,1,0],this.currentRotationY),this.object.translate(this.origin)}});let e=this.engine.canvas;this.pointerLockOnClick&&e.addEventListener("mousedown",()=>{e.requestPointerLock=e.requestPointerLock||e.mozRequestPointerLock||e.webkitRequestPointerLock,e.requestPointerLock()}),this.requireMouseDown&&(this.mouseButtonIndex==2&&e.addEventListener("contextmenu",n=>{n.preventDefault()},!1),e.addEventListener("mousedown",n=>{if(n.button==this.mouseButtonIndex&&(this.mouseDown=!0,document.body.style.cursor="grabbing",n.button==1))return n.preventDefault(),!1}),e.addEventListener("mouseup",n=>{n.button==this.mouseButtonIndex&&(this.mouseDown=!1,document.body.style.cursor="initial")}))}};M(Pe,"TypeName","mouse-look"),M(Pe,"Properties",{sensitity:{type:g.Float,default:.25},requireMouseDown:{type:g.Bool,default:!0},mouseButtonIndex:{type:g.Int},pointerLockOnClick:{type:g.Bool,default:!1}});var Ie=class extends x{init(){this.engine.onXRSessionStart.push(this.onXRSessionStart.bind(this)),this.engine.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))}start(){this.object.resetTranslationRotation(),this.object.translate([0,this.height,0])}onXRSessionStart(){let e=this.engine.wasm.WebXR;["local","viewer"].includes(e.refSpace)||this.object.resetTranslationRotation()}onXRSessionEnd(){let e=this.engine.wasm.WebXR;["local","viewer"].includes(e.refSpace)||(this.object.resetTranslationRotation(),this.object.translate([0,this.height,0]))}};M(Ie,"TypeName","player-height"),M(Ie,"Properties",{height:{type:g.Float,default:1.75}});var Oe=class extends x{start(){this.engine.xrSession?this.setTargetFramerate(this.engine.xrSession):this.engine.onXRSessionStart.push(this.setTargetFramerate.bind(this))}setTargetFramerate(e){if(e.supportedFrameRates&&e.updateTargetFrameRate){let n=this.engine.xrSession.supportedFrameRates;n.sort((i,s)=>Math.abs(i-this.framerate)-Math.abs(s-this.framerate)),this.engine.xrSession.updateTargetFrameRate(n[0])}}};M(Oe,"TypeName","target-framerate"),M(Oe,"Properties",{framerate:{type:g.Float,default:90}});var Ee=class extends x{init(){if(this._prevThumbstickAxis=new Float32Array(2),this._tempVec=new Float32Array(3),this._tempVec0=new Float32Array(3),this._currentIndicatorRotation=0,this.input=this.object.getComponent("input"),!this.input){console.error(this.object.name,"generic-teleport-component.js: input component is required on the object");return}if(!this.teleportIndicatorMeshObject){console.error(this.object.name,"generic-teleport-component.js: Teleport indicator mesh is missing");return}if(!this.camRoot){console.error(this.object.name,"generic-teleport-component.js: camRoot not set");return}this.isIndicating=!1,this.indicatorHidden=!0,this.hitSpot=new Float32Array(3),this._hasHit=!1,this._extraRotation=0,this._currentStickAxes=new Float32Array(2)}start(){if(this.cam&&(this.isMouseIndicating=!1,canvas.addEventListener("mousedown",this.onMouseDown.bind(this)),canvas.addEventListener("mouseup",this.onMouseUp.bind(this))),this.handedness==0){let e=this.object.getComponent("input");e?(this.handedness=e.handedness,this.input=e):console.warn("teleport component on object",this.object.name,'was configured with handedness "input component", but object has no input component.')}else this.handedness=["left","right"][this.handedness-1];this.engine.onXRSessionStart.push(this.setupVREvents.bind(this)),this.teleportIndicatorMeshObject.active=!1}_getCamRotation(){return this.eyeLeft.getForward(this._tempVec),this._tempVec[1]=0,v.normalize(this._tempVec,this._tempVec),Math.atan2(this._tempVec[0],this._tempVec[2])}update(){let e=0;if(this.gamepad&&this.gamepad.axes&&(this._currentStickAxes[0]=this.gamepad.axes[2],this._currentStickAxes[1]=this.gamepad.axes[3],e=Math.abs(this._currentStickAxes[0])+Math.abs(this._currentStickAxes[1])),!this.isIndicating&&this._prevThumbstickAxis[1]>=this.thumbstickActivationThreshhold&&this._currentStickAxes[1]<this.thumbstickActivationThreshhold?this.isIndicating=!0:this.isIndicating&&e<this.thumbstickDeactivationThreshhold&&(this.isIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,this._extraRotation)),this.isIndicating&&this.teleportIndicatorMeshObject&&this.input){let n=this._tempVec0;U.getTranslation(n,this.object.transformWorld);let i=this.object.getForward(this._tempVec),s=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(n,i,1<<this.floorGroup):this.engine.physics.rayCast(n,i,1<<this.floorGroup,this.maxDistance);s.hitCount>0?(this.indicatorHidden=!1,this._extraRotation=Math.PI+Math.atan2(this._currentStickAxes[0],this._currentStickAxes[1]),this._currentIndicatorRotation=this._getCamRotation()+(this._extraRotation-Math.PI),this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(s.locations[0]),this.teleportIndicatorMeshObject.translate([0,this.indicatorYOffset,0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot.set(s.locations[0]),this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}else this.teleportIndicatorMeshObject&&this.isMouseIndicating&&this.onMousePressed();this._prevThumbstickAxis.set(this._currentStickAxes)}setupVREvents(e){if(this.session=e,e.addEventListener("end",function(){this.gamepad=null,this.session=null}.bind(this)),e.inputSources&&e.inputSources.length)for(let n=0;n<e.inputSources.length;n++){let i=e.inputSources[n];i.handedness==this.handedness&&(this.gamepad=i.gamepad)}e.addEventListener("inputsourceschange",function(n){if(n.added&&n.added.length)for(let i=0;i<n.added.length;i++){let s=n.added[i];s.handedness==this.handedness&&(this.gamepad=s.gamepad)}}.bind(this))}onMouseDown(){this.isMouseIndicating=!0}onMouseUp(){this.isMouseIndicating=!1,this.teleportIndicatorMeshObject.active=!1,this._hasHit&&this._teleportPlayer(this.hitSpot,0)}onMousePressed(){let e=[0,0,0];U.getTranslation(e,this.cam.transformWorld);let n=this.cam.getForward(this._tempVec),i=this.rayHit=this.rayCastMode==0?this.engine.scene.rayCast(e,n,1<<this.floorGroup):this.engine.physics.rayCast(e,n,1<<this.floorGroup,this.maxDistance);i.hitCount>0?(this.indicatorHidden=!1,n[1]=0,v.normalize(n,n),this._currentIndicatorRotation=-Math.sign(n[2])*Math.acos(n[0])-Math.PI*.5,this.teleportIndicatorMeshObject.resetTranslationRotation(),this.teleportIndicatorMeshObject.rotateAxisAngleRad([0,1,0],this._currentIndicatorRotation),this.teleportIndicatorMeshObject.translate(i.locations[0]),this.teleportIndicatorMeshObject.active=!0,this.hitSpot=i.locations[0],this._hasHit=!0):(this.indicatorHidden||(this.teleportIndicatorMeshObject.active=!1,this.indicatorHidden=!0),this._hasHit=!1)}_teleportPlayer(e,n){this.camRoot.rotateAxisAngleRad([0,1,0],n);let i=this._tempVec,s=this._tempVec0;this.session?(this.eyeLeft.getTranslationWorld(i),this.eyeRight.getTranslationWorld(s),v.add(i,i,s),v.scale(i,i,.5)):this.cam.getTranslationWorld(i),this.camRoot.getTranslationWorld(s),v.sub(i,s,i),i[0]+=e[0],i[1]=e[1],i[2]+=e[2],this.camRoot.setTranslationWorld(i)}};M(Ee,"TypeName","teleport"),M(Ee,"Properties",{teleportIndicatorMeshObject:{type:g.Object},camRoot:{type:g.Object},cam:{type:g.Object},eyeLeft:{type:g.Object},eyeRight:{type:g.Object},handedness:{type:g.Enum,values:["input component","left","right","none"],default:"input component"},floorGroup:{type:g.Int,default:1},thumbstickActivationThreshhold:{type:g.Float,default:-.7},thumbstickDeactivationThreshhold:{type:g.Float,default:.3},indicatorYOffset:{type:g.Float,default:.01},rayCastMode:{type:g.Enum,values:["collision","physx"],default:"collision"},maxDistance:{type:g.Float,default:100}});var St=v.create(),X=v.create(),it=v.create(),Re=class extends x{init(){this.points=new Array(this.segments+1);for(let e=0;e<this.points.length;++e)this.points[e]=v.create();this.currentPointOffset=0,this.up=[0,1,0],this.timeTillNext=this.interval}start(){this.trailContainer=this.engine.scene.addObject(),this.meshComp=this.trailContainer.addComponent("mesh"),this.meshComp.material=this.material;let e=2*this.points.length;this.indexData=new Uint32Array(6*this.segments);for(let n=0,i=0;n<e-2;n+=2,i+=6)this.indexData.subarray(i,i+6).set([n+1,n+0,n+2,n+2,n+3,n+1]);this.mesh=new $({vertexCount:e,indexData:this.indexData,indexType:G.UnsignedInt}),this.meshComp.mesh=this.mesh}updateVertices(){let e=this.mesh.attribute(N.Position),n=this.mesh.attribute(N.TextureCoordinate),i=this.mesh.attribute(N.Normal);v.set(St,0,0,0);for(let s=0;s<this.points.length;++s){let o=this.points[(this.currentPointIndex+s+1)%this.points.length],l=this.points[(this.currentPointIndex+s+2)%this.points.length];s!==this.points.length-1&&v.sub(St,l,o),v.cross(X,this.up,St),v.normalize(X,X);let c=1-this.timeTillNext/this.interval,_=(s-c)/this.segments;v.scale(X,X,(this.taper?_:1)*this.width/2),e.set(s*2,[o[0]-X[0],o[1]-X[1],o[2]-X[2]]),e.set(s*2+1,[o[0]+X[0],o[1]+X[1],o[2]+X[2]]),i&&(v.cross(it,St,X),v.normalize(it,it),i.set(s*2,it),i.set(s*2+1,it)),n&&(n.set(s*2,[0,_]),n.set(s*2+1,[1,_]))}this.mesh.update()}resetTrail(){this.object.getTranslationWorld(this.points[0]);for(let e=1;e<this.points.length;++e)v.copy(this.points[e],this.points[0]);this.currentPointIndex=0,this.timeTillNext=this.interval}update(e){this.timeTillNext-=e,e>this.resetThreshold&&this.resetTrail(),this.timeTillNext<0&&(this.currentPointIndex=(this.currentPointIndex+1)%this.points.length,this.timeTillNext=this.timeTillNext%this.interval+this.interval),this.object.getTranslationWorld(this.points[this.currentPointIndex]),this.updateVertices()}onActivate(){this.resetTrail()}onDestroy(){this.trailContainer.destroy(),this.mesh.destroy()}};M(Re,"TypeName","trail"),M(Re,"Properties",{material:{type:g.Material},segments:{type:g.Int,default:50},interval:{type:g.Float,default:.1},width:{type:g.Float,default:1},taper:{type:g.Bool,default:!0},resetThreshold:{type:g.Float,default:.5}});Math.clamp=function(t,e,n){return Math.max(e,Math.min(t,n))};var _o=function(){let t=new Float32Array(3),e=new Float32Array(3),n=new Float32Array(3),i=new Float32Array(3),s=new Float32Array(3),o=new Float32Array(3),l=new Float32Array(3),c=new Float32Array(4),_=new Float32Array(4),p=new Float32Array(4),r=new Float32Array(4);return function(a,h,d,u,f,m,w,b,y,A){v.sub(n,u,d);let T=v.length(n);v.sub(t,u,f);let j=v.length(t);v.sub(t,m,d);let O=Math.clamp(v.length(t),w,T+j-w);v.sub(e,f,d),v.sub(i,d,u),v.sub(s,f,u),v.normalize(e,e),v.normalize(n,n),v.normalize(i,i),v.normalize(s,s),v.normalize(t,t);let C=Math.acos(Math.clamp(v.dot(e,n),-1,1)),k=Math.acos(Math.clamp(v.dot(i,s),-1,1)),F=Math.acos(Math.clamp(v.dot(e,t),-1,1)),L=Math.acos(Math.clamp((j*j-T*T-O*O)/(-2*T*O),-1,1)),B=Math.acos(Math.clamp((O*O-T*T-j*j)/(-2*T*j),-1,1));v.sub(e,f,d),v.sub(n,u,d),v.sub(t,m,d),v.cross(o,e,n),v.cross(l,e,t),A?(v.sub(n,A,u),v.transformQuat(n,[0,0,-1],y)):v.sub(n,u,d);let R=v.length(o);R==0?o.set([1,0,0]):v.scale(o,o,1/R),v.normalize(l,l),S.conjugate(b,b),S.setAxisAngle(_,v.transformQuat(c,o,b),L-C),S.setAxisAngle(r,v.transformQuat(c,l,b),F),S.mul(a,a,S.mul(c,_,r)),S.normalize(a,a),S.conjugate(y,y),S.setAxisAngle(p,v.transformQuat(c,o,y),B-k),S.mul(h,h,p),S.normalize(h,h)}}(),ke=class extends x{init(){this.pos=new Float32Array(3*7),this.p=[this.pos.subarray(0,3),this.pos.subarray(3,6),this.pos.subarray(6,9),this.pos.subarray(9,12),this.pos.subarray(12,15),this.pos.subarray(15,18),this.pos.subarray(18,21)]}update(){let e=this.p;this.root.getTranslationWorld(e[0]),this.middle.getTranslationWorld(e[1]),this.end.getTranslationWorld(e[2]),this.target.getTranslationWorld(e[3]);let n=e[4],i=e[5];this.root.getTranslationLocal(n),this.middle.getTranslationLocal(i),this.helper&&this.helper.getTranslationWorld(e[6]),_o(this.root.transformLocal,this.middle.transformLocal,e[0],e[1],e[2],e[3],.01,this.root.transformWorld.subarray(0,4),this.middle.transformWorld.subarray(0,4),this.helper?e[6]:null),this.root.setTranslationLocal(n),this.middle.setTranslationLocal(i),this.root.setDirty(),this.middle.setDirty()}};M(ke,"TypeName","two-joint-ik-solver"),M(ke,"Properties",{root:{type:g.Object},middle:{type:g.Object},end:{type:g.Object},target:{type:g.Object},helper:{type:g.Object}});var Fe=class extends x{init(){if(!this.material)throw Error("video-texture: material property not set");this.loaded=!1,this.frameUpdateRequested=!0}start(){if(this.video=document.createElement("video"),this.video.src=this.url,this.video.crossOrigin="anonymous",this.video.playsInline=!0,this.video.loop=this.loop,this.video.muted=this.muted,this.video.addEventListener("playing",()=>{this.loaded=!0}),this.autoplay){let e=()=>{this.video.play(),window.removeEventListener("click",e),window.removeEventListener("touchstart",e)};window.addEventListener("click",e),window.addEventListener("touchstart",e)}}applyTexture(){let e=this.material,n=e.shader,i=this.texture=new _e(this.engine,this.video);n==="Flat Opaque Textured"?e.flatTexture=i:n==="Phong Opaque Textured"||n==="Foliage"?e.diffuseTexture=i:n==="Background"?e.texture=i:n==="Physical Opaque Textured"?e.albedoTexture=i:console.error("Shader",n,"not supported by video-texture"),"requestVideoFrameCallback"in this.video?this.video.requestVideoFrameCallback(this.updateVideo.bind(this)):this.video.addEventListener("timeupdate",()=>{this.frameUpdateRequested=!0})}update(e){this.loaded&&this.frameUpdateRequested&&(this.texture?this.texture.update():this.applyTexture(),this.frameUpdateRequested=!1)}updateVideo(){this.frameUpdateRequested=!0,this.video.requestVideoFrameCallback(this.updateVideo.bind(this))}};M(Fe,"TypeName","video-texture"),M(Fe,"Properties",{url:{type:g.String},material:{type:g.Material},loop:{type:g.Bool,default:!0},autoplay:{type:g.Bool,default:!0},muted:{type:g.Bool,default:!0}});var Be=class extends x{start(){this.components=[],this.getComponents(this.object),this.onXRSessionEnd(),this.engine.onXRSessionStart.push(this.onXRSessionStart.bind(this)),this.engine.onXRSessionEnd.push(this.onXRSessionEnd.bind(this))}getComponents(e){let n=e.getComponents().filter(i=>i.type!=="vr-mode-active-switch");if(this.components=this.components.concat(n),this.affectChildren){let i=e.children;for(let s=0;s<i.length;++s)this.getComponents(i[s])}}setComponentsActive(e){let n=this.components;for(let i=0;i<n.length;++i)n[i].active=e}onXRSessionStart(){this.active&&this.setComponentsActive(this.activateComponents==0)}onXRSessionEnd(){this.active&&this.setComponentsActive(this.activateComponents!=0)}};M(Be,"TypeName","vr-mode-active-switch"),M(Be,"Properties",{activateComponents:{type:g.Enum,values:["in VR","in non-VR"],default:"in VR"},affectChildren:{type:g.Bool,default:!0}});var ho={X:[1,0,0],Y:[0,1,0],Z:[0,0,1]},po={PositiveX:[1,0,0],NegativeX:[-1,0,0],PositiveY:[0,1,0],NegativeY:[0,-1,0],PositiveZ:[0,0,1],NegativeZ:[0,0,-1]},Le=class extends x{meta=null;bones={hips:null,spine:null,chest:null,upperChest:null,neck:null,head:null,leftEye:null,rightEye:null,jaw:null,leftUpperLeg:null,leftLowerLeg:null,leftFoot:null,leftToes:null,rightUpperLeg:null,rightLowerLeg:null,rightFoot:null,rightToes:null,leftShoulder:null,leftUpperArm:null,leftLowerArm:null,leftHand:null,rightShoulder:null,rightUpperArm:null,rightLowerArm:null,rightHand:null,leftThumbMetacarpal:null,leftThumbProximal:null,leftThumbDistal:null,leftIndexProximal:null,leftIndexIntermediate:null,leftIndexDistal:null,leftMiddleProximal:null,leftMiddleIntermediate:null,leftMiddleDistal:null,leftRingProximal:null,leftRingIntermediate:null,leftRingDistal:null,leftLittleProximal:null,leftLittleIntermediate:null,leftLittleDistal:null,rightThumbMetacarpal:null,rightThumbProximal:null,rightThumbDistal:null,rightIndexProximal:null,rightIndexIntermediate:null,rightIndexDistal:null,rightMiddleProximal:null,rightMiddleIntermediate:null,rightMiddleDistal:null,rightRingProximal:null,rightRingIntermediate:null,rightRingDistal:null,rightLittleProximal:null,rightLittleIntermediate:null,rightLittleDistal:null};restPose={};_nodeConstraints=[];_springChains=[];_sphereColliders=[];_capsuleColliders=[];_firstPersonAnnotations=[];_lookAt=null;_initialized=!1;init(){this._tempV3=v.create(),this._tempV3A=v.create(),this._tempV3B=v.create(),this._tempQuat=S.create(),this._tempQuatA=S.create(),this._tempQuatB=S.create(),this._tempMat4A=ie.create(),this._tempQuat2=U.create(),this._tailToShape=v.create(),this._headToTail=v.create(),this._inertia=v.create(),this._stiffness=v.create(),this._external=v.create(),this._rightVector=v.set(v.create(),1,0,0),this._upVector=v.set(v.create(),0,1,0),this._forwardVector=v.set(v.create(),0,0,1),this._identityQuat=S.identity(S.create()),this._rad2deg=180/Math.PI}start(){if(!this.src){console.error("vrm: src property not set");return}this.engine.scene.append(this.src,{loadGltfExtensions:!0}).then(({root:e,extensions:n})=>{e.children.forEach(i=>i.parent=this.object),this._initializeVrm(n),e.destroy()})}_initializeVrm(e){if(this._initialized)throw Error("VRM component has already been initialized");let n=e.root.VRMC_vrm;if(!n)throw Error("Missing VRM extensions");if(n.specVersion!=="1.0")throw Error(`Unsupported VRM version, only 1.0 is supported, but encountered '${n.specVersion}'`);this.meta=n.meta,this._parseHumanoid(n.humanoid,e),n.firstPerson&&this._parseFirstPerson(n.firstPerson,e),n.lookAt&&this._parseLookAt(n.lookAt),this._findAndParseNodeConstraints(e);let i=e.root.VRMC_springBone;i&&this._parseAndInitializeSpringBones(i,e),this._initialized=!0}_parseHumanoid(e,n){for(let i in e.humanBones){if(!(i in this.bones)){console.warn(`Unrecognized bone '${i}'`);continue}let s=e.humanBones[i].node,o=n.idMapping[s];this.bones[i]=this.engine.wrapObject(o),this.restPose[i]=S.copy(S.create(),this.bones[i].rotationLocal)}}_parseFirstPerson(e,n){for(let i of e.meshAnnotations){let s={node:this.engine.wrapObject(n.idMapping[i.node]),firstPerson:!0,thirdPerson:!0};switch(i.type){case"firstPersonOnly":s.thirdPerson=!1;break;case"thirdPersonOnly":s.firstPerson=!1;break;case"both":break;case"auto":console.warn("First person mesh annotation type 'auto' is not supported, treating as 'both'!");break;default:console.error(`Invalid mesh annotation type '${i.type}'`);break}this._firstPersonAnnotations.push(s)}}_parseLookAt(e){if(e.type!=="bone"){console.warn(`Unsupported lookAt type '${e.type}', only 'bone' is supported`);return}let n=i=>({inputMaxValue:i.inputMaxValue,outputScale:i.outputScale});this._lookAt={offsetFromHeadBone:e.offsetFromHeadBone||[0,0,0],horizontalInner:n(e.rangeMapHorizontalInner),horizontalOuter:n(e.rangeMapHorizontalOuter),verticalDown:n(e.rangeMapVerticalDown),verticalUp:n(e.rangeMapVerticalUp)}}_findAndParseNodeConstraints(e){let n=i=>{let s=e.node[i.objectId];if(s&&"VRMC_node_constraint"in s){let l=s.VRMC_node_constraint.constraint,c,_;if("roll"in l?(c="roll",_=ho[l.roll.rollAxis]):"aim"in l?(c="aim",_=po[l.aim.aimAxis]):"rotation"in l&&(c="rotation"),c){let p=this.engine.wrapObject(e.idMapping[l[c].source]);this._nodeConstraints.push({type:c,source:p,destination:i,axis:_,weight:l[c].weight,destinationRestLocalRotation:S.copy(S.create(),i.rotationLocal),sourceRestLocalRotation:S.copy(S.create(),p.rotationLocal),sourceRestLocalRotationInv:S.invert(S.create(),p.rotationLocal)})}else console.warn("Unrecognized or invalid VRMC_node_constraint, ignoring it")}for(let o of i.children)n(o)};n(this.object)}_parseAndInitializeSpringBones(e,n){let i=(e.colliders||[]).map((o,l)=>{let c="capsule"in o.shape?"capsule":"sphere";return{id:l,object:this.engine.wrapObject(n.idMapping[o.node]),shape:{isCapsule:c==="capsule",radius:o.shape[c].radius,offset:o.shape[c].offset,tail:o.shape[c].tail},cache:{head:v.create(),tail:v.create()}}});this._sphereColliders=i.filter(o=>!o.shape.isCapsule),this._capsuleColliders=i.filter(o=>o.shape.isCapsule);let s=(e.colliderGroups||[]).map(o=>({name:o.name,colliders:o.colliders.map(l=>i[l])}));for(let o of e.springs){let l=[];for(let _ of o.joints){let p={hitRadius:0,stiffness:1,gravityPower:0,gravityDir:[0,-1,0],dragForce:.5,node:null,state:null};Object.assign(p,_),p.node=this.engine.wrapObject(n.idMapping[p.node]),l.push(p)}let c=(o.colliderGroups||[]).flatMap(_=>s[_].colliders);this._springChains.push({name:o.name,center:o.center?this.engine.wrapObject(n.idMapping[o.center]):null,joints:l,sphereColliders:c.filter(_=>!_.shape.isCapsule),capsuleColliders:c.filter(_=>_.shape.isCapsule)})}for(let o of this._springChains)for(let l=0;l<o.joints.length-1;++l){let c=o.joints[l],_=o.joints[l+1],p=c.node.getTranslationWorld(v.create()),r=_.node.getTranslationWorld(v.create()),a=v.subtract(this._tempV3A,p,r),h={prevTail:r,currentTail:v.copy(v.create(),r),initialLocalRotation:S.copy(S.create(),c.node.rotationLocal),initialLocalTransformInvert:U.invert(U.create(),c.node.transformLocal),boneAxis:v.normalize(v.create(),_.node.getTranslationLocal(this._tempV3)),boneLength:Math.max(.01,v.length(a)),prevTailCenter:null,currentTailCenter:null};o.center&&(h.prevTailCenter=o.center.transformPointInverseWorld(v.create(),r),h.currentTailCenter=v.copy(v.create(),r)),c.state=h}}update(e){this._initialized&&(this._resolveLookAt(),this._resolveConstraints(),this._updateSpringBones(e))}_rangeMap(e,n){let i=e.inputMaxValue,s=e.outputScale;return Math.min(n,i)/i*s}_resolveLookAt(){if(!this._lookAt||!this.lookAtTarget)return;let e=this.bones.head.transformPointWorld(this._tempV3A,this._lookAt.offsetFromHeadBone),n=this.lookAtTarget.getTranslationWorld(this._tempV3B),i=v.sub(this._tempV3A,n,e);v.normalize(i,i),this.bones.head.parent.transformVectorInverseWorld(i);let s=v.dot(i,this._forwardVector),o=v.dot(i,this._rightVector),l=Math.atan2(o,s)*this._rad2deg,c=Math.sqrt(o*o+s*s),_=v.dot(i,this._upVector),p=Math.atan2(-_,c)*this._rad2deg;if(p>0?p=this._rangeMap(this._lookAt.verticalDown,p):p=-this._rangeMap(this._lookAt.verticalUp,-p),this.bones.leftEye){let r=l;r>0?r=this._rangeMap(this._lookAt.horizontalInner,r):r=-this._rangeMap(this._lookAt.horizontalOuter,-r);let a=S.fromEuler(this._tempQuatA,p,r,0);this.bones.leftEye.rotationLocal=S.multiply(a,this.restPose.leftEye,a)}if(this.bones.rightEye){let r=l;r>0?r=this._rangeMap(this._lookAt.horizontalOuter,r):r=-this._rangeMap(this._lookAt.horizontalInner,-r);let a=S.fromEuler(this._tempQuatA,p,r,0);this.bones.rightEye.rotationLocal=S.multiply(a,this.restPose.rightEye,a)}}_resolveConstraints(){for(let e of this._nodeConstraints)this._resolveConstraint(e)}_resolveConstraint(e){let n=e.destinationRestLocalRotation,i=e.sourceRestLocalRotationInv,s=S.identity(this._tempQuatA);switch(e.type){case"roll":{let o=S.multiply(this._tempQuatA,i,e.source.rotationLocal),l=S.multiply(this._tempQuatA,e.sourceRestLocalRotation,o);S.mul(l,l,i);let c=S.invert(this._tempQuatB,n),_=S.multiply(this._tempQuatB,c,l);S.multiply(_,_,n);let p=v.transformQuat(this._tempV3A,e.axis,_),r=S.rotationTo(this._tempQuatA,e.axis,p);S.mul(s,n,S.invert(this._tempQuat,r)),S.mul(s,s,_)}break;case"aim":{let o=e.destination.parent.rotationWorld,l=v.transformQuat(this._tempV3A,e.axis,n);v.transformQuat(l,l,o);let c=e.source.getTranslationWorld(this._tempV3B);v.sub(c,c,e.destination.getTranslationWorld(this._tempV3)),v.normalize(c,c);let _=S.rotationTo(this._tempQuatA,l,c);S.mul(s,S.invert(this._tempQuat,o),_),S.mul(s,s,o),S.mul(s,s,n)}break;case"rotation":{let o=S.mul(s,i,e.source.rotationLocal);S.mul(s,n,o)}break}S.slerp(s,n,s,e.weight),e.destination.rotationLocal=s}_updateSpringBones(e){this._sphereColliders.forEach(({object:n,shape:i,cache:s})=>{let o=v.copy(s.head,i.offset);n.transformVectorWorld(o),v.add(s.head,n.getTranslationWorld(this._tempV3),o)}),this._capsuleColliders.forEach(({object:n,shape:i,cache:s})=>{let o=n.getTranslationWorld(this._tempV3A),l=v.copy(s.head,i.offset);n.transformVectorWorld(l),v.add(s.head,o,l);let c=v.copy(s.tail,i.tail);n.transformVectorWorld(c),v.add(s.tail,o,c)}),this._springChains.forEach(n=>{for(let i=0;i<n.joints.length-1;++i){let s=n.joints[i],o=s.node.parent?s.node.parent.rotationWorld:this._identityQuat,l=this._inertia;n.center?(v.sub(l,s.state.currentTailCenter,s.state.prevTailCenter),n.center.transformVectorWorld(l)):v.sub(l,s.state.currentTail,s.state.prevTail),v.scale(l,l,1-s.dragForce);let c=v.copy(this._stiffness,s.state.boneAxis);v.transformQuat(c,c,s.state.initialLocalRotation),v.transformQuat(c,c,o),v.scale(c,c,e*s.stiffness);let _=v.scale(this._external,s.gravityDir,e*s.gravityPower),p=v.copy(this._tempV3A,s.state.currentTail);v.add(p,p,l),v.add(p,p,c),v.add(p,p,_);let r=s.node.getTranslationWorld(this._tempV3B);v.sub(p,p,r),v.normalize(p,p),v.scaleAndAdd(p,r,p,s.state.boneLength);for(let{shape:d,cache:u}of n.sphereColliders){let f=this._tailToShape,m=u.head;f=v.sub(f,p,m);let w=d.radius+s.hitRadius,b=v.length(f)-w;b<0&&(v.normalize(f,f),v.scaleAndAdd(p,p,f,-b),v.sub(p,p,r),v.normalize(p,p),v.scaleAndAdd(p,r,p,s.state.boneLength))}for(let{shape:d,cache:u}of n.capsuleColliders){let f=this._tailToShape,m=u.head,w=u.tail;f=v.sub(f,p,m);let b=v.sub(this._headToTail,w,m),y=v.dot(b,f);v.squaredLength(b)<=y?v.sub(f,p,w):y>0&&(v.scale(b,b,y/v.squaredLength(b)),v.sub(f,f,b));let A=d.radius+s.hitRadius,T=v.length(f)-A;T<0&&(v.normalize(f,f),v.scaleAndAdd(p,p,f,-T),v.sub(p,p,r),v.normalize(p,p),v.scaleAndAdd(p,r,p,s.state.boneLength))}v.copy(s.state.prevTail,s.state.currentTail),v.copy(s.state.currentTail,p),n.center&&(v.copy(s.state.prevTailCenter,s.state.currentTailCenter),v.copy(s.state.currentTailCenter,p),n.center.transformPointInverseWorld(s.state.currentTailCenter)),s.node.parent.transformPointInverseWorld(p);let a=U.fromTranslation(this._tempQuat2,p);U.multiply(a,s.state.initialLocalTransformInvert,a),U.getTranslation(p,a),v.normalize(p,p);let h=S.rotationTo(this._tempQuatA,s.state.boneAxis,p);s.node.rotationLocal=S.mul(this._tempQuatA,s.state.initialLocalRotation,h)}})}set firstPerson(e){this._firstPersonAnnotations.forEach(n=>{let i=e==n.firstPerson||e!=n.thirdPerson;n.node.getComponents("mesh").forEach(s=>{s.active=i})})}};M(Le,"TypeName","vrm"),M(Le,"Properties",{src:{type:g.String},lookAtTarget:{type:g.Object}});var De=class extends x{init(){this.up=!1,this.right=!1,this.down=!1,this.left=!1,window.addEventListener("keydown",this.press.bind(this)),window.addEventListener("keyup",this.release.bind(this))}start(){this.headObject=this.headObject||this.object}update(){let e=[0,0,0];this.up&&(e[2]-=1),this.down&&(e[2]+=1),this.left&&(e[0]-=1),this.right&&(e[0]+=1),v.normalize(e,e),e[0]*=this.speed,e[2]*=this.speed,v.transformQuat(e,e,this.headObject.transformWorld),this.object.translate(e)}press(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!0:e.keyCode===39||e.keyCode===68?this.right=!0:e.keyCode===40||e.keyCode===83?this.down=!0:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!0)}release(e){e.keyCode===38||e.keyCode===87||e.keyCode===90?this.up=!1:e.keyCode===39||e.keyCode===68?this.right=!1:e.keyCode===40||e.keyCode===83?this.down=!1:(e.keyCode===37||e.keyCode===65||e.keyCode===81)&&(this.left=!1)}};M(De,"TypeName","wasd-controls"),M(De,"Properties",{speed:{type:g.Float,default:.1},headObject:{type:g.Object}});var Zt=class{constructor(){this.PREFAB_UNAME_KEY="pun";this._prefabs=new Map}registerPrefab(e){let n=e.getPrefabUniqueName();if(this._prefabs.has(n))throw new Error("Can't register the same prefab twice: "+n);this._prefabs.set(n,e),e.object[this.PREFAB_UNAME_KEY]=n}getPrefab(e){return this._prefabs.has(e.TypeName)?this._prefabs.get(e.TypeName):null}getPrefabByName(e){return this._prefabs.has(e)?this._prefabs.get(e):null}removePrefab(e){this._prefabs.has(e.TypeName)&&this._prefabs.delete(e.TypeName)}},V=new Zt;function ze(){return WL.scene}function Kn(){return WL.onXRSessionStart}var rt=class{constructor(e){this._layerSize=e,this._layerData=new Array(this._layerSize);for(let n=0;n<this._layerSize;++n)this._layerData[n]=new Array(this._layerSize)}};var he=class{get gridSize(){return this._gridSize}get layerCount(){return this._layerCount}get cellSize(){return this._cellSize}constructor(e,n,i){this._gridSize=e,this._layerCount=n,this._cellSize=i,this._gridOffset=this._gridSize*this._cellSize/2,this._gridData=new Array(this._layerCount);for(let s=0;s<this._layerCount;++s)this._gridData[s]=new rt(this._gridSize);console.log(this._gridData)}getCellPositionVec3(e){return this.getCellPosition(e[0],e[1],e[2])}getCellPosition(e,n,i){let s=v.create();return s[1]=n*this._cellSize,s[0]=e*this._cellSize-this._gridOffset,s[2]=i*this._cellSize-this._gridOffset,s}getCellIndices(e,n,i){let s=v.create();return s[0]=Math.round((e+this._gridOffset)/this._cellSize),s[1]=Math.floor(n/this._cellSize),s[2]=Math.round((i+this._gridOffset)/this._cellSize),s}};var Jt=class{get grid(){return this._grid}constructor(e,n,i){this._grid=new he(e,n,i)}},pe=new Jt(30,10,.25);var J=class{static setTag(e,n){e[this.tagKey]=n}static hasTag(e,n){return!(!e[this.tagKey]&&e[this.tagKey]!==n)}static getTag(e){return e[this.tagKey]}};J.tagKey="TAG";var K=class extends x{start(){J.setTag(this.object,parseInt(this.tag))}};K.TypeName="tag-component",K.Properties={tag:{type:g.Enum,values:[0 .toString(),2 .toString()]}};var Q=class extends x{start(){this._scene=ze(),this._cellSize=pe.grid.cellSize}createPrevisObject(){this._previsObject=this._scene.addObject(null),this._previsObject.translateWorld([0,-5,0]);let n=this._scene.addObject(this._previsObject);n.translateObject([0,this._cellSize/2,0]),n.addComponent("mesh",{mesh:this.previsMesh,material:this.previsMat})}createBlock(n,i,s){let o=this._scene.addObject(s);o[V.PREFAB_UNAME_KEY]=this.getPrefabUniqueName(),o.translateWorld(n);let l=this._scene.addObject(o);l.resetRotation(),l.translateObject([0,this._cellSize/2,0]),l.rotate(this._previsObject.rotationWorld);let c=this.finalMat.clone();c.albedoTexture=i.albedoTexture,c.normalTexture=i.normalTexture,l.addComponent("mesh",{mesh:this.finalMesh,material:c}),l.addComponent(K,{tag:1});let _=this._cellSize/2+.001;return l.addComponent("collision",{collider:pt.AxisAlignedBox,extents:[_,_,_],group:1}),o}updatePrevisPosition(n){this._previsObject.setTranslationWorld(n);let i=v.create();this._previsObject.getTranslationWorld(i)}updatePrevisRotation(n,i){this._previsObject.rotateAxisAngleDeg([1,0,0],n),this._previsObject.rotateAxisAngleDeg([0,1,0],i)}setPrevisRotation(n){this._previsObject.resetRotation(),this._previsObject.rotationWorld=n}updatePrevisColor(n){this.previsMat.diffuseColor=n}};Q.TypeName="",Q.Properties={finalMesh:{type:g.Mesh},previsMesh:{type:g.Mesh},finalMat:{type:g.Material},previsMat:{type:g.Material}};var en=class extends Q{getPrefabUniqueName(){return en.TypeName}start(){super.start(),V.registerPrefab(this),this.createPrevisObject()}},re=en;re.TypeName="block-slope-prefab",re.Properties={finalMesh:{type:g.Mesh},previsMesh:{type:g.Mesh},finalMat:{type:g.Material},previsMat:{type:g.Material}};var tn=class{constructor(){this._currentPrefab=null,this._currentColor=[1,1,1,1],this.test()}test(){return hn(this,null,function*(){yield new Promise(e=>setTimeout(e,1e3)),this._currentPrefab=V.getPrefab(re),this._currentPrefab.updatePrevisColor(this._currentColor)})}setBuildContainer(e){this._buildContainer=e}setCurrentPrevizPosition(e){this._currentPrefab.updatePrevisPosition(e)}setPrefab(e){this._currentPrefab=e}setColor(e){this._currentColor=e,this._currentPrefab.updatePrevisColor(this._currentColor)}setTexture(e){this._currentTexture=e}addCurrentPrevizRotation(e,n){this._currentPrefab.updatePrevisRotation(e,n)}instanciatePrefabAt(e){this._currentPrefab.createBlock(e,this._currentTexture,this._buildContainer)}getCurrentBuildData(){return this._buildContainer.getComponent(te).generateBuildData()}loadBuild(e){this._buildContainer.getComponent(te).loadBuildData(e)}},D=new tn;var te=class extends x{init(){D.setBuildContainer(this.object)}generateBuildData(){let e=new Array,n=this.object.children;for(let i of n){let s=i.children[0],o=s.getComponent("mesh"),l=v.create();i.getTranslationWorld(l);let c=o.material.diffuseColor,_=Z.fromValues(c[0],c[1],c[2],c[3]);e.push({type:i[V.PREFAB_UNAME_KEY],color:_,position:l,rotation:s.rotationWorld})}return e}loadBuildData(e){this.clearBlocksInScene();let n;for(let i of e){n=V.getPrefabByName(i.type),n.setPrevisRotation(i.rotation),D.setPrefab(n);let s=new Float32Array([i.color[0],i.color[1],i.color[2],i.color[3]]);D.setColor(s),D.instanciatePrefabAt(i.position)}}clearBlocksInScene(){for(let e of this.object.children)e.destroy()}};te.TypeName="build-container",te.Properties={};var Ne=class extends x{start(){this._grid=new he(2,10,.5);let n=this.debugVisualObject.getComponent("mesh"),i=ze(),s=25/2;for(let o=0;o<this._grid.layerCount;++o)for(let l=0;l<this._grid.gridSize;++l)for(let c=0;c<this._grid.gridSize;++c){let _=i.addObject(this.object);_.addComponent("mesh",{mesh:n.mesh,material:n.material}),_.resetTranslation(),_.translate(this._grid.getCellPosition(l,o,c));let p=this._grid.cellSize;_.scale([p,p,p])}}};Ne.TypeName="grid-debug-component",Ne.Properties={debugVisualObject:{type:g.Object,default:null}};var st=class{get isPressed(){return this._isPressed}get wasPressed(){return this._wasPressed}constructor(e,n){this._gamepadButton=e,this._index=n,this._isPressed=!1,this._wasPressed=!1,this._onPressedEvent=new Array,this._onReleasedEvent=new Array}update(){if(this._isPressed=this._gamepadButton.pressed,this._isPressed&&!this._wasPressed){for(let e of this._onPressedEvent)e(this);this._wasPressed=!0}if(!this._isPressed&&this._wasPressed){for(let e=0;e<this._onReleasedEvent.length;e++)this._onReleasedEvent[e](this);this._wasPressed=!1}}addPressedListener(e){return this._onPressedEvent.push(e)-1}addReleasedListener(e){return this._onReleasedEvent.push(e)-1}removePressedListener(e){this._onPressedEvent.splice(e,1)}removeReleasedListener(e){this._onReleasedEvent.splice(e,1)}clearPressedListeners(){this._onPressedEvent=new Array}clearReleasedListeners(){this._onReleasedEvent=new Array}};var ot=class{constructor(e,n){this._joystickTriggerValue=.5;this.setup(e,n)}get hand(){return this._hand}get joystickXValue(){return this._gamepad.axes[2]}get joystickYValue(){return this._gamepad.axes[3]}get joystickXJustMoved(){return this._joystickXJustMoved}get joystickYJustMoved(){return this._joystickYJustMoved}setup(e,n){this._gamepad=e,this._hand=n,this.initButtons()}update(){for(let e of this._buttons.keys())this._buttons.get(e).update();this._joystickXIsMoving=Math.abs(this._gamepad.axes[2])>this._joystickTriggerValue,this._joystickYIsMoving=Math.abs(this._gamepad.axes[3])>this._joystickTriggerValue,this._joystickXJustMoved=this._joystickXIsMoving&&!this._joystickXWasMoving,this._joystickYJustMoved=this._joystickYIsMoving&&!this._joystickYWasMoving,this._joystickXWasMoving=this._joystickXIsMoving,this._joystickYWasMoving=this._joystickYIsMoving}getButton(e){return this._buttons.get(e)}initButtons(){let e=[0,1,4,5];this._buttons!=null&&(this._buttons.clear(),this._buttons=null),this._buttons=new Map;for(let n=0;n<e.length;++n){let i=e[n],s=this._gamepad.buttons[i],o=new st(s,i);this._buttons.set(i,o)}}};var se=class extends x{get isPointing(){return this._isPointing}get currentHitPosition(){return this._currentHitPosition}get currentHitObject(){return this._currentHitObject}start(){this._scene=ze(),this._rayMesh=this.rayVisualObject.getComponent("mesh"),this._rayMesh.material.diffuseColor=Z.create(),this.rayVisualObject.translate([0,0,-.5]),this._origin=[0,0,0],this._direction=[0,0,0]}update(n){this.rayOrigin.getTranslationWorld(this._origin),this.rayOrigin.getForward(this._direction);let i=this._scene.rayCast(this._origin,this._direction,1);i.hitCount>0?(this._isPointing=!0,this._currentHitPosition=v.clone(i.locations[0]),this._currentHitObject=i.objects[0],this.processRayStretch(),this.cursorHitVisualObject.setTranslationWorld(this._currentHitPosition)):(this._isPointing=!1,this.rayObject.resetScaling(),this.cursorHitVisualObject.setTranslationWorld([0,-5,0]))}processRayStretch(){let n=v.create();n[0]=this._origin[0],n[1]=this._origin[1],n[2]=this._origin[2];let i=v.distance(n,this._currentHitPosition);this.rayObject.resetScaling(),this.rayObject.scale([1,i-.05,1])}};se.TypeName="pointer-ray",se.Properties={rayOrigin:{type:g.Object},rayObject:{type:g.Object},rayVisualObject:{type:g.Object},cursorHitVisualObject:{type:g.Object}};var oe=class extends x{init(){this._interactCallbacks=new Array}addInteractCallback(n){this._interactCallbacks.push(n)}removeInteractCallback(n){let i=this._interactCallbacks.indexOf(n);this._interactCallbacks.splice(i,1)}};oe.TypeName="ui-element-base",oe.Properties={};var z=class extends oe{start(){this._meshComponent=this.object.getComponent("mesh"),this._meshMaterial=this._meshComponent.material.clone(),this._meshComponent.material=this._meshMaterial,this._textComponent=this.textObject.getComponent("text"),this.object.addComponent(K,{tag:2})}interact(){console.log("Button clicked: "+this.object.name);for(let n of this._interactCallbacks)n();this.visualFeedbackEnabled&&this.processVisualFeedback()}processVisualFeedback(){this._meshMaterial.color=[.635,.73,1,1],setTimeout(()=>{this._meshMaterial.color=[1,1,1,1]},100)}};z.TypeName="ui-button",z.Properties={textObject:{type:g.Object},visualFeedbackEnabled:{type:g.Bool,default:!0}};var nn=class{constructor(){this._soundEmitters=new Map}registerEmitter(e){if(this._soundEmitters.has(e.emitterType)){console.warn("Only one emitter can be register by type");return}this._soundEmitters.set(e.emitterType,e)}playAt(e,n){if(!this._soundEmitters.has(e)){console.warn(`Can't play sound from emitter ${e}. It doesn't exist`);return}this._soundEmitters.get(e).playAt(n)}},de=new nn;var Ue=class extends x{start(){if(this.inputObject===null)throw new Error("Input Object must be defined");if(this._inputComponent=this.inputObject.getComponent("input"),this._hand=this._inputComponent.handedness,this.pointerRay===null)throw new Error("Pointer Ray Object must be defined");this._pointerRayComponent=this.pointerRay.getComponent(se),Kn().push(this.onXrSessionStart.bind(this))}update(n){if(this._xrGamepad!=null){if(this._xrGamepad.update(),!this._pointerRayComponent.isPointing){D.setCurrentPrevizPosition([0,-5,0]);return}switch(J.getTag(this._pointerRayComponent.currentHitObject)){case 1:case 0:{let i=this._pointerRayComponent.currentHitPosition,s=pe.grid.getCellIndices(i[0],i[1],i[2]),o=pe.grid.getCellPositionVec3(s);this._xrGamepad.joystickXJustMoved&&(D.addCurrentPrevizRotation(0,this._xrGamepad.joystickXValue>0?90:-90),de.playAt(2,this._pointerRayComponent.currentHitPosition)),D.setCurrentPrevizPosition(o);break}case 2:{D.setCurrentPrevizPosition([0,-5,0]);break}}}}onXrSessionStart(n){this.inputSourcesSetup(n)}inputSourcesSetup(n){for(let i=0;i<n.inputSources.length;++i){let s=n.inputSources[i];s.handedness===this._hand&&(console.log("Setup hand : "+s.handedness+" For XR Controller "+this._hand),this.setupXrGamepad(s.gamepad))}n.addEventListener("inputsourceschange",this.onXrInputSourceChangeHandler.bind(this))}setupXrGamepad(n){this._xrGamepad=new ot(n,this._hand),this._xrGamepad.getButton(0).addPressedListener(this.onPlacementTriggerPressed.bind(this)),this._xrGamepad.getButton(5).addPressedListener(this.onDeleteButtonPressed.bind(this))}onXrInputSourceChangeHandler(n){for(let i=0;i<n.added.length;++i){let s=n.added[i];s.handedness===this._hand&&(console.log("Setup hand : "+s.handedness+" For XR Controller "+this._hand),this.setupXrGamepad(s.gamepad))}}onPlacementTriggerPressed(){if(this._pointerRayComponent.currentHitObject)switch(J.getTag(this._pointerRayComponent.currentHitObject)){case 1:case 0:{let n=this._pointerRayComponent.currentHitPosition,i=pe.grid.getCellIndices(n[0],n[1],n[2]),s=pe.grid.getCellPositionVec3(i);D.instanciatePrefabAt(s),de.playAt(1,this._pointerRayComponent.currentHitPosition);break}case 2:{let n=this._pointerRayComponent.currentHitObject.getComponent(z);n&&(n.interact(),de.playAt(0,this._pointerRayComponent.currentHitPosition));break}}}onDeleteButtonPressed(){if(this._pointerRayComponent.currentHitObject)switch(J.getTag(this._pointerRayComponent.currentHitObject)){case 1:{this._pointerRayComponent.currentHitObject.parent.destroy(),de.playAt(3,this._pointerRayComponent.currentHitPosition);break}}}};Ue.TypeName="XR-Controller",Ue.Properties={pointerMode:{type:g.Int,default:0},inputObject:{type:g.Object,default:null},pointerRay:{type:g.Object,default:null}};var rn=class extends Q{getPrefabUniqueName(){return rn.TypeName}start(){super.start(),V.registerPrefab(this),this.createPrevisObject()}},Ve=rn;Ve.TypeName="block-prefab",Ve.Properties={finalMesh:{type:g.Mesh},previsMesh:{type:g.Mesh},finalMat:{type:g.Material},previsMat:{type:g.Material}};var sn=class extends Q{getPrefabUniqueName(){return sn.TypeName}start(){super.start(),V.registerPrefab(this),this.createPrevisObject()}},He=sn;He.TypeName="block-stair-prefab",He.Properties={finalMesh:{type:g.Mesh},previsMesh:{type:g.Mesh},finalMat:{type:g.Material},previsMat:{type:g.Material}};var Pt="SAVE_DATA",on=class{constructor(){if(!(typeof window=="undefined"||!window.localStorage)){if(this._localStorage=window.localStorage,this._localStorage.getItem(Pt)!==null){this.processExistingSaveData();return}this.createSaveData()}}processExistingSaveData(){this._saveData=JSON.parse(this._localStorage.getItem(Pt)),console.log(this._saveData)}createSaveData(){this._saveData={saves:new Array},this._localStorage.setItem(Pt,JSON.stringify(this._saveData))}getSavesEntries(){return this._saveData.saves}createNewSaveEntry(e){return{name:e,userPref:{color:[1,1,1],block:""},blocks:new Array}}createOrUpdateSaveEntry(e){let n=this._saveData.saves;for(let i=0;i<n.length;i++)if(n[i].name==e.name){n[i]=e;return}this._saveData.saves.push(e)}removeSaveEntry(e){let n=this._saveData.saves;for(let i=0;i<n.length;i++)if(n[i].name==e.name){n.splice(i,1);return}}flushSaves(){this._localStorage.setItem(Pt,JSON.stringify(this._saveData))}},ne=new on;var H=class extends x{get emitterType(){return this._emitterType}init(){this.onInit(),de.registerEmitter(this)}start(){this._audioSource=this.object.getComponent("howler-audio-source")}playAt(n){this.object.setTranslationWorld(n),this._audioSource.play()}};H.TypeName="sound-emitter-base",H.Properties={};var at=class extends H{onInit(){this._emitterType=0}};at.TypeName="sound-emitter-click";var lt=class extends H{onInit(){this._emitterType=3}};lt.TypeName="sound-emitter-destroy";var ct=class extends H{onInit(){this._emitterType=1}};ct.TypeName="sound-emitter-place";var _t=class extends H{onInit(){this._emitterType=2}};_t.TypeName="sound-emitter-rotate";var We=class extends x{start(){this._prefabComponent=V.getPrefabByName(this.prefab[V.PREFAB_UNAME_KEY]),this._buttonComponent=this.object.getComponent(z),this._buttonComponent.addInteractCallback(this.onInteractHandler.bind(this))}onInteractHandler(){D.setPrefab(this._prefabComponent)}};We.TypeName="block-selector-interactible",We.Properties={prefab:{type:g.Object}};var Xe=class extends x{start(){this._color=new Float32Array([this.red,this.green,this.blue,1]),this._buttonComponent=this.object.getComponent(z),this._buttonComponent.addInteractCallback(this.onInteractHandler.bind(this))}onInteractHandler(){D.setColor(this._color)}};Xe.TypeName="color-selector-interactible",Xe.Properties={red:{type:g.Float},green:{type:g.Float},blue:{type:g.Float}};var an=class{get texturesUniqueID(){return Array.from(this._texturesInformation.keys())}constructor(){this._texturesInformation=new Map}register(e){return this._texturesInformation.has(e.uniqueID)?!1:(this._texturesInformation.set(e.uniqueID,e),console.log("New Texture information registered ",e.uniqueID),!0)}getTextureInformation(e){var n;return(n=this._texturesInformation.get(e))!=null?n:null}},ei=new an;var ae=class extends x{get uniqueID(){return this.uid}get albedoTexture(){return this.albedo}get normalTexture(){return this.normal}start(){ei.register(this)}};ae.TypeName="texture-information",ae.Properties={uid:{type:g.String},albedo:{type:g.Texture,default:null},normal:{type:g.Texture,default:null}};var qe=class extends x{start(){if(!this.textureInfoObject){console.error("Object must be set to initialize the button ",this.object.name);return}this._texture=this.textureInfoObject.getComponent(ae),this._buttonComponent=this.object.getComponent(z),this._buttonComponent.addInteractCallback(this.onInteractHandler.bind(this))}onInteractHandler(){D.setTexture(this._texture)}};qe.TypeName="texture-selector-interactible",qe.Properties={textureInfoObject:{type:g.Object,default:null}};var Ye=class extends x{start(){this._loadButton=this.loadButtonObj.getComponent(z),this._newButton=this.newButtonObj.getComponent(z),this._nextButton=this.nextButtonObj.getComponent(z),this._saveButton=this.saveButtonObj.getComponent(z),this._removeButton=this.removeButtonObj.getComponent(z),this._loadButton.addInteractCallback(this.onLoadButtonClicked.bind(this)),this._newButton.addInteractCallback(this.onNewButtonPressed.bind(this)),this._nextButton.addInteractCallback(this.onNextButtonPressed.bind(this)),this._saveButton.addInteractCallback(this.onSaveButtonPressed.bind(this)),this._removeButton.addInteractCallback(this.onRemoveButtonPressed.bind(this)),this._saveCount=this.saveCountObj.getComponent("text"),this._saveName=this.saveNameObj.getComponent("text"),this._saveEntries=ne.getSavesEntries(),this._currentSaveIndex=this._saveEntries.length<1?-1:0,this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[0].name,this.loadBlankSave()}onLoadButtonClicked(){this._currentSaveIndex<0||(this._currentBuildData=this._saveEntries[this._currentSaveIndex],console.log(this._currentBuildData),D.loadBuild(this._currentBuildData.blocks))}onNewButtonPressed(){this.setCurrentSelectedSave(-1),D.loadBuild(this._currentBuildData.blocks)}onNextButtonPressed(){this._currentSaveIndex++,this._currentSaveIndex>this._saveEntries.length-1&&(this._currentSaveIndex=0),this.setCurrentSelectedSave(this._currentSaveIndex),this._saveName.text=this._currentSaveIndex<0?"No save available":this._currentBuildData.name}onSaveButtonPressed(){this._currentBuildData.blocks=D.getCurrentBuildData(),ne.createOrUpdateSaveEntry(this._currentBuildData),ne.flushSaves(),this._saveEntries=ne.getSavesEntries(),this._currentSaveIndex=this._currentSaveIndex<0?0:this._currentSaveIndex,this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[this._currentSaveIndex].name}onRemoveButtonPressed(){if(this._currentSaveIndex<0)return;let n=this._saveEntries[this._currentSaveIndex];if(n.name==this._currentBuildData.name&&(this.setCurrentSelectedSave(-1),D.loadBuild(this._currentBuildData.blocks)),ne.removeSaveEntry(n),ne.flushSaves(),this._saveEntries=ne.getSavesEntries(),this._saveEntries.length<1)this._currentSaveIndex=-1;else{let i=this._currentSaveIndex>this._saveEntries.length-1;this._currentSaveIndex=i?0:this._currentSaveIndex}this._saveCount.text="Saves: "+this._saveEntries.length,this._saveName.text=this._currentSaveIndex<0?"No save available":this._saveEntries[this._currentSaveIndex].name}loadBlankSave(){this.setCurrentSelectedSave(-1),D.loadBuild(this._currentBuildData.blocks)}setCurrentSelectedSave(n){switch(n){case-1:this._currentBuildData=ne.createNewSaveEntry(new Date().toLocaleString());break;default:this._currentBuildData=this._saveEntries[n];break}}};Ye.TypeName="save-panel",Ye.Properties={loadButtonObj:{type:g.Object,default:null},newButtonObj:{type:g.Object,default:null},nextButtonObj:{type:g.Object,default:null},saveButtonObj:{type:g.Object,default:null},removeButtonObj:{type:g.Object,default:null},saveCountObj:{type:g.Object,default:null},saveNameObj:{type:g.Object,default:null}};var Ge=class extends x{start(){this._mesh=this.object.getComponent("mesh");let n=this.material.clone();n.occlusionTexture=this.albedoMap,n.normalTexture=this.normalMap,this._mesh.material=n}};Ge.TypeName="simple-preview-block-creator",Ge.Properties={material:{type:g.Material,default:null},albedoMap:{type:g.Texture,default:null},normalMap:{type:g.Texture,default:null}};var ee=class extends x{constructor(){super(...arguments);this.COLOR_NORMAL=Z.fromValues(76/255,106/255,134/255,1);this.COLOR_ACTIVE=Z.fromValues(255/255,162/255,56/255,1)}get isActive(){return this._isActive}get button(){return this._button}start(){super.start(),this.setup(),this.setupIcon()}setActive(n){this._material.color=n?this.COLOR_ACTIVE:this.COLOR_NORMAL,this._isActive=n}setup(){var i;this._button=this.object.getComponent(z),this._button||this.throwMissingComponent(z.TypeName);let n=this.object.getComponent("mesh");n||this.throwMissingComponent(le.TypeName),this._material=(i=n.material)==null?void 0:i.clone(),this._material&&this.throwMissingComponent("Material"),n.material=this._material,this._material.color=this.COLOR_NORMAL,this._isActive=!1}setupIcon(){var i;let n=this.iconObject.getComponent("mesh");n||this.throwMissingComponent(le.TypeName),this._iconMaterial=(i=n.material)==null?void 0:i.clone(),this._iconMaterial&&this.throwMissingComponent("Material"),n.material=this._iconMaterial,this._iconMaterial.flatTexture=this.iconTexture}throwMissingComponent(n){throw new Error(`Component MenuSelectionButton require a ${n} Component`)}};ee.TypeName="menu-selection-button",ee.Properties={iconObject:{type:g.Object,default:null},iconTexture:{type:g.Texture,default:null}};var Qe=class extends x{start(){this._menuButtonComp=this.menuButton.getComponent(ee),this._blockButtonComp=this.blockButton.getComponent(ee),this._textureButtonComp=this.textureButton.getComponent(ee),this._menuButtonComp.button.addInteractCallback(this.onMenuButtonPressed.bind(this)),this._blockButtonComp.button.addInteractCallback(this.onBlockButtonPressed.bind(this)),this._textureButtonComp.button.addInteractCallback(this.onTextureButtonPressed.bind(this))}onMenuButtonPressed(){this._menuButtonComp.setActive(!0),this._blockButtonComp.setActive(!1),this._textureButtonComp.setActive(!1)}onBlockButtonPressed(){this._blockButtonComp.setActive(!0),this._menuButtonComp.setActive(!1),this._textureButtonComp.setActive(!1)}onTextureButtonPressed(){this._textureButtonComp.setActive(!0),this._menuButtonComp.setActive(!1),this._blockButtonComp.setActive(!1)}};Qe.TypeName="menu-controller",Qe.Properties={menuButton:{type:g.Object},blockButton:{type:g.Object},textureButton:{type:g.Object},menuPanel:{type:g.Object},blockPanel:{type:g.Object},texturePanel:{type:g.Object}};WL.registerComponent(fe,we,ge,be,xe,ye,Me,Te,Ae,je,Se,Ce,Pe,Ie,Oe,Ee,Re,ke,Fe,Be,Le,De);WL.registerComponent(te);WL.registerComponent(Ne);WL.registerComponent(se);WL.registerComponent(Ue);WL.registerComponent(Ve);WL.registerComponent(re);WL.registerComponent(He);WL.registerComponent(H);WL.registerComponent(at);WL.registerComponent(lt);WL.registerComponent(ct);WL.registerComponent(_t);WL.registerComponent(We);WL.registerComponent(Xe);WL.registerComponent(qe);WL.registerComponent(z);WL.registerComponent(oe);WL.registerComponent(Ye);WL.registerComponent(Ge);WL.registerComponent(K);WL.registerComponent(ae);WL.registerComponent(ee);WL.registerComponent(Qe);})();
/*! Bundled license information:

howler/dist/howler.js:
  (*!
   *  howler.js v2.2.3
   *  howlerjs.com
   *
   *  (c) 2013-2020, James Simpson of GoldFire Studios
   *  goldfirestudios.com
   *
   *  MIT License
   *)
  (*!
   *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
   *  
   *  howler.js v2.2.3
   *  howlerjs.com
   *
   *  (c) 2013-2020, James Simpson of GoldFire Studios
   *  goldfirestudios.com
   *
   *  MIT License
   *)
*/
//# sourceMappingURL=wonderbrick-bundle.js.map
